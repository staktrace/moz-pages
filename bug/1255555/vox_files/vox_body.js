!function(){"use strict";function e(e){u.push(e),1==u.length&&d()}function t(){for(;u.length;)u[0](),u.shift()}function i(e){this.a=h,this.b=void 0,this.f=[];var t=this;try{e(function(e){r(t,e)},function(e){a(t,e)})}catch(i){a(t,i)}}function n(e){return new i(function(t,i){i(e)})}function o(e){return new i(function(t){t(e)})}function r(e,t){if(e.a==h){if(t==e)throw new TypeError;var i=!1;try{var n=t&&t.then;if(null!=t&&"object"==typeof t&&"function"==typeof n)return void n.call(t,function(t){i||r(e,t),i=!0},function(t){i||a(e,t),i=!0})}catch(o){return void(i||a(e,o))}e.a=0,e.b=t,s(e)}}function a(e,t){if(e.a==h){if(t==e)throw new TypeError;e.a=1,e.b=t,s(e)}}function s(t){e(function(){if(t.a!=h)for(;t.f.length;){var e=t.f.shift(),i=e[0],n=e[1],o=e[2],e=e[3];try{0==t.a?o("function"==typeof i?i.call(void 0,t.b):t.b):1==t.a&&("function"==typeof n?o(n.call(void 0,t.b)):e(t.b))}catch(r){e(r)}}})}function l(e){return new i(function(t,i){function n(i){return function(n){a[i]=n,r+=1,r==e.length&&t(a)}}var r=0,a=[];0==e.length&&t(a);for(var s=0;s<e.length;s+=1)o(e[s]).c(n(s),i)})}function c(e){return new i(function(t,i){for(var n=0;n<e.length;n+=1)o(e[n]).c(t,i)})}var d,u=[];d=function(){setTimeout(t)};var h=2;i.prototype.g=function(e){return this.c(void 0,e)},i.prototype.c=function(e,t){var n=this;return new i(function(i,o){n.f.push([e,t,i,o]),s(n)})},window.Promise||(window.Promise=i,window.Promise.resolve=o,window.Promise.reject=n,window.Promise.race=c,window.Promise.all=l,window.Promise.prototype.then=i.prototype.c,window.Promise.prototype["catch"]=i.prototype.g)}(),function(){function e(e,t){c?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function t(e){document.body?e():c?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",function(){"interactive"!=document.readyState&&"complete"!=document.readyState||e()})}function i(e){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function n(e,t){e.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+t+";"}function o(e){var t=e.a.offsetWidth,i=t+100;return e.f.style.width=i+"px",e.c.scrollLeft=i,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t?(e.g=t,!0):!1}function r(t,i){function n(){var e=r;o(e)&&null!==e.a.parentNode&&i(e.g)}var r=t;e(t.b,n),e(t.c,n),o(t)}function a(e,t){var i=t||{};this.family=e,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}function s(){if(null===u){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(t){}u=""!==e.style.font}return u}function l(e,t){return[e.style,e.weight,s()?e.stretch:"","100px",t].join(" ")}var c=!!document.addEventListener,d=null,u=null,h=!!window.FontFace;a.prototype.load=function(e,o){var a=this,s=e||"BESbswy",c=o||3e3,u=(new Date).getTime();return new Promise(function(e,o){if(h){var m=new Promise(function(e,t){function i(){(new Date).getTime()-u>=c?t():document.fonts.load(l(a,a.family),s).then(function(t){1<=t.length?e():setTimeout(i,25)},function(){t()})}i()}),p=new Promise(function(e,t){setTimeout(t,c)});Promise.race([p,m]).then(function(){e(a)},function(){o(a)})}else t(function(){function t(){var t;(t=-1!=g&&-1!=v||-1!=g&&-1!=_||-1!=v&&-1!=_)&&((t=g!=v&&g!=_&&v!=_)||(null===d&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),d=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=d&&(g==w&&v==w&&_==w||g==C&&v==C&&_==C||g==b&&v==b&&_==b)),t=!t),t&&(null!==y.parentNode&&y.parentNode.removeChild(y),clearTimeout(x),e(a))}function h(){if((new Date).getTime()-u>=c)null!==y.parentNode&&y.parentNode.removeChild(y),o(a);else{var e=document.hidden;(!0===e||void 0===e)&&(g=m.a.offsetWidth,v=p.a.offsetWidth,_=f.a.offsetWidth,t()),x=setTimeout(h,50)}}var m=new i(s),p=new i(s),f=new i(s),g=-1,v=-1,_=-1,w=-1,C=-1,b=-1,y=document.createElement("div"),x=0;y.dir="ltr",n(m,l(a,"sans-serif")),n(p,l(a,"serif")),n(f,l(a,"monospace")),y.appendChild(m.a),y.appendChild(p.a),y.appendChild(f.a),document.body.appendChild(y),w=m.a.offsetWidth,C=p.a.offsetWidth,b=f.a.offsetWidth,h(),r(m,function(e){g=e,t()}),n(m,l(a,'"'+a.family+'",sans-serif')),r(p,function(e){v=e,t()}),n(p,l(a,'"'+a.family+'",serif')),r(f,function(e){_=e,t()}),n(f,l(a,'"'+a.family+'",monospace'))})})},window.FontFaceObserver=a,window.FontFaceObserver.prototype.check=window.FontFaceObserver.prototype.load=a.prototype.load,"undefined"!=typeof module&&(module.exports=window.FontFaceObserver)}(),function(e,t,i,n){"use strict";var o=e.FontObserver.fonts||[],r=[],a=function(){t.documentElement.className+=" fonts-loaded",e.Modernizr.localstorage&&localStorage.setItem("fonts-loaded",!0)},s=function(){t.documentElement.className+=" fonts-unavailable",e.Modernizr.localstorage&&"true"!==localStorage.getItem("fonts-loaded")&&localStorage.setItem("fonts-loaded",!1)};o.forEach(function(e){var t="",i={},o=null,a={style:"normal",weight:"400"};"object"==typeof e?(t=e.name,i=e.options):t=e;for(var s in a)!i.hasOwnProperty(s)&&a.hasOwnProperty(s)&&(i[s]=a[s]);o=new n(t,i),r.push(o.check(null,15e3))}),Promise.all(r).then(a,s)}(Chorus,document,dataLayer,FontFaceObserver),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var i=e(t);e.fn.lazyload=function(n){function o(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function r(){var t=0;s.each(function(){var i=e(this);if(!l.skip_invisible||i.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else i.trigger("lazyload:appear")})}var a,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(n&&(void 0!==n.failurelimit&&(n.failure_limit=n.failurelimit,delete n.failurelimit),void 0!==n.effectspeed&&(n.effect_speed=n.effectspeed,delete n.effectspeed),e.extend(l,n)),a=void 0===l.container||l.container===t?i:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return r()};a.bind(l.event,o(c,l.scrollInterval))}this.each(function(){var i=this,n=e(i);i.loaded=!1,i.error_event_set=!1;var r=4e3,a=4,c=0,d=function(){if(!this.loaded){if(l.appear){var o=s.length;l.appear.call(i,o,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){n.hide().attr("src",n.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),i.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var o=s.length;l.load.call(i,o,l)}}).bind("error",function(){i.error_event_set||t.setTimeout(e.proxy(u,this),r),i.error_event_set=!0}).attr("src",n.attr("data-"+l.data_attribute));else{n.css("background-image","url('"+n.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),i.loaded=!0;var a=e.grep(s,function(e){return!e.loaded});if(s=e(a),l.load){var o=s.length;l.load.call(i,o,l)}}}},u=function(){if(c+=1,a>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(u,this),r)});var i=this.src.split("?")[0];this.src=i+"?"+(new Date).getTime()}};if(n.one("lazyload:appear",d),0!==l.event.indexOf("scroll")){var h=function(e){i.loaded||n.trigger("lazyload:appear")};n.bind(l.event,o(h,l.scrollInterval))}});var d=function(e){r()};return i.bind("resize",o(d,l.resizeInterval)),r(),this},e.belowthefold=function(n,o){var r;return r=void 0===o.container||o.container===t?i.height()+i.scrollTop():e(o.container).offset().top+e(o.container).height(),r<=e(n).offset().top-o.threshold},e.rightoffold=function(n,o){var r;return r=void 0===o.container||o.container===t?i.width()+i.scrollLeft():e(o.container).offset().left+e(o.container).width(),r<=e(n).offset().left-o.threshold},e.abovethetop=function(n,o){var r;return r=void 0===o.container||o.container===t?i.scrollTop():e(o.container).offset().top,r>=e(n).offset().top+o.threshold+e(n).height()},e.leftofbegin=function(n,o){var r;return r=void 0===o.container||o.container===t?i.scrollLeft():e(o.container).offset().left,r>=e(n).offset().left+o.threshold+e(n).width()},e.inviewport=function(t,i){return!(e.rightofscreen(t,i)||e.leftofscreen(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var PLAYGIF_DISABLE_FLAG;!function(e){e.fn.playGIF=function(t){var i=e.extend({on:"touchstart mouseenter",off:"touchstart mouseleave",autoResize:!1,enable:!0,circleBackgroundColor:"FFF200",circleTextColor:"4C4E4D",gifText:"GIF",removeAnchor:!0},t);"undefined"!=typeof PLAYGIF_DISABLE_FLAG&&(i.enable=!PLAYGIF_DISABLE_FLAG);var n=function(e,t,n){t=Math.floor(t),n=Math.floor(n);var o=35;e.fillStyle="#"+i.circleBackgroundColor,e.beginPath(),e.arc(t,n,o,0,2*Math.PI,!0),e.closePath(),e.fill(),e.fillStyle="#"+i.circleTextColor,e.font="15px 'Gotham SSm A', 'Gotham SSm B', sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(i.gifText,t,n)};return this.each(function(){if(i.enable!==!1){var t=e(this);if(!t.is("img")||!/\.gif$/i.test(t.attr("src")))return!0;var o=document.createElement("canvas");if("undefined"==typeof o.getContext)return!0;var r=o.getContext("2d"),a=new Image,s=function(e,t){t.on(i.off,function(){l(e,t)});var n=t.attr("src");t.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t.css({width:e.attr("width"),height:e.attr("height")}),setTimeout(function(){t.attr("src",n)},0),e.replaceWith(t)},l=function(e,t){e.on(i.on,function(){s(e,t)}),t.replaceWith(e)};a.onload=function(){var l=t.width(),c=t.height();o.width=l,o.height=c,r.drawImage(a,0,0,l,c);var d=e(o);if(i.autoResize===!0){o.setAttribute("data-src",t.attr("src")),o.setAttribute("class","gif");var u=e('<span class="faux-image">');u.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),"max-width":"100%",position:"relative",display:"block",height:o.height}),d.css({position:"absolute",top:0,left:0}),d=u.append(d)}else d.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),display:t.css("display")});t.replaceWith(d);var h=d.parent();h.is("p")||"none"===h.css("max-width")&&"none"===h.css("max-height")||(l=h.width(),c=h.height()),i.removeAnchor&&h.is("a")&&/\.gif$/i.test(h.attr("href"))&&h.replaceWith(d),l>150&&c>150&&n(r,l/2,c/2),d.on(i.on,function(){s(d,t)})},a.src=t.attr("src")}})}}(jQuery),function(e){e.fn.redraw=function(){return e(this).each(function(){var t=document.createTextNode(" ");e(this).append(t),setTimeout(function(){t.parentNode.removeChild(t)},0)})}}(jQuery),/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
function(e){function t(e){return s.raw?e:encodeURIComponent(e)}function i(e){return s.raw?e:decodeURIComponent(e)}function n(e){return t(s.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(a," ")),s.json?JSON.parse(e):e}catch(t){}}function r(t,i){var n=s.raw?t:o(t);return e.isFunction(i)?i(n):n}var a=/\+/g,s=e.cookie=function(o,a,l){if(void 0!==a&&!e.isFunction(a)){if(l=e.extend({},s.defaults,l),"number"==typeof l.expires){var c=l.expires,d=l.expires=new Date;d.setDate(d.getDate()+c)}return document.cookie=[t(o),"=",n(a),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var u=o?void 0:{},h=document.cookie?document.cookie.split("; "):[],m=0,p=h.length;p>m;m++){var f=h[m].split("="),g=i(f.shift()),v=f.join("=");if(o&&o===g){u=r(v,a);break}o||void 0===(v=r(v))||(u[g]=v)}return u};s.defaults={},e.removeCookie=function(t,i){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},i,{expires:-1})),!e.cookie(t))}}(jQuery),function(e,t){e.rails!==t&&e.error("jquery-ujs has already been loaded!");var i,n=e(document);e.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(t){var i=e('meta[name="csrf-token"]').attr("content");i&&t.setRequestHeader("X-CSRF-Token",i)},refreshCSRFTokens:function(){var t=e("meta[name=csrf-token]").attr("content"),i=e("meta[name=csrf-param]").attr("content");e('form input[name="'+i+'"]').val(t)},fire:function(t,i,n){var o=e.Event(i);return t.trigger(o,n),o.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},handleRemote:function(n){var o,r,a,s,l,c;if(i.fire(n,"ajax:before")){if(s=n.data("with-credentials")||null,l=n.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,n.is("form")){o=n.attr("method"),r=n.attr("action"),a=n.serializeArray();var d=n.data("ujs:submit-button");d&&(a.push(d),n.data("ujs:submit-button",null))}else n.is(i.inputChangeSelector)?(o=n.data("method"),r=n.data("url"),a=n.serialize(),n.data("params")&&(a=a+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(o=n.data("method")||"get",r=n.data("url"),a=n.serialize(),n.data("params")&&(a=a+"&"+n.data("params"))):(o=n.data("method"),r=i.href(n),a=n.data("params")||null);return c={type:o||"GET",data:a,dataType:l,beforeSend:function(e,o){return o.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+o.accepts.script),i.fire(n,"ajax:beforeSend",[e,o])?void n.trigger("ajax:send",e):!1},success:function(e,t,i){n.trigger("ajax:success",[e,t,i])},complete:function(e,t){n.trigger("ajax:complete",[e,t])},error:function(e,t,i){n.trigger("ajax:error",[e,t,i])},crossDomain:i.isCrossDomain(r)},s&&(c.xhrFields={withCredentials:s}),r&&(c.url=r),i.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var i=document.createElement("a");try{return i.href=e,i.href=i.href,!i.protocol||!i.host||t.protocol+"//"+t.host!=i.protocol+"//"+i.host}catch(n){return!0}},handleMethod:function(n){var o=i.href(n),r=n.data("method"),a=n.attr("target"),s=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+o+'"></form>'),d='<input name="_method" value="'+r+'" type="hidden" />';l===t||s===t||i.isCrossDomain(o)||(d+='<input name="'+l+'" value="'+s+'" type="hidden" />'),a&&c.attr("target",a),c.hide().append(d).appendTo("body"),c.submit()},formElements:function(t,i){return t.is("form")?e(t[0].elements).filter(i):t.find(i)},disableFormElements:function(t){i.formElements(t,i.disableSelector).each(function(){i.disableFormElement(e(this))})},disableFormElement:function(e){var i,n;i=e.is("button")?"html":"val",n=e.data("disable-with"),e.data("ujs:enable-with",e[i]()),n!==t&&e[i](n),e.prop("disabled",!0)},enableFormElements:function(t){i.formElements(t,i.enableSelector).each(function(){i.enableFormElement(e(this))})},enableFormElement:function(e){var t=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.prop("disabled",!1)},allowAction:function(e){var t,n=e.data("confirm"),o=!1;return n?(i.fire(e,"confirm")&&(o=i.confirm(n),t=i.fire(e,"confirm:complete",[o])),o&&t):!0},blankInputs:function(t,i,n){var o,r,a=e(),s=i||"input,textarea",l=t.find(s);return l.each(function(){if(o=e(this),r=o.is("input[type=checkbox],input[type=radio]")?o.is(":checked"):o.val(),!r==!n){if(o.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+o.attr("name")+'"]').length)return!0;a=a.add(o)}}),a.length?a:!1},nonBlankInputs:function(e,t){return i.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var n=e.data("disable-with");e.data("ujs:enable-with",e.html()),n!==t&&e.html(n),e.bind("click.railsDisable",function(e){return i.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},i.fire(n,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,n){e.crossDomain||i.CSRFProtection(n)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:enable-with")&&e.rails.enableElement(t)})}),n.delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(e(this))}),n.delegate(i.buttonDisableSelector,"ajax:complete",function(){i.enableFormElement(e(this))}),n.delegate(i.linkClickSelector,"click.rails",function(n){var o=e(this),r=o.data("method"),a=o.data("params"),s=n.metaKey||n.ctrlKey;if(!i.allowAction(o))return i.stopEverything(n);if(!s&&o.is(i.linkDisableSelector)&&i.disableElement(o),o.data("remote")!==t){if(s&&(!r||"GET"===r)&&!a)return!0;var l=i.handleRemote(o);return l===!1?i.enableElement(o):l.fail(function(){i.enableElement(o)}),!1}return r?(i.handleMethod(o),!1):void 0}),n.delegate(i.buttonClickSelector,"click.rails",function(t){var n=e(this);if(!i.allowAction(n))return i.stopEverything(t);n.is(i.buttonDisableSelector)&&i.disableFormElement(n);var o=i.handleRemote(n);return o===!1?i.enableFormElement(n):o.fail(function(){i.enableFormElement(n)}),!1}),n.delegate(i.inputChangeSelector,"change.rails",function(t){var n=e(this);return i.allowAction(n)?(i.handleRemote(n),!1):i.stopEverything(t)}),n.delegate(i.formSubmitSelector,"submit.rails",function(n){var o,r,a=e(this),s=a.data("remote")!==t;if(!i.allowAction(a))return i.stopEverything(n);if(a.attr("novalidate")==t&&(o=i.blankInputs(a,i.requiredInputSelector),o&&i.fire(a,"ajax:aborted:required",[o])))return i.stopEverything(n);if(s){if(r=i.nonBlankInputs(a,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(a)},13);var l=i.fire(a,"ajax:aborted:file",[r]);return l||setTimeout(function(){i.enableFormElements(a)},13),l}return i.handleRemote(a),!1}setTimeout(function(){i.disableFormElements(a)},13)}),n.delegate(i.formInputClickSelector,"click.rails",function(t){var n=e(this);if(!i.allowAction(n))return i.stopEverything(t);var o=n.attr("name"),r=o?{name:o,value:n.val()}:null;n.closest("form").data("ujs:submit-button",r)}),n.delegate(i.formSubmitSelector,"ajax:send.rails",function(t){this==t.target&&i.disableFormElements(e(this))}),n.delegate(i.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&i.enableFormElements(e(this))}),e(function(){i.refreshCSRFTokens()}))}(jQuery);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,i){var s={failure_limit:20,load:function(){var t=e(this),i=t.parent(".image-window");if(t.is("img")&&(i.length>0?(t.css({position:"absolute",top:Math.round((i.outerHeight()-t.outerHeight())/2),left:Math.round((i.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(r),t.removeClass(a),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var n=Chorus.Context.gif_opts||{};if(Chorus.Context&&Chorus.Context.main_link_color&&(n.circleBackgroundColor=Chorus.Context.main_link_color,n.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var o=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),s=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');o.length+s.length===1?PLAYGIF_DISABLE_FLAG=!0:o&&o.length>0&&(PLAYGIF_DISABLE_FLAG=!1,o.playGIF(n))}t.playGIF(n)}},threshold:800};i&&e.extend(s,i),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(o+":visible").not("."+a+", ."+r),c=[],d=[];l.each(function(){var t,i,o,r,l,u=e(this),h=u.attr("data-imgkey"),m=u.data("chorus-asset-id");if("undefined"!=typeof h){if(s.parentDimensionSlc){var p=u.closest(s.parentDimensionSlc);t=p.outerWidth(),i=p.outerHeight()}t||(t=u.outerWidth()),i||(i=u.outerHeight()),0==i&&(o=u.data("ratio"),i="undefined"!=typeof o&&o>0?Math.ceil(t/o):t),u.is("img")&&(o=u.data("ratio"),r=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(i=Math.ceil(t/o)),r.length>0&&(t=Math.ceil(r.outerWidth()),i=Math.ceil(r.outerHeight())),i>0&&u.css("height",i)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),i=Math.ceil(i*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),i=Math.ceil(1.3*i)),/\.(png|jpg|jpeg)$/i.test(u.attr("data-original"))&&n.webp&&!Chorus.Modernizr.touch&&(l="webp");var f=h+":"+t+"x"+i+(l?":"+l:"");c.push(f),u.attr("data-dim",t+"x"+i),u.addClass(a)}else if("undefined"!=typeof m){t=u.outerWidth(),i=u.outerHeight(),u.is("img")&&(o=u.data("ratio"),r=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(i=Math.ceil(t/o)),r.length>0&&(t=Math.ceil(r.outerWidth()),i=Math.ceil(r.outerHeight())),i>0&&u.css("height",i)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),i=Math.ceil(i*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),i=Math.ceil(1.3*i));var g=m+":"+t+":"+i;d.push(g),u.data("asset-key",g),u.addClass(a)}else u.lazyload(s)}),(0!==c.length||0!==d.length)&&(e.each([d,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:d.join(",")},success:function(t){var i=t.urls,n={};_.forEach(i,function(e,t){var i=t.replace(/\:webp|\:jp2/,"");n[i]=e}),i=n,l.each(function(){var t,n=e(this);t=n.attr("data-imgkey")?n.attr("data-imgkey")+":"+n.attr("data-dim"):n.data("asset-key");var o=i[t];"undefined"!=typeof o&&(n.attr("data-original",o),n.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var i={},n={webp:!1,jp2:!1},o=".vox-lazy-load",r="lazy-loaded",a="lazy-loading";return i.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))n.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,o();else{var e=new Image;e.onload=function(){n.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",n.webp),o()},e.onerror=function(){n.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",n.webp),o()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function o(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:i.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},i.initUI=function(e,i){t(e,i)},i.applyTo=function(e,i){t(e,i)},i}(jQuery);var Chorus=Chorus||{};Chorus.EditoriallyManagedCell=function(e,t){"use strict";function i(e){for(var t={},i=e.serializeArray(),n=i.length-1;n>-1;n--){var o=i[n].name,r=i[n].value;t[o]?t[o]=_.flatten([t[o],r]):t[o]=r}return t}function n(e){alert("There was an error updating this cell. Please check your URL and/or that all fields are completed.")}function o(t){t.preventDefault();var i=e(t.currentTarget);a(i.closest(".chorus-emc__admin"),i.data("emc-action"),i.data("emc-data"))}function r(t){t.preventDefault();var n=e(t.currentTarget),o=n.closest("form");a(e('.chorus-emc__admin[data-emc-slug="'+o.data("emc-slug")+'"]'),"update",_.extend(i(o),{button_action:n.data("emc-action")}))}function a(t,i,o){var o=_.extend({slug:t.data("emc-slug"),bucket:t.data("emc-bucket")},o),r=c[i];if("edit"===i||"help"===i)Chorus.EventDispatcher.publish("modal_open",{method:a,url:r,data:o});else{var a="update"==i?"POST":"GET";s(t),e.ajax({method:a,url:r,data:o,success:function(i){Chorus.EventDispatcher.publish("modal_close");var n=e('.chorus-emc__content[data-emc-slug="'+t.data("emc-slug")+'"]');n.length>0&&n.replaceWith(i)},error:n})}}function s(t){e(t).find(".chorus-emc__content").html("Loading...")}function l(){e(t).on("click",".chorus-emc__admin *[data-emc-action]",o),e(t).on("click",".chorus-emc__form *[data-emc-action]",r)}var c={edit:"/editorially_managed_cells/handle_edit",update:"/editorially_managed_cells/handle_update",preview:"/editorially_managed_cells/preview",show_live:"/editorially_managed_cells/refresh",help:"/editorially_managed_cells/help"};return{init:l,urls:c}}(jQuery,document),jQuery(function(){Chorus.EditoriallyManagedCell.init()}),Chorus.ModuleLoader=function(e){var t={};e(document).ready(function(){Chorus.ModuleLoader.init()});var i=function(t){e.ajax({type:"GET",url:"/chorus_page/delayed_load_cells",dataType:"json",contentType:"application/json",timeout:1e4,data:t,success:function(t){null!==t&&e.each(t,function(t,i){var n=e(e.parseHTML(i,document,!0)),o=n.data("sbn-module-name");e("#"+t).replaceWith(n),Chorus.EventDispatcher&&(Chorus.EventDispatcher.publish("moduleInserted",{modules:n}),o&&SBN[o]&&SBN[o].init())})}})},n=function(t){t=t||e(document);var n=[],o=Util.UserAgentProfiler.profile();if(t.find("[data-delayed-load-cell-key]").each(function(){var t=e(this);t.data("unless-profile-is")!==o&&n.push(t.data("delayed-load-cell-key"))}),0!=n.length){n.sort();for(var r=2e3,a=0,s=[],l=0,c=n.length;c>l;l++){var d=n[l],u=d.length;if(a+u>=r){var h={cells:JSON.stringify(s)};Chorus.Context.hub_id&&(h.hub_id=Chorus.Context.hub_id),Chorus.Context.entry_id&&(h.entry_id=Chorus.Context.entry_id),i(h),s=[d],a=0}else a+=u,s.push(d);if(l+1==c){var h={cells:JSON.stringify(s)};Chorus.Context.hub_id&&(h.hub_id=Chorus.Context.hub_id),Chorus.Context.entry_id&&(h.entry_id=Chorus.Context.entry_id),i(h)}}}};return t.init=function(){this.initUI()},t.initUI=function(){n()},t}(jQuery);var Chorus=Chorus||{};Chorus.ToggleLink=function(e){function t(){var t=e(this),i=t.data();return i.toggleInProcess?!1:(i.toggleText&&(oldText=t.text(),t.text(i.toggleText)),i.toggleInProcess=!0,e.ajax({url:t.attr("href"),type:i.toggleMethod||"POST",dataType:"text",success:function(){if(i.toggleText=oldText,i.toggleUrl){var e=i.toggleUrl;t.attr("href",i.toggleUrl),i.toggleUrl=e}i.toggleInProcess=!1},error:function(){t.text(oldText),i.toggleInProcess=!1,alert("An unknown error occurred. Please try again later.")}}),!1)}var i="a[data-toggle-url]";return{init:function(){e(document).on("click",i,t)}}}(jQuery),jQuery(function(){Chorus.ToggleLink.init()}),function(e){function t(e){var t={};e=(e||"").replace(/^(\?|\&)/,"").split("&");for(var i=0;i<e.length;i++){var n=e[i].split("=");n.length>1&&(t[n[0]]=n[1])}return t}function i(i,n){var r=i.attr("href"),a=i.attr("data-url");if(a&&o[n]&&(r=o[n]+encodeURIComponent(a)),r&&"#"!==r[0]){var s=r.match(/(.*(?:\?|\&)(?:url|u)=)([^&]+)(.*)/),l=i.closest("[data-analytics-placement]").attr("data-analytics-placement"),c=decodeURIComponent(s[2]).split("?"),d=c[0].split("#"),u=d[0]||c[0],h=d[1]||"",m=e.extend({utm_campaign:location.hostname.replace(/(www\.)?(.+)\.com/,"$2"),utm_content:Chorus.Analytics.contentType()+(l?":"+l:""),utm_medium:"social",utm_source:n},t(c[1]),t(i.attr("data-params")));r=""==h.trim()?s[1]+encodeURIComponent(u+"?"+e.param(m))+s[3]:s[1]+encodeURIComponent(u+"?"+e.param(m)+"#"+h)+s[3],i.attr("href",r)}return r}var n,o={facebook:"http://www.facebook.com/share.php?u=",twitter:"https://twitter.com/intent/tweet?url=",pinterest:"https://www.pinterest.com/pin/create/button/?url="};e("[data-analytics-social]").on("click",function(t){var o,r,a=e(this),s=a.attr("data-analytics-social"),l=i(a,s),c=570,d=570;if(Chorus.Context.is_preview)return t.stopPropagation(),alert("Social buttons cannot be used during preview.");switch(s){case"facebook":d=279;break;case"twitter":d=279;break;case"linkedin":d=520;break;case"pinterest":c=d=750}if("#"!==l[0]&&"_blank"!==a.attr("target")&&"whatsapp"!==s){n&&n.close&&n.close(),r=screen.width/2-c/2,o=screen.height/2-d/2,n=window.open(l,"","width="+c+", height="+d+", top="+o+", left="+r),t.preventDefault();var u=window.open;window.open=function(){},setTimeout(function(){window.open=u},0)}}),function(e,t,i){function n(){var e,n=t.getElementsByTagName(i)[0],o=function(o,r){t.getElementById(r)||(e=t.createElement(i),e.src=o,e.id=r,n.parentNode.insertBefore(e,n))};Util.UserAgentProfiler.isAndroidLt3()||(o("https://connect.facebook.net/en_US/sdk.js","fbjs"),o("https://platform.twitter.com/widgets.js","tweetjs"))}e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent&&e.attachEvent("onload",n)}(window,document,"script"),function(){function t(){d();var e=c,t=n.scrollTop(),o=t>=a,r=!s||s>=t;c=o&&r&&!l,c!==e&&(Chorus.EventDispatcher.publish("fixedSocial",{isFixed:c,position:i.position()}),i.toggleClass("fixed",c))}var i=e("#chorus-social-fixed");if(i.length){i.appendTo("body");var n=e(window),o=e("#chorus-social-fixed-threshold"),r=e("#comments"),a=0,s=0,l=!1,c=!1,d=_.throttle(function(){Chorus.Environment.touch()&&(l=screen.width>window.innerWidth),o.length&&(a=o.offset().top),r.length&&(s=r.offset().top)},1500);e(document).on("scroll",_.throttle(t,150)),t()}}(),e("[data-shareable-content]").each(function(){var t=e(this),i=t.attr("data-original")||t.attr("src");if(!i){var n=this.currentStyle||window.getComputedStyle(this,!1);i=n&&n.backgroundImage.slice(4,-1)}if(i){var r="m-shareable-content",a=r+"__wrap",s=o.pinterest+encodeURIComponent(location.href)+"&media="+encodeURIComponent(i),l=Chorus.Environment.touch()?" touch":"";if(t.is("img")){var c=t.closest("."+a);t=c.length?c:t.wrap('<div class="'+a+'"></div>').parent()}else t.toggleClass(a,!0);t.prepend('<a href="'+s+'" class="'+r+"__pinterest"+l+'" data-analytics-social="pinterest"></a>')}})}(jQuery),jQuery(function(e){e("#newsletter-subscribe").submit(function(t){var i=e("#newsletter-subscribe #email").val(),n=/(.)?@(.)*\./,o=!1,r="";return i&&n.test(i)||(o=!0,r="The email you entered was invalid. Please try again.",i||(r="Please enter your email address in order to subscribe.")),o?(e("#newsletter_error").text(r).show(),!1):(e("#newsletter_error").hide(),!0)})}),Chorus.SocialCount=function(e){function t(){n()}function i(e){if(999>=e)return e;var t=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return 9999>=e?t:999999>=e?t.replace(/(.+)(,\d{3})$/,"$1k"):t.replace(/(.+)(,\d{3}){2}$/,"$1m")}function n(){var t={facebook:o,linkedin:r,pinterest:a};for(var n in t){var s=t[n];"undefined"!=typeof s&&e("[data-"+n+"-share-count-url]").each(function(){var t=e(this);s(t.data(n+"-share-count-url"),function(e){e>0&&(e=i(e),t.data("use-parens")===!1?t.html(e).redraw():t.html("("+e+")").redraw())})})}}function o(e,t){return l[e]?void t(l[e]):void jQuery.getJSON("https://api.facebook.com/method/links.getStats",{urls:encodeURIComponent(e),format:"json"},function(i){var n=i[0].total_count;l[e]=n,t(n)})}function r(t,i){return c[t]?void i(c[t]):void e.ajax({url:"http://www.linkedin.com/countserv/count/share",dataType:"jsonp",data:{url:t,format:"jsonp"},timeout:1e4,success:function(e){c[t]=e.count,i(e.count)}})}function a(t,i){return d[t]?void i(d[t]):void e.ajax({url:"http://widgets.pinterest.com/v1/urls/count.json",dataType:"jsonp",data:{url:t,format:"jsonp"},timeout:1e4,success:function(e){d[t]=e.count,i(e.count)}})}var s={},l={},c={},d={};return e.extend(s,{init:t,initUI:n}),s}(jQuery),jQuery(Chorus.SocialCount.init);var Chorus=Chorus||{};Chorus.MobileAdandSocialMediator=function(e){"use strict";function t(){e(a).css("display","none")}function i(){e(s).css("display","none")}function n(e){var n=e&&e.isFixed,o=e&&e.position&&e.position.top>100;!r&&n&&o&&(r=!0,t(),i())}function o(){Chorus.EventDispatcher.subscribe("fixedSocial",n,!0)}var r=!1,a=".krg-hov-wrapper",s=".crisp_Css_Ad_Cradle, .crispTopAdCradle";return{init:o}}(jQuery),jQuery(function(){Chorus.MobileAdandSocialMediator.init()});var Chorus=Chorus||{};Chorus.Tooltip=function(e){var t="tooltip-text",i="tooltip-class",n=function(t){return t.preventDefault(),e(this).data("tooltip-shown")||o(e(this)),!1},o=function(n){var o=n.data(t),a=n.data(i)||"tooltip",s="tool-tip-"+Math.round(1e3*Math.random());n.data("tooltip-shown",s);var l=n.offset().top+n.height(),c=n.offset().left,d=e("<span id='"+s+"' data-is-tooltip class='"+a+"'>"+o+"</span>");d.on("click",r),d.css({top:l,left:c,position:"absolute"}),Util.UserAgentProfiler.isMobile()&&d.css({left:0}),"undefined"!=typeof o&&""!==o&&(e(document.body).prepend(d),setTimeout(function(){d.addClass("shown")},200))},r=function(t){var i=e(this).data("tooltip-shown")||e(this).filter("is-tooltip").attr("id");if(i){var n=e("#"+i);e(this).removeData("tooltip-shown"),n.removeClass("shown"),setTimeout(function(){n.remove()},1e3)}},a=function(t){e(t).not("[data-tooltip-shown]").on("click",n),e(t).not("[data-tooltip-shown]").on("mouseover",n),e(t).on("mouseout",r)};return{attachTo:a,init:a}}(jQuery),jQuery(function(){Chorus.Tooltip.attachTo("[data-tooltip-text]"),jQuery(document).on("hymnal:render",function(e,t){var i=jQuery(t.ad.getElement()).find("[data-tooltip-text]");Chorus.Tooltip.attachTo(i)})});var Chorus=Chorus||{};Chorus.Modernizr.localstorage&&"object"==typeof sessionStorage&&(Chorus.GBSignal=function(e){"use strict";function t(){Util.isReferrerCurrentDomain()||(C.referralDomain=C.referralDomain||Util.getReferrerDomain())}function i(){C.pagesSeeninSession++}function n(){var e=new Date-new Date(2014,0,0),t=864e5;return Math.floor(e/t)}function o(){C.recordedSessionCount||(v.loyaltySessions.push(n()),C.recordedSessionCount=!0)}function r(){return v.loyaltySessions.length}function a(){var e=v.loyaltySessions.length;if(1>e)return 0;var t=(n()-f,0);for(var i in v.loyaltySessionTimes)v.loyaltySessionTimes.hasOwnProperty(i)&&(t+=v.loyaltySessionTimes[i]);return Math.ceil(t/e)}function s(){var e=n()-f,t={};for(var i in v.loyaltySessionTimes)v.loyaltySessionTimes.hasOwnProperty(i)&&i>e&&(t[i]=v.loyaltySessionTimes[i]);v.loyaltySessionTimes=t,v.loyaltySessions=_.reject(v.loyaltySessions,function(t){return e>t})}function l(){C.updatedAt=new Date,sessionStorage.setItem(p,JSON.stringify(C)),localStorage.setItem(p,JSON.stringify(v))}function c(){C=JSON.parse(sessionStorage.getItem(p)),v=JSON.parse(localStorage.getItem(p)),(null===C||"object"!=typeof C||new Date-C.updatedAt>g)&&(C={},e.extend(C,b)),(null===v||"object"!=typeof v)&&(v={},e.extend(v,w)),d()}function d(){for(var e in w)v[e]=v[e]||w[e];for(e in b)sessionStorage[e]=sessionStorage[e]||b[e]}function u(){if("undefined"!=typeof window.onbeforeunload){var t=new Date,i=function(){var e=Math.round((new Date-t)/1e3);v.loyaltySessionTimes[n()]=(v.loyaltySessionTimes[n()]||0)+e,l()};e(window).on("beforeunload",i)}}function h(){return{loyalty_bsg:r(),avgsestime_bsg:a(),firstimp_bsg:C.pagesSeeninSession,referral_bsg:C.referralDomain}}function m(){var e=[],t=h();for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));var n="http://js.moatads.com/essencedigital34895338176918191/moatcontent.js?"+e.join("&"),o=document.getElementsByTagName("script")[0],r=document.createElement("SCRIPT");r.async=1,r.type="text/javascript",r.charset="UTF-8",r.src=n,o.parentNode.insertBefore(r,o)}var p="GBSignal",f=30,g=18e5,v={loyaltySessions:[],loyaltySessionTimes:{}},w={};e.extend(w,v);var C={referralDomain:null,pagesSeeninSession:0,recordedSessionCount:!1,updatedAt:new Date},b={};return e.extend(b,C),{init:function(){c(),u(),t(),s(),i(),o(),l(),m()},results:function(){return h()}}}(jQuery),Chorus.GBSignal.init());var Chorus=Chorus||{};Chorus.DataStore=function(e){"use strict";function t(e){if(null===e||void 0===e)return null;var t=e.toLowerCase();if("true"===t||e===!0)return!0;if("false"===t||e===!1)return!1;if(!isNaN(parseFloat(e)))return parseFloat(e);try{var i=Json.parse(e);return i}catch(n){return e}}function i(t,i){return Chorus.Modernizr.localstorage?(localStorage.setItem(t,i),!0):e.cookie?(e.cookie(t,i),!0):(console.error("there was an error storing "+t+" : "+i),!1)}function n(i,n){var o,r=n||!1;return Chorus.Modernizr.localstorage?o=t(localStorage.getItem(i)):e.cookie?o=e.cookie(i):console.error("there was an error retrieving "+i),r===!0?t(o):o}return{set:function(e,t){return i(e,t)},get:function(e){return n(e)}}}(jQuery);var Chorus=Chorus||{};Chorus.EntryResponsiveVideo=function(e){function t(){i(e(o)),e(a).each(n)}function i(e){e.find(r).each(n)}function n(){var t="";return $this=e(this),$this.hasClass("no-responsive-video")||$this.parents(".no-responsive-video").length?!0:(/instagram\.com/.test($this.attr("src"))?(t=" instagram",$this.wrap('<div class="instagram-wrap"></div>')):/vine\.co/.test($this.attr("src"))&&(t=" vine"),$this.find("object, embed, video").attr("width","100%").attr("height","100%"),$this.find("div.OoyalaHtml5VideoPlayer").css({width:"100%",height:"100%"}),$this.removeAttr("width").removeAttr("height").wrap('<div class="p-scalable-video'+t+'"></div>'),!0)}var o=".m-entry__body, .m-stream__update, .feature-body",r=['iframe[src*="youtube.com"]','iframe[src*="vine.co"]','iframe[src*="ooyala.com"]'].join(","),a=["div[id*=ooyalaPlayer]",".m-video__pane iframe",".mceItemFlash",".m-block__fanshot-media.video iframe",".m-block__fanshot-media.video object",".sbn-body-feature .sbn-feature-entry .feature-body iframe"].join(",");return{wrapVideosInEntryBody:function(e){setTimeout(function(){i(e)},1e3)},init:function(){setTimeout(t,1e3)}}}(jQuery),jQuery(Chorus.EntryResponsiveVideo.init);var Vox=Vox||{};Vox.GlobalHeader=function(e){function t(e){e.stopPropagation(),d.toggleClass("show"),c.toggleClass("open"),Chorus.Analytics.event("nav","link:desktop:toggle")}function i(e){e.stopPropagation(),e.preventDefault(),d.toggleClass("show"),h.toggleClass("open"),p.toggleClass(u),Chorus.Analytics.event("nav","link:mobile:toggle")}function n(){d.removeClass("show"),c.removeClass("open")}function o(){window.innerWidth>m?(c.off("click").on("click",t),p.off("click").on("click",n)):h.off("click").on("click",i)}function r(){var t=e(window.innerwidth)<=m,i=t?"mobile":"desktop";Chorus.Analytics.event("nav","link:"+i+":nav",e(this).text())}var a="#global-header__tab",s=".m-global-header__user-items",l="usernav-active",c=e(".js-toggle-dropdown"),d=e(".m-global-header__dropdown--list"),u="dropdown-open",h=e(".m-global-header__dropdown--hamburger"),m=678,p=e("body");return{init:function(){e(a).on("click",function(){e(s).toggleClass(l)}),e(".m-global-header__dropdown--list a").on("click",r),o(),e(window).resize(_.debounce(o,250))}}}(jQuery),jQuery(function(){Vox.GlobalHeader.init()});var Vox=Vox||{};Vox.FrontPage=function(e){function t(t){if(Chorus&&Chorus.DynamicSizedImages){var t=t||e(f+", "+v+","+w),i={parentDimensionSlc:".m-hp-block__container, .m-breaker-block__image"};Chorus.DynamicSizedImages.applyTo(t,i),o(e(p),f)}}function i(){if(E){e("img.lazy-loaded").removeClass("lazy-loaded"),e("img.lazy-loading").removeClass("lazy-loading");var i=e(g+","+f);t(i)}E=!0}function n(e){e.find("img.lazy-loaded").removeClass("lazy-loaded"),e.find("img.lazy-loading").removeClass("lazy-loading"),t(e)}function o(t,i){t.find("div[data-overlay]").each(function(){var t=e(this),n=t.data("overlay");n&&t.closest(i).addClass(n)})}function r(e,t,i){if(0==e.length)return t;var n={3:{4:3,"3-1":Math.min(t,2),"1-3":Math.min(t,2),"2-2":1==i?1:2,"1-1-2":1,"1-2-1":1,"2-1-1":1,"1-1-1-1":1==i||2==i?2:1},2:{4:2,"1-3":1,"3-1":1,"1-2-1":2==i?2:1}},o=l()+"";return n[o]&&n[o][e]&&(t=n[o][e]),t}function a(t){var i=l();(i!=m||t)&&(m=i,e(p).each(function(t,n){var o=e(n),a=o.find(f);a.removeClass(k.join(" "));var s=[];(2==i||3==i)&&(a.each(function(t,i){s.push(e(i).data("width"))}),s=s.join("-")),a.each(function(t,i){var n=e(i),o=n.data("width");o=r(s,o,t),n.addClass(k[o-1])})}))}function s(){a(),i(),u()}function l(){var e=window.innerWidth;return e>=x?4:e>=y?3:e>=b?2:1}function c(){var t=e(C);if(t.length>0){var i=t.closest(p),n=t.siblings().detach();i.prepend(n)}}function d(t){var i="div-gpt-ad-med_rec_ad_container",n=+t.size[1]-e("#"+i).height();if(t.size[1]<=250&&10>=n){var o=e(C).find(".m-hp-block__container");if(o.length>0){var r=e("<img>").attr("src","/images/vox/promos/med-rec-racked.jpg"),a=e("<a>").attr("href","http://www.racked.com").html(r),s=e('<div class="m-hp-ad-placeholder">').html(a);(t.isEmpty||1==t.size[0]||1==t.size[1])&&s.addClass("m-hp-ad-placeholder-top"),o.append(s)}}}function u(){var t=window.innerWidth,i=e(".m-hp-latest__list").outerHeight(!0),n=e(".m-hp-block__container").height(),o=e(".m-hp-latest__title").outerHeight(!0),r=e(".m-hp-block__more").outerHeight(!0),a=n-o-r,s=t>=b&&i>=a;e(".m-hp-latest__list li:last-child").toggleClass("is-hidden",s)}function h(t){var i=function(t){var i=e(this),n=i.index(),o=-100*n+"%";i.closest("div").find(".m-breaker-blocks").animate({left:o},400),i.siblings().removeClass("m-breaker-blocks__nav--active"),i.addClass("m-breaker-blocks__nav--active")};t.on("click",i)}var m,p=".m-hp-blocks",f=".m-hp-block",g=".m-breaker-block",v=".river",w=".has-rail",C=".m-hp-ad",b=678,y=1017,x=1356,k=["c1","c2","c3","c4"],E=!1;return{init:function(){c(),s(),t(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("dfp:adRendered:med_rec",d),e(window).resize(_.debounce(s,175)),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(t){var i,r=t.modules;r.length>0&&(r.first().hasClass("m-breaker")?i=r.first():(i=e(r[1]).find(".m-breaker"),0==i.length&&(i=e(r[3]).find(".m-breaker")))),i&&i.hasClass("m-breaker")&&(i.hasClass("m-breaker-beats")?(n(i),o(i,".m-breaker-block")):i.hasClass("m-breaker-icons")&&(e(".m-breaker-blocks__nav li:first-child").addClass("m-breaker-blocks__nav--active"),h(e(".m-breaker-blocks__nav li"))))})}}}(jQuery),jQuery(function(){"undefined"==typeof Chorus.Context.entry_id&&Vox.FrontPage.init()});var Vox=Vox||{};Vox.UserProfile=function(e){return{init:function(){var t=e(".m-profile");t.length<1||this.config(function(){Vox.UserProfile.activityToggle.on("click","a",Vox.UserProfile.toggleActivity),Vox.UserProfile.adminLinkToggle.on("change",Vox.UserProfile.gotoAdminLink),Vox.UserProfile.coloredRows(Vox.UserProfile.activityTableClass,"tr"),Vox.UserProfile.activityToggle.find("a:first").trigger("click")})},config:function(t){this.activityToggle=e("#filter-pane-toggle"),this.profileRail=e(".m-filter-pane__rail"),this.profileRiver=e(".m-filter-pane__content"),this.activityTable=e(".m-profile__activity-table"),this.activityTableClass=".m-profile__activity-table",
this.adminLinkToggle=e("#profile-meta-link-toggle"),this.selectedClass="is-selected",this.disabledClass="is-disabled",this.favoriteClass="is-favorite",this.oddClass="odd",t()},gotoAdminLink:function(t){var i=e(this).val();""!==i&&(window.location=i)},toggleActivity:function(){if(e(this).parent().hasClass(Vox.UserProfile.disabledClass))return!1;var t=e(this).data("type");if(!_.isUndefined(t)){var i=Vox.UserProfile.activityTable.length,n=i?Vox.UserProfile.activityTable.find("tr"):Vox.UserProfile.profileRiver.find(".m-block"),o=e(this).parents(Vox.UserProfile.activityToggle.selector).find("li");return o.removeClass(Vox.UserProfile.selectedClass),e(this).parent().addClass(Vox.UserProfile.selectedClass),i&&n.removeClass(Vox.UserProfile.oddClass),n.hide(),"all"===t?n.show():n.filter("."+t+", ."+t.toLowerCase()).show(),i&&Vox.UserProfile.coloredRows(Vox.UserProfile.activityTableClass,"tr"),!1}},coloredRows:function(t,i){e(t).find(i).filter(":visible").each(function(t,i){t%2&&e(this).addClass("odd")})}}}(jQuery),jQuery(function(){Vox.UserProfile.init()});var Vox=Vox||{};Vox.Search=function(){function e(){i=$(".m-search-nav__input").hasClass("expanded")?!0:!1}function t(){n=0!==$(".m-search-nav__input").val().length?!0:!1}var i=!1,n=!1;return{init:function(){$(".m-search-nav__submit").on("click",function(o){e(),t(),i===!1?(o.preventDefault(),$(".m-search-nav__input").addClass("expanded")):i===!0&&n===!1&&(o.preventDefault(),$(".m-search-nav__input").removeClass("expanded"))})},mobileInit:function(){$(".m-search-nav__submit").on("click",function(e){e.preventDefault(),location.href="/results"})}}}(jQuery),jQuery(function(){$(window).width()<880?Vox.Search.mobileInit():Vox.Search.init()}),jQuery(function(){$(".m-entry__social-more").on("click",function(){$(this).siblings($(".m-entry__social-secondary")).toggleClass("show"),$(this).toggleClass("transform")})});var Vox=Vox||{};Vox.SocialPromo=function(e){"use strict";function t(){setTimeout(function(){0===e(".m-chorus-modal__wrapper").length&&(Chorus.EventDispatcher.publish("modal_open",{content:s,modalClass:"m-social-promo__modal-container"}),i(s))},u)}function i(e){e.hasClass("facebook")&&d.append(c)}function n(){setTimeout(function(){l.addClass("show"),i(l)},u)}function o(){l.removeClass("show")}function r(t,i){e("body").hasClass("debug")||Chorus.DataStore.set(t,i)}function a(e){return Chorus.DataStore.get(e)}var s=e(".m-social-promo__modal"),l=e(".m-social-promo__slide-out"),c='<img src="/images/vox/facebook_like.gif">',d=e(".m-social-promo__gif"),u=7e3,h=a("seenModal"),m=a("seenSlideout");return{init:function(){"true"!==h&&s.length>0&&(t(),r("seenModal","true")),"true"!==m&&l.length>0&&(n(),e(".m-social-promo__close").on("click",o),r("seenSlideout","true"))}}}(jQuery),jQuery(function(){"undefined"!=typeof Chorus.Context.entry_id&&Vox.SocialPromo.init()});var Vox=Vox||{};Vox.FeedbackPrompt=function(){var e="m-feedback-prompt__button--active",t=function(t){t.preventDefault();var i=$(t.currentTarget),n=i.siblings(".m-feedback-prompt__display.yes"),o=i.siblings(".m-feedback-prompt__display.no");i.hasClass("yes")?(o.removeClass("show"),n.toggleClass("show")):(n.removeClass("show"),o.toggleClass("show")),i.toggleClass(e).siblings().removeClass(e)};return{init:function(e){$(e).on("click",t)},toggleFeedbackPrompt:t}}(jQuery),jQuery(function(){var e=".m-entry__feedback .m-feedback-prompt__button";Vox.FeedbackPrompt.init(e)});var Vox=Vox||{};Vox.Toggle=function(e){var t=window.location.hash.slice(1),i=e("toggles");if(i.length>0)var n=i.html().split(",");var o=function(){i.addClass("clearfix"),i.empty(),n.forEach(function(t){i.append('<a href="javascript:void(0);" mce_href="javascript:void(0);" data-name="'+t+'">'+t+"</a>");var o=e.inArray(t,n),r=n.length-1;o===r?o=0:o+=1;var a=/photo|image|slideshow/.test(n[o])?"See":"Read";e(t).append('<p><em><a class="toggle-bottom" data-name="'+n[o]+'" href="javascript:void(0);" mce_href="javascript:void(0);">'+a+" the "+n[o]+"</a></em></p> ")})},r=function(){if(t){var i=e("toggles a[data-name='"+t+"']");i.addClass("toggle-selected");var o=e.inArray(t,n);n.splice(o,1),n.forEach(function(t){e(t).hide()})}else e("toggles a:first-child").addClass("toggle-selected"),n.splice(0,1),n.forEach(function(t){e(t).hide()})},a=function(){var t=e(this).data("name");e('meta[property="og:title"]').attr("content")||document.title;window.location.hash=t,"toggle-bottom"==e(this).attr("class")&&e("body").animate({scrollTop:e("toggles").offset().top},0),e("toggles a").removeClass("toggle-selected"),e('toggles a[data-name="'+t+'"]').addClass("toggle-selected");var i=(e("toggles a").each(function(t){var i=e(this).data("name");e(i).hide()}),e(t).show());Chorus.DynamicSizedImages.applyTo(i)},s=function(){if(i.length>0){i.html().split(",");o(),r(),e("toggles a, .toggle-bottom").on("click",a)}};s()}(jQuery);var Vox=Vox||{};Vox.Rating=function(e){var t=function(t){e(t).each(function(t,i){e(i).html(e("<span>").width(25*e(i).text()))})},i=function(){t(".rating-number")};i()}(jQuery);var Vox=Vox||{};Vox.InlineVideoOverlay=function(e){function t(){s.each(function(){r=e(this).children().find(".chorus-video-embed").data("chorus-video-id"),d.push(r)})}function i(){for(var e=0;e<d.length;e++)Chorus.VideoContext.destroyPlayer(d[e])}function n(){o=e(this).parent().find(".chorus-video-embed").data("chorus-video-id"),a="chorus-video-"+o,e(this).parent().find(l,c).hide(),Chorus.VideoContext.createPlayer(a,o,{autoplay:!0})}var o,r,a,s=e(".s-video-overlay__container"),l=e(".s-video-overlay__header-container"),c=e(".s-video-overlay__image"),d=[];return{init:function(){t(),Chorus.EventDispatcher.subscribe("ooyalaPlayerLoaded",function(e){i(),l.on("click",n)})}}}(jQuery),jQuery(function(){$(window).width()>728&&Vox.InlineVideoOverlay.init()});var Vox=Vox||{};if(Vox.ShareQuotes=function(e){"use strict";function t(){e(".s-share-quote").each(function(){i=encodeURIComponent(e(this).find(".s-share-quote__text").html());var t="https://www.facebook.com/sharer/sharer.php?u="+n,o="https://twitter.com/intent/tweet?text="+i+"&url="+n;e(this).append('<div class="s-share-quote__social"><a class="p-button-social has-icon twitter" href="'+o+'" data-analytics-social="twitter" data-analytics-link="pullquote-share"><span class="p-button-social__social-text">Tweet</span></a><a class="p-button-social has-icon facebook" href="'+t+'" data-analytics-social="facebook" data-analytics-link="pullquote-share"><span class="p-button-social__social-text">Share</span></a></div>')})}var i,n=e('meta[property="og:url"]').attr("content");return{init:function(){t()}}}(jQuery),jQuery(function(){"undefined"!=typeof Chorus.Context.entry_id&&Vox.ShareQuotes.init()}),window.Chorus=window.Chorus||{},window.Chorus.Mpulse=function(e){var t=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},i=0,n=function(){var n=e.cookie("mpulse_source");void 0==n&&(n="");try{if(""==n){var o=window.location.href.split("?")[0].split("/")[3];if(""==o&&(n="organic"),""==n&&(n=t("utm_source")),""==n){var r=document.referrer.split("/");r.size>2&&(n=r[2])}""==n&&(n="other"),e.cookie("mpulse_source",n,{path:"/"}),i=1}else i=0}catch(a){}return n},o=function(){var t=e.cookie("video_play_count");return void 0==t&&(t=0),e.cookie("video_play_count",t,{path:"/"}),t};return{source:n(),video_play_count:o(),first_page:i}}(jQuery),"organic"==Chorus.Mpulse.source||"facebook"==Chorus.Mpulse.source||"twitter"==Chorus.Mpulse.source)var mpulse_ab=Chorus.Mpulse.source+Chorus.Mpulse.first_page;else var mpulse_ab="other"+Chorus.Mpulse.first_page;Chorus.EventDispatcher.subscribe("ooyalaVideoPlay",function(){Chorus.Mpulse.video_play_count++,$.cookie("video_play_count",Chorus.Mpulse.video_play_count,{path:"/"})}),jQuery(function(){var e=jQuery(".m-entry-feature__headline, .m-entry__title");e.length>0&&(e=e.html(e.html().trim().replace(/&nbsp;/g," ")))}),jQuery(function(e){var t=[],i="38,38,40,40,37,39,37,39,66,65";e(document).keydown(function(e){t.push(e.keyCode),t.toString().indexOf(i)>=0?(t=[],location.href="/cards/super-super-super-secret-easter-eggs/whats-an-easter-egg#5351903"):t.length>20&&(t=[])})}),/*! Hammer.JS - v1.0.6 - 2014-01-02
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
function(e,t){"use strict";function i(){n.READY||(n.event.determineEventTypes(),n.utils.each(n.gestures,function(e){n.detection.register(e)}),n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0)}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&e.navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=e.document,n.plugins=n.plugins||{},n.gestures=n.gestures||{},n.READY=!1,n.utils={extend:function(e,i,n){for(var o in i)e[o]!==t&&n||(e[o]=i[o]);return e},each:function(e,i,n){var o,r;if("forEach"in e)e.forEach(i,n);else if(e.length!==t){for(o=0,r=e.length;r>o;o++)if(i.call(n,e[o],o,e)===!1)return}else for(o in e)if(e.hasOwnProperty(o)&&i.call(n,e[o],o,e)===!1)return},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],i=[];return n.utils.each(e,function(e){t.push("undefined"!=typeof e.clientX?e.clientX:e.pageX),i.push("undefined"!=typeof e.clientY?e.clientY:e.pageY)}),{pageX:(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(e,t,i){return{x:Math.abs(t/e)||0,y:Math.abs(i/e)||0}},getAngle:function(e,t){var i=t.pageY-e.pageY,n=t.pageX-e.pageX;return 180*Math.atan2(i,n)/Math.PI},getDirection:function(e,t){var i=Math.abs(e.pageX-t.pageX),o=Math.abs(e.pageY-t.pageY);return i>=o?e.pageX-t.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:e.pageY-t.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(e,t){var i=t.pageX-e.pageX,n=t.pageY-e.pageY;return Math.sqrt(i*i+n*n)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==n.DIRECTION_UP||e==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){t&&e&&e.style&&(n.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(i){n.utils.each(t,function(t){i&&(t=i+t.substring(0,1).toUpperCase()+t.substring(1)),t in e.style&&(e.style[t]=t)})}),"none"==t.userSelect&&(e.onselectstart=function(){return!1}),"none"==t.userDrag&&(e.ondragstart=function(){return!1}))}},n.Instance=function(e,t){var o=this;return i(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){o.enabled&&n.detection.startDetect(o,e)}),this},n.Instance.prototype={on:function(e,t){var i=e.split(" ");return n.utils.each(i,function(e){this.element.addEventListener(e,t,!1)},this),this},off:function(e,t){var i=e.split(" ");return n.utils.each(i,function(e){this.element.removeEventListener(e,t,!1)},this),this},trigger:function(e,t){t||(t={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t;var o=this.element;return n.utils.hasParent(t.target,o)&&(o=t.target),o.dispatchEvent(i),this},enable:function(e){return this.enabled=e,this}};var o=null,r=!1,a=!1;n.event={bindDom:function(e,t,i){var o=t.split(" ");n.utils.each(o,function(t){e.addEventListener(t,i,!1)})},onTouch:function(e,t,i){var s=this;this.bindDom(e,n.EVENT_TYPES[t],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!a){c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which?r=!0:c.match(/mouse/)&&!l.which&&(r=!1),c.match(/touch|pointer/)&&(a=!0);var d=0;r&&(n.HAS_POINTEREVENTS&&t!=n.EVENT_END?d=n.PointerEvent.updatePointer(t,l):c.match(/touch/)?d=l.touches.length:a||(d=c.match(/up/)?0:1),d>0&&t==n.EVENT_END?t=n.EVENT_MOVE:d||(t=n.EVENT_END),(d||null===o)&&(o=l),i.call(n.detection,s.collectEventData(e,t,s.getTouchList(o,t),l)),n.HAS_POINTEREVENTS&&t==n.EVENT_END&&(d=n.PointerEvent.updatePointer(t,l))),d||(o=null,r=!1,a=!1,n.PointerEvent.reset())}})},determineEventTypes:function(){var e;e=n.HAS_POINTEREVENTS?n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=e[0],n.EVENT_TYPES[n.EVENT_MOVE]=e[1],n.EVENT_TYPES[n.EVENT_END]=e[2]},getTouchList:function(e){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():e.touches?e.touches:(e.identifier=1,[e])},collectEventData:function(e,t,i,o){var r=n.POINTER_TOUCH;return(o.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,o))&&(r=n.POINTER_MOUSE),{center:n.utils.getCenter(i),timeStamp:(new Date).getTime(),target:o.target,touches:i,eventType:t,pointerType:r,srcEvent:o,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return n.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var i=t.pointerType,o={};return o[n.POINTER_MOUSE]=i===t.MSPOINTER_TYPE_MOUSE||i===n.POINTER_MOUSE,o[n.POINTER_TOUCH]=i===t.MSPOINTER_TYPE_TOUCH||i===n.POINTER_TOUCH,o[n.POINTER_PEN]=i===t.MSPOINTER_TYPE_PEN||i===n.POINTER_PEN,o[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:n.utils.extend({},t),lastEvent:!1,name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst.options;return n.utils.each(this.gestures,function(i){return this.stopped||t[i.name]===!1||i.handler.call(i,e,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=e),e.eventType==n.EVENT_END&&!e.touches.length-1&&this.stopDetect(),e}},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(e){var t=this.current.startEvent;!t||e.touches.length==t.touches.length&&e.touches!==t.touches||(t.touches=[],n.utils.each(e.touches,function(e){t.touches.push(n.utils.extend({},e))}));var i,o,r=e.timeStamp-t.timeStamp,a=e.center.pageX-t.center.pageX,s=e.center.pageY-t.center.pageY,l=n.utils.getVelocity(r,a,s);return"end"===e.eventType?(i=this.current.lastEvent&&this.current.lastEvent.interimAngle,o=this.current.lastEvent&&this.current.lastEvent.interimDirection):(i=this.current.lastEvent&&n.utils.getAngle(this.current.lastEvent.center,e.center),o=this.current.lastEvent&&n.utils.getDirection(this.current.lastEvent.center,e.center)),n.utils.extend(e,{deltaTime:r,deltaX:a,deltaY:s,velocityX:l.x,velocityY:l.y,distance:n.utils.getDistance(t.center,e.center),angle:n.utils.getAngle(t.center,e.center),interimAngle:i,direction:n.utils.getDirection(t.center,e.center),interimDirection:o,scale:n.utils.getScale(t.touches,e.touches),rotation:n.utils.getRotation(t.touches,e.touches),startEvent:t}),e},register:function(e){var i=e.defaults||{};return i[e.name]===t&&(i[e.name]=!0),n.utils.extend(n.defaults,i,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(e,t){if(n.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void(this.triggered=!1);if(!(t.options.drag_max_touches>0&&e.touches.length>t.options.drag_max_touches))switch(e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(e.distance<t.options.drag_min_distance&&n.detection.current.name!=this.name)return;if(n.detection.current.name!=this.name&&(n.detection.current.name=this.name,t.options.correct_for_drag_min_distance&&e.distance>0)){var i=Math.abs(t.options.drag_min_distance/e.distance);n.detection.current.startEvent.center.pageX+=e.deltaX*i,n.detection.current.startEvent.center.pageY+=e.deltaY*i,e=n.detection.extendEventData(e)}(n.detection.current.lastEvent.drag_locked_to_axis||t.options.drag_lock_to_axis&&t.options.drag_lock_min_distance<=e.distance)&&(e.drag_locked_to_axis=!0);var o=n.detection.current.lastEvent.direction;e.drag_locked_to_axis&&o!==e.direction&&(n.utils.isVertical(o)?e.direction=e.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:e.direction=e.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),t.trigger(this.name+e.direction,e),(t.options.drag_block_vertical&&n.utils.isVertical(e.direction)||t.options.drag_block_horizontal&&!n.utils.isVertical(e.direction))&&e.preventDefault();break;case n.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(e,t){switch(e.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==n.detection.current.name&&t.trigger("hold",e)},t.options.hold_timeout);break;case n.EVENT_MOVE:e.distance>t.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==n.EVENT_END&&t.trigger(this.name,e)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(e,t){if(e.eventType==n.EVENT_END){if(t.options.swipe_max_touches>0&&e.touches.length<t.options.swipe_min_touches&&e.touches.length>t.options.swipe_max_touches)return;(e.velocityX>t.options.swipe_velocity||e.velocityY>t.options.swipe_velocity)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(e,t){if(e.eventType==n.EVENT_END&&"touchcancel"!=e.srcEvent.type){var i=n.detection.previous,o=!1;if(e.deltaTime>t.options.tap_max_touchtime||e.distance>t.options.tap_max_distance)return;i&&"tap"==i.name&&e.timeStamp-i.lastEvent.timeStamp<t.options.doubletap_interval&&e.distance<t.options.doubletap_distance&&(t.trigger("doubletap",e),o=!0),(!o||t.options.tap_always)&&(n.detection.current.name="tap",t.trigger(n.detection.current.name,e))}}},n.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(e,t){return t.options.prevent_mouseevents&&e.pointerType==n.POINTER_MOUSE?void e.stopDetect():(t.options.prevent_default&&e.preventDefault(),void(e.eventType==n.EVENT_START&&t.trigger(this.name,e)))}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(e,t){if(n.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void(this.triggered=!1);if(!(e.touches.length<2))switch(t.options.transform_always_block&&e.preventDefault(),e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-e.scale),o=Math.abs(e.rotation);if(i<t.options.transform_min_scale&&o<t.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),o>t.options.transform_min_rotation&&t.trigger("rotate",e),i>t.options.transform_min_scale&&(t.trigger("pinch",e),t.trigger("pinch"+(e.scale<1?"in":"out"),e));break;case n.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return n}):"object"==typeof module&&"object"==typeof module.exports?module.exports=n:e.Hammer=n}(this);var Vox=Vox||{};Vox.Explainers=_.extend({},Backbone.Events,{Views:{},initialize:function(){$("[data-explainer]").each(function(){Vox.Explainers.embed(this)})},embed:function(e){"undefined"!=typeof Chorus&&Chorus.Analytics&&Chorus.Analytics.disableScrollDepth(),new Vox.Explainers.Views.Embed({el:e}).render()}}),jQuery(function(){Vox.Explainers.initialize()}),Vox.Explainers.Model=Backbone.Model.extend({initialize:function(e,t){this.cards=new Backbone.Collection(e.cards),this.cards.url=this.get("url"),this.active_card=e.cards[e.active_index]},url:function(){return this.get("url")+".json"},parse:function(e){for(var t=e.cards.length;t--;)if(this.active_card&&e.cards[t].id==this.active_card.id){e.cards[t]=this.active_card;break}return this.cards.set(e.cards,{remove:!1}),delete e.cards,e}}),Vox.Explainers.Views.Card=Backbone.View.extend({tagName:"li",templateId:"explainers-card-template",className:"m-explainer__card",feedbackPromptSlc:".m-explainer__card__prompt",events:{scroll:"onScroll","click .m-feedback-prompt__button":"toggleFeedbackPrompt"},initialize:function(){this.listenTo(this.model,"change",this.render)},attributes:function(){return{"data-id":this.model.id}},onScroll:function(e){$(e.target).parent().trigger("scroll")},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e,t,i,n;return _.isNumber(this.options.index)&&(e=this.options.index+1,t=this.model.collection.at(this.options.index-1),i=this.model.collection.at(this.options.index+1)),n=_.extend({prevTitle:t&&t.get("title"),nextTitle:i&&i.get("title"),prevUrl:t&&t.get("url"),nextUrl:i&&i.get("url"),shareUrl:encodeURIComponent(this.model.get("share_url")+window.location.hash),position:e,fullUrl:this.model.get("url"),total:this.options.total},this.model.toJSON()),n.url&&(n.url=encodeURIComponent(n.url+window.location.hash)),this.$el.html(this.template(n)),this.$el.find(".m-explainer__card-content a[href^='http']").attr("target","_blank"),this.$el.find(".chorus-video-embed").each(function(){$(this).attr("id","cardstack-chorus-video-"+$(this).data("chorus-video-id"))}),Chorus.VideoContext.addVideo(n.chorus_videos||[]),this.model.get("isEmbedded")||this.renderFeedbackPrompt(),this},renderFeedbackPrompt:function(){var e=new Vox.Explainers.Views.FeedbackPrompt({model:this.model});e.render();e.$el.html().trim();return this.$el.find(this.feedbackPromptSlc).append(e.render().el),this},toggleFeedbackPrompt:function(e){Vox&&Vox.FeedbackPrompt&&Vox.FeedbackPrompt.toggleFeedbackPrompt(e)}}),Vox.Explainers.Views.Explore=Vox.Explainers.Views.Card.extend({searchUrl:"/cardstacks/search",cardStacksUrl:"/cards.json",isFetchingCardStacks:!1,isSearching:!1,isCurrentCard:!1,pagesFetched:0,templateId:"explainers-explore-template",className:"m-explainer__card m-explainer-explore",events:{"keydown input.m-explainer-explore__nav__input":"search","focus input.m-explainer-explore__nav__input":"onSearchInputFocus","blur input.m-explainer-explore__nav__input":"enableKeyboardNavigation","click .m-explainer-explore__no-results__submit button":"submitQuery"},resultsSlc:"#__results",searchInputSlc:"#__query",browseHeaderSlc:"#cards_browse_copy",noResultsSubmitSlc:".m-explainer-explore__no-results__submit",suggestedResultsLimit:6,infiniteScrollTimerInterval:250,infiniteScrollTimer:void 0,initialize:function(e){e=$.extend({},e),_.bindAll(this,"search","checkScroll"),this.model=e.model,this.initialCardStacks=e.initialCardStacks||[],this.suggestedCardStacks=new Backbone.Collection({model:Backbone.Model}),this.chorusImageId=e.chorusImageId,this.backgroundSlc=e.backgroundSlc,this.binderEffectHasTriggered=!1,this.exploreCardMode=e.exploreCardMode,this.parentView=e.parentView,this.listenTo(this.collection,"reset add",this.renderResults),this.initInfiniteScroll()},template:function(e){var t=$("#"+this.templateId).html();return _.template(t,e)},submitQuery:function(){return $(this.noResultsSubmitSlc).html("<p>Thanks for submitting a new card stack topic! We're constantly adding new card stacks and have added your term for review.</p>"),$(this.searchInputSlc).val("").focus(),!1},enableKeyboardNavigation:function(){this.parentView&&(this.parentView.events.keydown=this.parentView.events.keydown.replace("__disabled__",""),this.parentView.delegateEvents(this.parentView.events))},onSearchInputFocus:function(){return this.disableKeyboardNavigation(),0==Util.UserAgentProfiler.isIOS()&&this.binderEsqueEffect(),!1},binderEsqueEffect:function(){if(!this.binderEffectHasTriggered){this.binderEffectHasTriggered=!0;var e=$(this.searchInputSlc),t="search ".split("").reverse(),i=[];window.setTimeout(function(){var n=function(){var n=t.pop();"undefined"==typeof n?(window.clearInterval(o),window.setTimeout(function(){e.attr("placeholder","")},500)):(i+=n,e.attr("placeholder",i))},o=window.setInterval(n,150)},500)}},disableKeyboardNavigation:function(){if(this.parentView){var e=this.parentView.undelegateEvents().events;e.keydown=e.keydown+"__disabled__",this.parentView.delegateEvents(e)}},enableInfiniteScroll:function(){"undefined"==typeof this.infiniteScrollTimer&&(this.infiniteScrollTimer=window.setInterval(this.checkScroll,this.infiniteScrollTimerInterval),this.pagesFetched=0)},disableInfiniteScroll:function(){"undefined"!=typeof this.infiniteScrollTimer&&(window.clearInterval(this.infiniteScrollTimer),this.infiniteScrollTimer=void 0)},render:function(e){return this.$el.html(this.template({exploreCardMode:this.exploreCardMode})),this.applyBackgroundImage(),0==Util.UserAgentProfiler.isIOS()&&this.$el.find(this.searchInputSlc).focus(),0==this.initialCardStacks.length?this.fetchCardStacks({},function(e){this.initialCardStacks=e,this.collection.reset(this.initialCardStacks),this.populateSuggestedCardStacks(this.initialCardStacks)}.bind(this)):(this.collection.reset(this.initialCardStacks),this.populateSuggestedCardStacks(this.initialCardStacks)),e&&e(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("explore:rendered",{},!0),this},fetchCardStacks:function(e,t){this.isFetchingCardStacks=!0,$.getJSON(this.cardStacksUrl,e,function(e){this.isFetchingCardStacks=!1,t&&t(e)}.bind(this))},populateSuggestedCardStacks:function(e){this.suggestedCardStacks.reset(e.slice(0,3))},renderResults:function(){var e=new Vox.Explainers.Views.ExploreResults({collection:this.collection,suggestedCardStacks:this.suggestedCardStacks});e.render();var t=e.$el.html().trim();return this.$el.find(this.resultsSlc).html(t),this},applyBackgroundImage:function(){if(this.chorusImageId&&this.backgroundSlc){var e=this.chorusImageId+":standard:1",t=$(this.backgroundSlc);t.attr("data-imgkey",e),t.addClass("vox-lazy-load"),Chorus.DynamicSizedImages.applyTo()}},search:_.debounce(function(){this.isSearching=!0;var e=$(this.searchInputSlc),t=e.val().trim(),i=2;t.length>=i?(this.model.trigger("explore:out_of_view"),$.get(this.searchUrl,{query:t},function(e){$(this.browseHeaderSlc).addClass("hide"),this.collection.reset(e),Chorus.Analytics.event("cardstack-explore","cardstack:search",encodeURIComponent(t),e.length)}.bind(this))):0==t.length&&($(this.browseHeaderSlc).removeClass("hide"),this.isSearching=!1,this.model.trigger("explore:in_view"))},300),initInfiniteScroll:function(){this.listenTo(this.model,"explore:in_view",function(){this.collection.reset(this.initialCardStacks),this.isCurrentCard=!0,this.enableInfiniteScroll()}.bind(this)),this.listenTo(this.model,"explore:out_of_view",function(){this.isCurrentCard=!1,this.disableInfiniteScroll()}.bind(this)),this.exploreCardMode||this.model.trigger("explore:in_view")},canUseInfiniteScroll:function(){var e=!this.isSearching&&!this.isFetchingCardStacks&&-1!=this.pagesFetched;return this.exploreCardMode&&(e=e&&this.isCurrentCard),e},checkScroll:function(){if(this.canUseInfiniteScroll()){var e=$(".m-explainer-explore .m-explainer__card-wrapper").outerHeight(!0),t=$(window).height(),i=this.$el.scrollTop(),n=300,o=e-t-i;if(n>=o){var r={page:this.pagesFetched+1};this.fetchCardStacks(r,function(e){e.length>0?(this.collection.add(e),this.pagesFetched++):(this.disableInfiniteScroll(),this.pagesFetched=-1)}.bind(this))}}}}),Vox.Explainers.Views.Share=Vox.Explainers.Views.Card.extend({templateId:"explainers-share-template",embedTextBoxSlc:'.m-explainer__embed-code[data-type="card"]',events:{"click .m-explainer__share-card .m-explainer__share-card--embed":"toggleShareEmbedTextBox"},initialize:function(e){e=$.extend({},e),this.model=e.model},render:function(){return data=_.extend({},this.model.toJSON()),this.$el.html(this.template(data)),this},toggleShareEmbedTextBox:function(e){e&&e.preventDefault(),e.stopPropagation();var t=$(this.embedTextBoxSlc);t.toggleClass("show"),t.hasClass("show")&&t.select()}}),Vox.Explainers.Views.Cover=Backbone.View.extend({className:"m-explainers-cover",templateId:"explainers-cover-template",initialize:function(e){this.model=e.model,this.cards=e.cards},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e={title:this.model.get("title"),body:this.model.get("body"),users:this.model.get("users"),cards:this.cards.map(function(e){return{title:e.get("title"),url:e.get("url"),status:e.get("status"),type:e.get("type")}})};return this.$el.html(this.template(e)),this}}),Vox.Explainers.Views.ExploreResults=Backbone.View.extend({templateId:"explainers-explore-results-template",cardStackSlc:".m-explainer-explore__explainer",initialize:function(e){this.suggestedCardStacks=e.suggestedCardStacks},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e={cardStacks:this.collection,suggestedCardStacks:this.suggestedCardStacks},t=this.template(e);return this.$el.html(t),this}}),Vox.Explainers.Views.EmbedCode=Backbone.View.extend({templateId:"explainers-embed-code-template",initialize:function(e){this.url=e.url,this.title=e.title},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e={url:this.url,title:this.title};return this.$el.html(this.template(e)),this}}),Vox.Explainers.Views.FeedbackPrompt=Backbone.View.extend({templateId:"explainers-feedback-prompt-template",initialize:function(){},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e=this.model.attributes,t=this.model.get("url")+"?utm_campaign=vox&utm_content=feedback-prompt&utm_medium=social";return e.shareUrl=encodeURIComponent(t),e.shareText=encodeURIComponent(e.social_headline),this.$el.html(this.template(e)),this}}),Vox.Explainers.Views.Fullscreen=Backbone.View.extend({className:"m-explainer",id:"explainer",templateId:"explainers-fullscreen-template",cardSlc:".m-explainer__card",cardsContainerSlc:".m-explainer__cards",pagerSlc:".m-explainer__pager__card-count",tocItemSlc:".m-explainer__toc",footerCounterSlc:".m-explainer__pager__card-count-number",shareOverlaySlc:".m-explainer__share-card.fullscreen",embedModalSlc:".m-explainer__embed--modal",embedTextBoxSlc:'.m-explainer__embed-code[data-type="overlay"]',embedHost:void 0,largeBreakpoint:880,cover:void 0,events:{"click .m-explainer__close":"onCloseClick","click .m-explainer__pager-control.next":"onNextClick","click .m-explainer__pager-control.previous":"onPrevClick","click .m-explainer__card__pager-control.next":"onNextClick","click .m-explainer__card__pager-control.previous":"onPrevClick","click .m-explainer__pager-control":"onPagerClick","pointerdown .m-explainer__toc a":"onTocClick","click .m-explainer__toc a":"onTocClick","pointerdown .m-explainer-cover__toc a":"onTocClick","click .m-explainer-cover__toc a":"onTocClick","click .m-explainer__card-content a":"onContentClick","click #mobile-rail-toggle":"onMobileCoverClick","pointerdown .m-explainer__title--link":"onTitleClick","click .m-explainer__title--link":"onTitleClick","click .m-explainer-cover__start":"gotoFirstCard",keydown:"keyboardNavigation","click .m-explainer__lower-nav__icons-share":"toggleShareOverlay","click .m-explainer__top-nav":"closeShareOverlay",'click .m-explainer__embed--button[data-type="modal"]':"toggleEmbedModal","click .m-explainer__cards":"closeEmbedModal","click .m-explainer__share-card.fullscreen .m-explainer__embed--button":"toggleEmbedTextBox"},animationEndEvent:{WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[Chorus.Modernizr.prefixed("animation")],animationSupport:Chorus.Modernizr.cssanimations,historySupport:Chorus.Modernizr.history,isAnimating:!1,isPreview:!1,isExplore:!1,railOpen:!1,adClass:"ad",adRequestEvent:"Hymnal.requestAd",adResponseEvent:"Vox.Ad.ResponseWithHTML",exploreCardUrl:"/cards",initialize:function(e){_.bindAll(this,"onPopstate","handleSwipes","configToc","onEndAnimation"),this.cardModels=this.model.cards,this.cardViews=[],this.opener=e.opener,this.pageTitle=document.title,this.currentIndex=this.model.get("active_index"),this.hammertime=new Hammer(this.el,{drag_lock_to_axis:!0,prevent_mouseevents:!0,stop_browser_behavior:{userSelect:"text"}}),this.hammertime.on("release dragleft dragright swipeleft swiperight",this.handleSwipes),this.isPreview=e.preview?!0:!1,this.updateBrowserUrlState=this.historySupport&&!this.isPreview,this.cardstackVideos={},this.prefetchCards(),this.addShareCard(),this.addExploreCard(),this.initEmbed()},addExploreCard:function(){this.cardModels.add({id:(new Date).getTime()+Math.floor(1e4*Math.random()),title:"Explore",type:"Explore",url:this.exploreCardUrl})},addShareCard:function(){var e=this.model.get("url"),t=this.model.get("social_headline");this.cardModels.add({id:(new Date).getTime()+Math.floor(1e6*Math.random()),title:"Share this card stack!",type:"Share",embedCode:this.embedCode(),shareUrl:encodeURIComponent(e),shareText:t,url:e+"#share"})},addCard:function(e,t,i){i=$.extend({},i);var n=new Backbone.Model({id:(new Date).getTime(),body:e,type:"Ad"}),o=new Vox.Explainers.Views.Card({model:n,header:null});this.cardModels.add(n,{at:t}),this.cardViews.splice(t,0,o),o.render(),i.isAd&&(o.$el.addClass(this.adClass),i.$tocItem=$('<li class="ad">Advertisement</li>')),o.$el.insertBefore(this.$(this.cardSlc).eq(t)),this.addTocItem(i.$tocItem,t)},removeCard:function(e){var t=this.$(this.cardSlc).index(e),i=this.cardModels.at(t),n=this.cardViews[t];this.currentIndex>=t&&(this.currentIndex-=1),n.remove(),this.cardModels.remove(i),this.removeTocItem(t)},addTocItem:function(e,t){var i=this.$(this.tocItemSlc);$currentTocItem=i.children("li").eq(t),e.insertBefore($currentTocItem)},removeTocItem:function(e){var t=this.$(this.tocItemSlc),i=t.children("li").eq(e);i.remove()},cardCount:function(){return this.cardModels.length},template:function(e){return _.template($("#"+this.templateId).html(),e)},addCover:function(){var e=new Vox.Explainers.Views.Cover({model:this.model,cards:this.cardModels});return e.render(),this.cover=$("#"+this.id),this.cover.append(e.el),e},onTitleClick:function(e){e.preventDefault(),$(window).width()>this.largeBreakpoint?this.showCover():this.gotoFirstCard()},renderCover:function(e){if($(window).width()>this.largeBreakpoint){if(this.showCover(),e){var t=this.model.get("title"),i=this.model.get("url"),n={explainerId:this.model.id,index:-1};this.replaceState(n,t,i)}}else this.showMobileCover()},showCover:function(){var e=$(".m-explainer__cards");e.addClass("hide"),this.cover.addClass("explainer-cover-body")},hideCover:function(){var e=$(".m-explainer__cards");e.removeClass("hide"),this.cover.removeClass("explainer-cover-body")},hideCovers:function(){this.hideCover(),this.hideMobileCover()},render:function(e){var t=this.$el;return t.html(this.template({title:this.model.get("title"),socialHeadline:this.model.get("social_headline"),url:encodeURIComponent(this.model.get("url")+window.location.hash),stackUrl:this.model.get("url")+window.location.hash,exitUrl:this.exitUrl(),chorusImageId:this.model.get("chorus_image_id"),photoCredit:this.model.get("photo_credit"),photoCreditUrl:this.model.get("photo_credit_url"),users:this.model.get("users"),updatedAt:this.model.get("updated_on"),currentCard:this.currentIndex+1,embedCode:this.embedCode(),cards:this.cardModels.map(function(e){return{title:e.get("title"),url:e.get("url"),status:e.get("status"),type:e.get("type")}})})),this.cardViews=this.cardModels.map(function(e,t,i){var n={model:e,index:t,total:i.length};if("Explore"===e.get("type")){n=$.extend({collection:new Backbone.Collection({model:Backbone.Model}),parentView:this,exploreCardMode:!0},n);var o=new Vox.Explainers.Views.Explore(n)}else if("Share"===e.get("type"))var o=new Vox.Explainers.Views.Share(n);else{e.set("embedCode",this.embedCode(e)),e.set("isEmbedded",this.isRenderedInsideIframe());var o=new Vox.Explainers.Views.Card(n)}return o.render(),this.$(this.cardsContainerSlc).append(o.el),o},this),this.addCover(),-1===this.currentIndex?this.renderCover(e):this.gotoIndex(this.currentIndex,{doPushState:e,skipAnimation:!0}),$("body, html").scrollTop(0),$("body").addClass("explainer-opening"),_.delay(_.bind(function(){$("body").addClass("explainer-open").removeClass("explainer-opening"),this.updateTocCurrentItem(),Chorus.DynamicSizedImages.applyTo()},this),500),t.appendTo("body"),setTimeout(function(){t.addClass("loaded")},0),this.isRenderedInsideIframe()||t.attr("tabIndex",-1).focus(),this.applyBackgroundImage(t),Chorus.Video.init({namespace:"CARDSTACK",returnActivePlayer:!1}),this.cardsSeen=0,this.configToc(),$(window).on("resize.explainer",_.bind(_.debounce(this.resizer,300),this)).on("popstate.explainer",this.onPopstate),this},embedCode:function(e){var t=e?e.get("url"):this.model.get("url"),i=e?e.get("title"):this.model.get("title"),n=new Vox.Explainers.Views.EmbedCode({url:t,title:i});n.render();var o=n.el.innerHTML;return o},postMessageToHost:function(e){e.sender="Vox",parent.postMessage(e,"*")},listenForMessages:function(){var e=this,t=window.addEventListener?"addEventListener":"attachEvent",i=window[t],n="attachEvent"==t?"onmessage":"message";i(n,function(t){t.data&&"Vox"==t.data.sender&&(e.embedHost=t.data.url)})},isRenderedInsideIframe:function(){try{return window.self!==window.top}catch(e){return!0}},initEmbed:function(){if(this.isRenderedInsideIframe()){this.listenForMessages();var e=this.cardModels.at(this.currentIndex)||this.model;this.postMessageToHost({backgroundUrl:this.model.get("embed_background_url"),url:e.get("url")}),$("body").addClass("vox-cardstack-iframe"),this.applyEmbedHacks()}},applyEmbedHacks:function(){$.browser&&$.browser.safari&&(this.events["mousedown "+this.tocItemSlc]="disableTocOverflow",this.events["mouseup "+this.tocItemSlc]="enableTocOverflow",this.delegateEvents())},disableTocOverflow:function(){$(this.tocItemSlc).css({"overflow-y":"hidden",overflow:"hidden"})},enableTocOverflow:function(){$(this.tocItemSlc).css({"overflow-y":"auto",overflow:"auto"})},applyBackgroundImage:function(e){var t=this.model.get("chorus_image_id")+":standard:1";e.attr("data-imgkey",t),e.addClass("vox-lazy-load"),Chorus.DynamicSizedImages.applyTo()},resizer:function(){this.railOpen&&$(window).width()>this.largeBreakpoint&&this.toggleMobileCover(),$(window).width()>this.largeBreakpoint&&this.closeShareOverlay()},configToc:function(){var e=$("#explainer-rail-list"),t=$("#explainer-rail-header"),i=$(".m-explainer__toc-scroller"),n=$(window),o=n.height()-(100+t.outerHeight()+2*i.outerHeight());o=240>o?o:240,!this.isRenderedInsideIframe()&&n.width()>this.largeBreakpoint?$("#explainer-rail-list").outerHeight(o):$("#explainer-rail-list").removeAttr("style"),i.on("click",function(t){var i=$(this).hasClass("down")?+o:-o;e.animate({scrollTop:e.scrollTop()+i-100},200),t.preventDefault()})},setContainerOffset:function(e,t){$(e).css("transform","translate("+t+"%,0)")},handleSwipes:function(e){var t=this.$(this.cardSlc).eq(this.currentIndex),i=.25,n=0,o=$(window).width();
if(this.railOpen)return!1;switch(e.type){case"dragright":case"dragleft":n=100/o*e.gesture.deltaX/2,this.setContainerOffset(t,n);break;case"swipeleft":this.gotoNext("swipe"),e.gesture.stopDetect();break;case"swiperight":this.gotoPrev("swipe"),e.gesture.stopDetect();break;case"release":Math.abs(e.gesture.deltaX)>o*i?"right"===e.gesture.direction?this.gotoPrev("swipe"):this.gotoNext("swipe"):this.setContainerOffset(t,0)}},updateFooterCounter:function(){var e=0,t=0;this.cardModels.each(function(i){"Ad"!==i.get("type")&&(e++,this.currentCard===i&&(t=e))},this),this.$(this.footerCounterSlc).text(t)},updateTocCurrentItem:function(){if(!(this.currentIndex<0)){var e=this.$(this.tocItemSlc),t=e.children("li").eq(this.currentIndex),i=t.prev();this.clearTocCurrentItem(),t.addClass("current");var n=e.scrollTop();i.length>0&&(n+=i.position().top),e.animate({scrollTop:n},350)}},clearTocCurrentItem:function(){var e=this.$(this.tocItemSlc);e.children("li").removeClass("current")},onMobileCoverClick:function(e){e.preventDefault(),this.hideCover(),this.toggleMobileCover(),!this.railOpen&&this.currentIndex<0&&this.gotoFirstCard()},toggleMobileCover:function(){this.railOpen?this.hideMobileCover():this.showMobileCover()},showMobileCover:function(){if(!this.railOpen&&$(window).width()<this.largeBreakpoint){var e=$("#explainer-rail"),t=$("#mobile-rail-toggle"),i=$(".m-explainer__cards");t.addClass("open"),e.addClass("open"),i.addClass("hide"),this.railOpen=!0}},hideMobileCover:function(){if(this.railOpen&&$(window).width()<this.largeBreakpoint){var e=$("#explainer-rail"),t=$("#mobile-rail-toggle"),i=$(".m-explainer__cards");t.removeClass("open"),e.removeClass("open"),i.removeClass("hide"),this.railOpen=!1}},onPagerClick:function(e){e.preventDefault(),this.hideMobileCover()},toggleShareOverlay:function(e){e&&e.preventDefault(),e.stopPropagation(),$(this.shareOverlaySlc).toggleClass("open"),this.closeAllEmbeds()},closeShareOverlay:function(e){$(this.shareOverlaySlc).removeClass("open")},toggleOverlayEmbed:function(e){$(this.embedOverlayModalSlc).toggleClass("show")},toggleEmbedModal:function(e){e&&e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).closest(".m-explainer__embed--button"),i=$(this.embedModalSlc),n=!t.next(i).hasClass("show");if(this.closeEmbedModal(),n){var o=t.next(i);o.addClass("show"),o.find(".m-explainer__embed-textarea").select()}$(this.embedModalSlc).on("click",function(e){e.stopPropagation()})},closeEmbedModal:function(e){$(this.embedModalSlc).removeClass("show")},toggleEmbedTextBox:function(e){e&&e.preventDefault(),e.stopPropagation();var t=$(this.embedTextBoxSlc);t.toggleClass("show"),t.hasClass("show")&&t.select()},closeEmbedTextBox:function(e){$(this.embedTextBoxSlc).removeClass("show")},closeAllEmbeds:function(){this.closeEmbedModal(),this.closeEmbedTextBox()},onNextClick:function(e){var t=this.whichPager(e);this.gotoNext("click:"+t),e.preventDefault(),e.stopPropagation()},onPrevClick:function(e){var t=this.whichPager(e);this.gotoPrev("click:"+t),e.preventDefault(),e.stopPropagation()},whichPager:function(e){var t,i=$(e.currentTarget).closest(".m-explainer__pager");return t=i.hasClass("lower")?"lower":i.hasClass("upper")?"upper":"nav"},onCloseClick:function(e){this.trackNavEvent("close:click"),this.close(!0),e.preventDefault(),e.stopPropagation()},onContentClick:function(e){var t=this.cardModels.findWhere({url:$(e.currentTarget).attr("href")});t&&(this.gotoIndex(this.cardModels.indexOf(t),{doPushState:!0,skipAdCheck:!0}),e.preventDefault(),e.stopPropagation())},exitUrl:function(){return this.opener?"/e/"+Chorus.Context.entry_id:window.location.hash.match(/^#E[0-9]+$/)?"/e/"+window.location.hash.substring(2):0===document.referrer.indexOf("http://"+window.location.host)&&document.referrer!==document.URL?document.referrer:"/"},close:function(e){this.opener?(_.invoke(this.cardViews,"stopListening"),this.cardViews=[],this.hammertime.off("release dragleft dragright swipeleft swiperight"),this.remove(),$(window).off("resize.explainer"),$(window).off("popstate.explainer"),$("body").addClass("explainer-closing"),setTimeout(function(){$("body").removeClass("explainer-closing explainer-open")},500),this.opener.closeFullscreen(e)):window.location.href=this.exitUrl()},gotoFirstCard:function(){var e=0;this.gotoIndex(e,{doPushState:!0,navAction:"next:cover"})},gotoNext:function(e){var t=this.currentIndex===this.cardCount()-1?this.currentIndex:this.currentIndex+1;this.gotoIndex(t,{doPushState:!0,navAction:"next:"+e})},gotoPrev:function(e){var t=0===this.currentIndex?this.currentIndex:this.currentIndex-1;this.gotoIndex(t,{doPushState:!0,navAction:"prev:"+e})},onTocClick:function(e){var t=$(e.currentTarget).data("index");this.$el.focus(),this.railOpen&&this.toggleMobileCover(),this.gotoIndex(t,{doPushState:!0,skipAdCheck:!0,navAction:"toc"}),e.preventDefault(),e.stopPropagation()},prefetchCards:function(){this.isPreview||this.model.loaded||this.model.loading||(this.model.loading=!0,this.model.fetch({success:function(e){e.loaded=!0,e.loading=!1},error:function(e){e.loaded=!1,e.loading=!1}}))},detachVideos:function(e){var t=jQuery('.m-explainer__card.current iframe[src*="youtube.com"]'),i={};t.length&&jQuery.each(t,function(e){jQuery(this).parent().addClass("extracted-video-"+e),i[e]=jQuery(this).detach()}),this.cardstackVideos[e]=i},attachVideos:function(e){var t=jQuery('.m-explainer__card[data-id="'+e+'"] [class^="extracted-video-"]:empty'),i=this.cardstackVideos;t.length&&jQuery.each(t,function(t){jQuery(this).append(i[e][t])})},gotoIndex:function(e,t){t=t||{};var i,n,o=!this.isRenderedInsideIframe()&&(t.doPushState||!1),r=t.skipAnimation||!1,a=t.skipAdCheck||!1,s=t.navAction||null,l=e<this.currentIndex?"left":"right",c=this.$(this.cardSlc).eq(this.currentIndex),d=e===this.currentIndex,u=!1,h=!1;if(!this.isAnimating){if(a||d||("left"===l?this.checkForAdContent(e+1)&&(u=!0,e+=1):u=this.checkForAdContent(e)),c.css("overflow-y",""),this.detachVideos(this.cardModels.get(c.data("id")).id),i=this.$(this.cardSlc).eq(e),this.currentCard=n=this.cardModels.get(i.data("id")),r||!this.animationSupport)this.delayedOnEndAnimation(i,c),this.cardsSeen+=1,h=!0;else if(d)this.doBounceAnimation(e,c);else{if(!i.length)return;this.doCardAnimation(i,c,l),this.cardsSeen+=1,h=!0}if(this.hideCovers(),n&&"Explore"==n.get("type"))d?this.doBounceAnimation(e,c):(this.isExplore=!0,this.doExploreAnimationToggle({mode:"show"}),n.trigger("explore:in_view"));else if(this.isExplore&&"left"==l){this.isExplore=!1,this.doExploreAnimationToggle({mode:"hide"});var m=this.$el.find("#__query");m.val(""),oldModel=this.cardModels.get(c.data("id")),oldModel.trigger("explore:out_of_view")}if(this.currentIndex=e,u)this.clearTocCurrentItem();else if(n){if(this.updateTocCurrentItem(),this.updateFooterCounter(),this.attachVideos(this.cardModels.get(i.data("id")).id),this.updateBrowserUrlState){var p={explainerId:this.model.id,index:e},f=n.get("title")+" - "+this.model.get("title")+" - Vox",g=n.get("url");""!==window.location.hash&&/^#E/i.test(window.location.hash)?g+=window.location.hash:this.opener&&(g+="#E"+Chorus.Context.entry_id),o?this.pushState(p,f,g):this.replaceState(p,f,g),document.title=f}Chorus.DynamicSizedImages.applyTo(i),this.closeAllEmbeds(),this.closeShareOverlay()}if(h){if(this.cardsSeen>0){var v=window.location.pathname;""!==window.location.hash&&(v+=window.location.hash),v="/virtual"+v}s&&this.trackNavEvent(s,f),v&&this.trackPageview(v,f)}}},getCardPagination:function(){var e=this.cardModels.at(this.currentIndex),t=e.get("type"),i={Ad:1,Explore:1,Share:1,Title:1};if(i[t])return t;var n=0,o=0;return this.cardModels.each(function(e){i[e.get("type")]||(n++,this.currentCard===e&&(o=n))},this),o+" of "+n},trackPageview:function(e,t){this.isPreview||(!this._vpv&&this.embedHost&&(Chorus.Analytics.push({event:"embedPageView"}),this._vpv=!0),Chorus.Analytics.pageview({virtualPagePath:e,virtualPageTitle:t||this.model.get("title"),"Content ID":this.model.id,"Embed Host":this.embedHost,"Pagination Tracking":this.getCardPagination()}))},trackNavEvent:function(e,t){if(!this.isPreview){var i="navigation",e="cardstack:"+e,n=t||this.model.get("title");Chorus.Analytics.event(i,e,n,{"Content ID":this.model.id,"Embed Host":this.embedHost,"Pagination Tracking":this.getCardPagination()})}},doExploreAnimationToggle:function(e){if(e=$.extend({},e),"show"==e.mode){var t=this.$(this.cardSlc).eq(this.currentIndex);t.find(".m-explainer__card-wrapper").addClass("m-explainer-explore__card"),$("#"+this.id).addClass("explainer-explore-body")}"hide"==e.mode&&$("#"+this.id).removeClass("explainer-explore-body");var i=this.$el.find("#__query");0==Util.UserAgentProfiler.isIOS()&&i.focus()},doCardAnimation:function(e,t,i){var n,o,r,a,s=this.animationEndEvent,l=this.onEndAnimation;e.removeAttr("style").addClass("current"),"right"===i?(r="to-left",a="from-right"):(r="to-right",a="from-left"),this.isAnimating=!0,t.addClass(r).on(s,function(){t.removeClass("current"),t.off(s),n=!0,o&&l(e,t)}),e.addClass(a).on(s,function(){e.off(s),o=!0,n&&l(e,t)})},doBounceAnimation:function(e,t){var i=this.animationEndEvent,n=this.onEndAnimation;t.removeAttr("style").addClass("current"),0!==e?bounceClass="bounce-left":bounceClass="bounce-right",this.isAnimating=!0,t.addClass(bounceClass).on(i,function(){t.off(i),n(t)})},onEndAnimation:function(e,t){e.removeClass("to-left to-right from-left from-right bounce-right bounce-left"),e.addClass("current"),setTimeout(function(){e.css("overflow-y","auto")},1),t&&(t.hasClass(this.adClass)?this.removeCard(t):(t.is(e)||t.removeClass("current"),t.removeAttr("style").removeClass("to-left to-right from-left from-right bounce-right bounce-left"),t.scrollTop(0))),this.isAnimating=!1},delayedOnEndAnimation:function(e,t){var i=this;setTimeout(function(){i.onEndAnimation(e,t)},1)},onPopstate:function(e){var t=e.originalEvent.state;t?t.explainerId===this.model.id?this.gotoIndex(t.index,{navAction:"history"}):this.renderCover():this.opener&&this.close(!1)},keyboardNavigation:function(e){var t=this.$(this.cardSlc).eq(this.currentIndex),i=e.keyCode||e.which,n={left:37,right:39,up:38,down:40,escape:27,pageUp:33,pageDown:34,home:36};switch(i){case n.left:this.gotoPrev("key"),e.preventDefault();break;case n.right:this.gotoNext("key"),e.preventDefault();break;case n.down:t.scrollTop(t.scrollTop()+25),e.preventDefault();break;case n.up:t.scrollTop(t.scrollTop()-25),e.preventDefault();break;case n.pageUp:t.scrollTop(t.scrollTop()-400),e.preventDefault();break;case n.pageDown:t.scrollTop(t.scrollTop()+400),e.preventDefault();break;case n.home:t.scrollTop(0),e.preventDefault();break;case n.escape:if(this.isRenderedInsideIframe())break;this.close(!0),e.preventDefault(),this.trackNavEvent("close:key")}},checkForAdContent:function(e){var t=!1,i=_.bind(function(i,n){this.addCard(n,e,{isAd:!0}),t=!0},this),n=$(document).on(this.adResponseEvent,i);return n.triggerHandler(this.adRequestEvent,{pagesSeen:this.cardsSeen,currentPage:this.currentIndex,nextPage:e,totalPages:this.cardCount()}),n.off(this.adResponseEvent,i),t},pushState:function(e,t,i){window.history.pushState(e,t,i)},replaceState:function(e,t,i){window.history.replaceState(e,t,i)}});var Chorus=Chorus||{};Chorus.UserMessaging=function(e){function t(e){e.on("webkittransitionend transitionend otransitionEnd mstransitionend transitionend",function(){e.remove()}),e.addClass("is-closed")}function i(i){i.preventDefault(),i.stopPropagation(),t(e(i.delegateTarget))}function n(){var t=e(".m-user-msg__notice");t.length>1&&o(),t.first().find(".m-user-msg__close").trigger("click")}function o(){s===!0&&(dur=e(".m-user-msg__notice_short").length>0?c:l,to=setTimeout(n,dur))}function r(){e(".m-user-msg__notice, .m-user-msg__error").on("click",".m-user-msg__close",i)}function a(){e(".m-user-msg__modal").each(function(){Chorus.EventDispatcher.publish("modal_open",{content:e(this)})})}var s="polygon"===Chorus.Context.network_slug,l=3e4,c=4e3;return{init:function(){e(".m-user-msg").length<1||(a(),r(),o())}}}(jQuery),jQuery(Chorus.UserMessaging.init);var Chorus=Chorus||{};Chorus.Modal=function(e){"use strict";function t(){if(null===b){var t=e(C());v.append(t),t.on("click",p),b=t.find(".m-chorus-modal__root").addBack(".m-chorus-modal__root").first()}}function i(){t(),v.addClass("chorus-modal-loading")}function n(){v.removeClass("chorus-modal-loading")}function o(){t(),v.addClass("chorus-modal-open")}function r(){v.removeClass("chorus-modal-open")}function a(t){i();t.data||{};t.success=function(e){t.content=e,s(t)},t.error=function(e,t){"abort"!==t&&alert("There was an error recieving data from the server."),n()},y.push(e.ajax(t))}function s(t){n(),o();var i=e(w(t));if(i.find(".m-chorus-modal__window-root").append(t.content),t.includeCloseButton){var r=e('<div class="m-chorus-modal__close">&times;</div>');r.on("click",g),i.find(".m-chorus-modal__window-root").append(r)}i.addClass(t.modalClass),i.data("chorus-modal-callbacks",t.callbacks),b.prepend(i),i.on("click","*[data-chorus-modal-action]",m),d("attach",i)}function l(e){e.remove(),0===b.children().length&&(r(),n())}function c(e){e.callbacks=e.callbacks||{},e.title=e.title||"Untitled Modal",e.content=e.content||null,e.modalClass=e.modalClass||null,e.url?a(e):null!==e.content&&s(e)}function d(e,t){var i=t.data("chorus-modal-callbacks");if("cancel_confirm"===e){if(!confirm("Are you sure you want to close this window?"))return;e="cancel"}"function"==typeof i[e]&&i[e](t),("cancel"==e||"close"==e)&&l(t)}function u(){for(Chorus.EventDispatcher.publish("modal_closed_by_modaljs"),e(".m-chorus-modal__window").each(function(){d("cancel",e(this))}),null!==b&&b.empty(),r(),n();y.length>0;)y.pop().abort()}function h(){x=!0;var t=e("#chorus-modal-window-template").html()||"",i=e("#chorus-modal-wrapper-template").html()||"";v=e("body"),w=_.template(t),C=_.template(i)}function m(t){t.preventDefault(),d(e(t.target).data("chorus-modal-action").toString().trim(),e(t.delegateTarget))}function p(t){e(t.target).is(b)&&u()}function f(e){x===!1&&h(),c(e)}function g(e){u()}var v,w,C,b=null,y=[],x=!1;return{init:function(){Chorus.EventDispatcher.subscribe("modal_open",f),Chorus.EventDispatcher.subscribe("modal_close",g)},open:function(e){Chorus.EventDispatcher.publish("modal_open",e)},close:function(e){Chorus.EventDispatcher.publish("modal_close",e)}}}(jQuery),Chorus.Modal.init();var shortcut={all_shortcuts:{},add:function(e,t,i){var n={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(i)for(var o in n)"undefined"==typeof i[o]&&(i[o]=n[o]);else i=n;var r=i.target;"string"==typeof i.target&&(r=document.getElementById(i.target));e=e.toLowerCase();var a=function(n){if(n=n||window.event,i.disable_in_input){var o;if(n.target?o=n.target:n.srcElement&&(o=n.srcElement),3==o.nodeType&&(o=o.parentNode),"INPUT"==o.tagName||"TEXTAREA"==o.tagName)return}n.keyCode?code=n.keyCode:n.which&&(code=n.which),n.key?character=n.key.toLowerCase():character=String.fromCharCode(code).toLowerCase(),188==code&&(character=","),190==code&&(character=".");var r=e.split("+"),a=0,s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},l={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},c={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};n.ctrlKey&&(c.ctrl.pressed=!0),n.shiftKey&&(c.shift.pressed=!0),n.altKey&&(c.alt.pressed=!0),n.metaKey&&(c.meta.pressed=!0);for(var d=0;k=r[d],d<r.length;d++)"ctrl"==k||"control"==k?(a++,c.ctrl.wanted=!0):"shift"==k?(a++,c.shift.wanted=!0):"alt"==k?(a++,c.alt.wanted=!0):"meta"==k?(a++,c.meta.wanted=!0):k.length>1?l[k]==code&&a++:i.keycode?i.keycode==code&&a++:character==k?a++:s[character]&&n.shiftKey&&(character=s[character],character==k&&a++);return a!=r.length||c.ctrl.pressed!=c.ctrl.wanted||c.shift.pressed!=c.shift.wanted||c.alt.pressed!=c.alt.wanted||c.meta.pressed!=c.meta.wanted||(t(n),i.propagate)?void 0:(n.cancelBubble=!0,n.returnValue=!1,n.stopPropagation&&(n.stopPropagation(),n.preventDefault()),!1)};this.all_shortcuts[e]={callback:a,target:r,event:i.type},r.addEventListener?r.addEventListener(i.type,a,!1):r.attachEvent?r.attachEvent("on"+i.type,a):r["on"+i.type]=a},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];if(delete this.all_shortcuts[e],t){var i=t.event,n=t.target,o=t.callback;n.detachEvent?n.detachEvent("on"+i,o):n.removeEventListener?n.removeEventListener(i,o,!1):n["on"+i]=!1}}},miuScript;!function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])});var uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},matched=uaMatch(navigator.userAgent),browser={};return matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),this.each(function(){function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor"),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),options.resizeHandle===!0&&browser.safari!==!0&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,i,n=$$.height(),o=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+n-o)+"px"),!1},i=function(e){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",i),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",i)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){t.target!==!1&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'" tabindex="-1">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("touchstart.markItUp",function(){(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))&&textarea.blur()}).bind("click.markItUp touchstart.markItUp",function(e){e.preventDefault()}).bind("mouseup touchend",function(){return button.call&&eval(button.call)(),markup(button),!1}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){return e?(e=e.toString(),e=e.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var i=t.split("|!|");return altKey===!0?void 0!==i[1]?i[1]:i[0]:void 0===i[1]?"":i[0]}),e=e.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,t){var i=t.split(":!:");return abort===!0?!1:(value=prompt(i[0],i[1]?i[1]:""),null===value&&(abort=!0),value)})):""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),i=prepare(clicked.placeHolder),n=prepare(clicked.replaceWith),o=prepare(clicked.closeWith),r=prepare(clicked.openBlockWith),a=prepare(clicked.closeBlockWith),s=clicked.multiline;if(""!==n)block=t+n+o;else if(""===selection&&""!==i)block=t+i+o;else{e=e||selection;var l=[e],c=[];s===!0&&(l=e.split(/\r?\n/));for(var d=0;d<l.length;d++){line=l[d];var u;(u=line.match(/ *$/))?c.push(t+line.replace(/ *$/g,"")+o+u):c.push(t+line+o)}block=c.join("\n")}return block=r+block+a,{block:block,openBlockWith:r,openWith:t,replaceWith:n,placeHolder:i,closeWith:o,closeBlockWith:a}}function markup(e){var t,i,n,o;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),ctrlKey===!0&&shiftKey===!0){for(lines=selection.split(/\r?\n/),i=0,n=lines.length,o=0;n>o;o++)""!==$.trim(lines[o])?($.extend(hash,{line:++i,selection:lines[o]}),lines[o]=build(lines[o]).block):lines[o]="";string={block:lines.join("\n")},start=caretPosition,t=string.block.length+(browser.opera?n-1:0)}else ctrlKey===!0?(string=build(selection),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):shiftKey===!0?(string=build(selection),start=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,t=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openBlockWith.length+string.openWith.length,t=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&abort===!1?(insert(string.block),set(start,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(ctrlKey===!0&&shiftKey===!0||e.multiline===!0)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){if(document.selection){var t=document.selection.createRange();t.text=e}else textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,browser.msie){textarea.focus();var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):altKey===!0&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){var e=options.previewParser($$.val());writeInPreview(localize(e,1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(t){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=e.altKey&&e.ctrlKey?!1:e.ctrlKey||e.metaKey,"keydown"===e.type){if(ctrlKey===!0&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,li.triggerHandler("mouseup"),!1;if(13===e.keyCode||10===e.keyCode)return ctrlKey===!0?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):shiftKey===!0?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1==shiftKey||1==ctrlKey||1==altKey?!1:-1!==caretOffset?(get(),caretOffset=$$.val().length-caretOffset,set(caretOffset,0),caretOffset=-1,!1):(markup(options.onTab),options.onTab.keepDefault)}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init()})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};return $.extend(t,e),t.target?$(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])}):void $("textarea").trigger("insertion",[t])}}(jQuery),window.Chorus||(Chorus={}),Chorus.Comments=_.extend({},Backbone.Events,{Collections:{},Models:{},Views:{},Mixins:{},autoUpdateTimeout:null,defaults:{ajaxParams:{},ajaxTimeout:15e3,alertErrors:!0,avatarBreakpointIndex:2,autoUpdateAlertMaxShown:5,autoUpdateAlertTimeShown:6500,autoUpdateEnabled:!1,buildAncestry:!0,currentAutoUpdateInterval:4e4,editTimeWindow:90,emptyUpdateTolerance:5,fastAutoUpdateInterval:3e4,flaggedThreshold:1,localClockOffset:null,markItUp:{onShiftEnter:{keepDefault:!1,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:!0},{name:"Numeric list",openWith:"# ",multiline:!0},{separator:"---------------"},{name:"Picture",openWith:"![![Source:!:http://]!](",closeWith:")!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}],resizeHandle:!1},maxIndentationDepth:30,offsetHeight:Math.floor(.333*jQuery(window).height()),recommendedThreshold:1,renderChunkLength:200,renderTo:"#comments",scrollAnimationDuration:300,scrollBuffer:0,showAutoUpdateAlert:!0,showAvatars:!0,showSignatures:!0,showImages:!0,removeImages:!1,removeEmoji:!1,slowAutoUpdateInterval:6e4,sortMethod:"ancestry",startOnScroll:Chorus.Environment.currentBreakpoint().index>1},settings:{},initialize:function(e,t){return this.stop(),this.started=!1,this.context={},this.settings=_.extend({},this.defaults,this.settings,t),this.collection=new Chorus.Comments.Collections.Comments([],{entryId:e}),this.settings.renderTo&&(this.compileTemplates(),this.view=new Chorus.Comments.Views.Main({el:this.settings.renderTo,collection:this.collection}),this.view.render()),window.location.hash.match(/^#\d+$/)&&this.start(),this},initContext:function(e){this.context=e,this.settings.autoUpdateEnabled=this.settings.autoUpdateEnabled&&this.context.able_to_comment&&!this.context.comments_closed&&Chorus.Environment.currentBreakpoint().index>1,this.settings.autoUpdateEnabled&&this.startAutoUpdate()},start:function(){return this.started?void 0:(this.started=!0,this.listenTo(this,"ajaxSuccess",this.ajaxSuccess),this.listenTo(this,"ajaxError",this.ajaxError),this.collection.load(),this.trigger("start"),Chorus.Analytics&&Chorus.Analytics.eventAutoFormat("interaction","comment_load"),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("startComments"),this)},stop:function(){return this.view&&this.view.remove(),this.view=null,this.collection=null,this.started=!1,this.trigger("stop"),this.stopListening(),this},compileTemplates:function(){_.each(Chorus.Comments.Views,function(e){if(e.prototype.templateId){var t=jQuery("#"+e.prototype.templateId).html()||"";e.prototype.template=_.template(t)}})},scheduleAutoUpdate:function(e){if(this.settings.autoUpdateEnabled){var t;t=e.emptyUpdateCount<this.settings.emptyUpdateTolerance?this.settings.fastAutoUpdateInterval:this.settings.slowAutoUpdateInterval,this.settings.currentAutoUpdateInterval=t,clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=setTimeout(function(){e.update()},t)}},startAutoUpdate:function(){this.settings.autoUpdateEnabled=!0,this.listenTo(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),this.scheduleAutoUpdate(this.collection)},stopAutoUpdate:function(){this.settings.autoUpdateEnabled=!1,this.stopListening(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate),clearTimeout(this.autoUpdateTimeout),this.autoUpdateTimeout=null},openModal:function(e){Chorus.EventDispatcher.publish("modal_open",{content:e})},closeModal:function(){Chorus.EventDispatcher.publish("modal_close")},ajaxSuccess:function(e,t,i,n){var o=Date.parse(i.getResponseHeader("Date")),r=((new Date).valueOf()-o.valueOf())/1e3,a=this.settings.localClockOffset;_.isNumber(a)?this.settings.localClockOffset=(a+r)/2:this.settings.localClockOffset=r;
},ajaxError:function(e,t,i,n){try{var o=JSON.parse(e.responseText);o.message&&this.settings.alertErrors&&alert(o.message)}catch(r){}}}),Chorus.Comments.Mixins.Ajax={urlFor:function(e){var t=this.urls[e];return t&&(t=t.replace(/:([^\/]+)/,_.bind(function(e,t){return this instanceof Backbone.Model?this.get(t):this[t]},this))),t},ajax:function(e,t){var i=this.urlFor(e);if(!i)throw"ArgumentError: No url specified for action: "+e;var n=this,o=_.extend({url:i,dataType:"json",context:this,timeout:Chorus.Comments.settings.ajaxTimeout},this.ajaxOptions||{},t);return o.data&&_.isObject(o.data)&&"POST"===o.type&&(o.contentType="application/json",o.data=JSON.stringify(o.data),o.processData=!1),o.error=function(i,r,a){t&&_.isFunction(t.error)&&t.error.call(o.context,n,a),n.trigger(e+"Error",n,a,i),Chorus.Comments.trigger("ajaxError",i,r,a,n)},o.success=function(i,r,a){t&&_.isFunction(t.success)&&t.success.call(o.context,n,i),n.trigger(e+"Success",n,i,a),Chorus.Comments.trigger("ajaxSuccess",i,r,a,n)},n.trigger(e+"Start",n),Chorus.Comments.trigger("ajaxStart",n),jQuery.ajax(o)}},Chorus.Comments.Models.Comment=Backbone.Model.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{ajaxOptions:{type:"POST"},urls:{preview:"/comments/preview_comment",post:"/comments/post_comment",edit:"/comments/edit_comment/:id",hide:"/comments/hide_comment/:id",flag:"/comments/flag_comment/:id",unflag:"/comments/unflag_comment/:id",recommend:"/comments/recommend_comment/:id",destroy:"/comments/destroy_comment/:id",loadFlaggings:"/comments/ajax_comment_flags/:id",blockUser:"/comments/block_user/:id"},initialize:function(){!Chorus.Comments.settings.buildAncestry||this.get("ancestry")&&this.get("depth")||this.buildAncestry(),this.listenTo(this,"change:id change:parent_id",this.buildAncestry),this.listenTo(this,"change:collapsed",this.collapseDescendants)},buildAncestry:function(){var e,t=function(e){return e=e.toString(),e.length>=10?e:new Array(10-e.length+1).join("0")+e},i=this.id?t(this.id):"preview",n=this.parent();n&&(i=n.get("ancestry")+"/"+i),e=i.split("/").length,e=Math.min(e,Chorus.Comments.settings.maxIndentationDepth),this.set({ancestry:i,depth:e},{silent:!0})},user:function(){return this.collection.users.get(this.get("user_id"))||new Chorus.Comments.Models.User({display_name:this.get("username")||"anonymous"})},parent:function(){var e=this.get("parent_id");return e?this.collection.get(e):null},ancestors:function(){if(!this.get("ancestry"))return[];var e=this.get("ancestry").split("/");return e.pop(),_.map(e,function(e){return e=parseInt(e,10),this.collection.get(e)},this)},descendants:function(){var e=new RegExp("^"+this.get("ancestry")+"/");return this.collection.filter(function(t){return e.test(t.get("ancestry"))})},matchesConditions:function(e){for(var t in e)if(e[t]!=this.get(t))return!1;return!0},findNeighbor:function(e,t,i){var n,o=this.collection.indexOf(this),r=this.collection.length-1,a=o;if(0===r)return null;do{if(a=i?a-1:a+1,!t&&(0>a||a>r))return null;if(0>a?a=r:a>r&&(a=0),n=this.collection.at(a),n&&n.matchesConditions(e))return n}while(a!==o);return null},prev:function(e,t){return this.findNeighbor(e,t,!0)},next:function(e,t){return this.findNeighbor(e,t,!1)},flaggings:function(){return this.collection.flaggings.where({flaggable_id:this.id})},isFlagged:function(){return this.get("bad_flags_count")>=Chorus.Comments.settings.flaggedThreshold},isRecommended:function(){return this.get("recommended_flags_count")>=Chorus.Comments.settings.recommendedThreshold},createFlagging:function(e){return this.collection.flaggings.add({flag_name:e,flaggable_id:this.id,user_id:Chorus.Comments.context.user_id,created_on:new Date})},secondsSinceCreate:function(){var e=Chorus.Comments.settings.localClockOffset||0,t=(new Date).getTime()/1e3;return t=Math.round(t-e),t-this.get("created_on_timestamp")},isEditable:function(){return this.get("user_id")===Chorus.Comments.context.user_id&&this.secondsSinceCreate()<Chorus.Comments.settings.editTimeWindow},isPreview:function(){return!this.id},toJSON:function(){var e,t=_.clone(this.attributes);return t.is_flagged=this.isFlagged(),t.is_recommended=this.isRecommended(),t.is_editable=this.isEditable(),t.is_preview=this.isPreview(),t.permalink=this.getAbsoluteURL("permalink"),t.shortlink=this.getAbsoluteURL("shortlink"),Chorus.Environment.currentBreakpoint().index<2?t.created_on=this.get("created_on_short"):t.created_on=this.get("created_on_long"),e=this.user(),e&&(t.user=e.toJSON(!0)),t},getAbsoluteURL:function(e){return window.location.origin+this.get(e)},preview:function(){return this.ajax("preview",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0])}})},post:function(){var e=this.get("body");return e&&this.set("rawBody",e),this.ajax("post",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(e,t){e.collection.users.add(t,{parse:!0}),e.set(t.comments[0]),e.collection.add(e)}})},edit:function(e){return e.body&&this.set("rawBody",e.body),this.ajax("edit",{data:{entry_id:this.collection.entryId,comment:e},success:function(e,t){e.set(t.comments[0])}})},hide:function(){var e={},t=this.descendants();return _.each(t,function(t){e[t.id]=t.get("hidden"),t.set("hidden",!0)}),this.set("hidden",!0),this.ajax("hide",{error:function(i){i.set("hidden",!1),_.each(t,function(t){t.set("hidden",e[t.id])})}})},unhide:function(){return this.set("hidden",!1),this.ajax("hide",{error:function(e){e.set("hidden",!0)}})},flag:function(e){var t=this.createFlagging("inappropriate");return this.set({is_flagged_by_user:!0,bad_flags_count:this.get("bad_flags_count")+1}),this.ajax("flag",{data:e,error:function(e){e.set({is_flagged_by_user:!1,bad_flags_count:e.get("bad_flags_count")-1}),e.collection.flaggings.remove(t)}})},unflag:function(){var e=this.flaggingsLoaded,t=this.flaggings();return this.flaggingsLoaded=!1,this.collection.flaggings.remove(t),this.set({is_flagged_by_user:!1,bad_flags_count:this.get("bad_flags_count")-1}),this.ajax("unflag",{error:function(i){i.set({is_flagged_by_user:!0,bad_flags_count:i.get("bad_flags_count")+1}),i.collection.flaggings.add(t),i.flaggingsLoaded=e}})},recommend:function(){var e=this.createFlagging("recommended");return this.set({is_recommended_by_user:!0,recommended_flags_count:(this.get("recommended_flags_count")||0)+1}),this.ajax("recommend",{error:function(t){t.set({is_recommended_by_user:!1,recommended_flags_count:t.get("recommended_flags_count")-1}),t.collection.flaggings.remove(e)}})},unrecommend:function(){var e=this.flaggings();return this.collection.flaggings.remove(e),this.set({is_recommended_by_user:!1,recommended_flags_count:this.get("recommended_flags_count")-1}),this.ajax("unflag",{error:function(t){t.set({is_recommended_by_user:!0,recommended_flags_count:t.get("recommended_flags_count")+1}),t.collection.flaggings.add(e)}})},destroy:function(){var e=this.collection,t=this.descendants();return e.remove(t),e.remove(this),this.ajax("destroy",{error:function(i){e.add(i),e.add(t)}})},loadFlaggings:function(){return this.ajax("loadFlaggings",{type:"GET",success:function(e,t){e.collection.users.add(t,{parse:!0,merge:!0}),e.collection.flaggings.add(t,{parse:!0,merge:!0}),e.flaggingsLoaded=!0}})},collapseDescendants:function(e,t){t?_.each(this.descendants(),function(e){e.get("collapsedAncestorId")||e.set("collapsedAncestorId",this.id)},this):_.each(this.descendants(),function(e){e.get("collapsedAncestorId")===this.id&&e.set("collapsedAncestorId",null)},this)},blockUser:function(){var e=this.user(),t=this.collection,i=t.where({user_id:this.get("user_id")});return t.remove(i),t.users.remove(e),this.ajax("blockUser",{error:function(){t.users.add(e),t.add(i)}})}})),Chorus.Comments.Models.Flagging=Backbone.Model.extend({initialize:function(){this.set("created_on_timestamp",Math.round(new Date(this.get("created_on")).getTime()/1e3))},user:function(){return this.collection.users.get(this.get("user_id"))},flaggable:function(){return this.collection.comments.get(this.get("flaggable_id"))},toJSON:function(){var e=_.clone(this.attributes),t=this.user(),i=new Date(this.get("created_on")).toLocaleString();return e.created_on=i,t&&(e.user=t.toJSON()),e}}),Chorus.Comments.Models.User=Backbone.Model.extend({initialize:function(){var e=this.get("author_profile"),t=this.get("network_membership"),i=this.get("membership");e?this.set({profile_image:this.get("author_profile").image_url,profile_url:this.get("author_profile").url}):t&&this.set({profile_image:t.image_url,profile_url:t.url}),i&&this.set({inspect_user_url:i.inspect_user_url})},isAuthor:function(){return Chorus.Comments.context.author_id===this.id},isContributor:function(){return _.indexOf(Chorus.Comments.context.contributor_ids,this.id)>-1},toJSON:function(){var e=_.clone(this.attributes);return e.is_author=this.isAuthor(),e.is_contributor=this.isContributor(),e}}),Chorus.Comments.Collections.Comments=Backbone.Collection.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{model:Chorus.Comments.Models.Comment,urls:{load:"/comments/load_comments/:entryId",update:"/comments/ajax_comments_update/:entryId"},loaded:!1,lastRequestId:0,emptyUpdateCount:0,initialize:function(e,t){return this.entryId=t.entryId,this.users=new Chorus.Comments.Collections.Users,this.flaggings=new Chorus.Comments.Collections.Flaggings([],{users:this.users,comments:this}),this.listenTo(this,"add",this.findCollapsedAncestor),this},comparator:function(e,t){switch(Chorus.Comments.settings.sortMethod){case"ancestry":var i=e.get("ancestry"),n=t.get("ancestry");return n>i?-1:i>n?1:0;case"forward-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?e.get("id")-t.get("id"):e.get("created_on_timestamp")-t.get("created_on_timestamp");case"reverse-chron":return e.get("created_on_timestamp")===t.get("created_on_timestamp")?t.get("id")-e.get("id"):t.get("created_on_timestamp")-e.get("created_on_timestamp")}},parse:function(e){return e.comments||[]},load:function(){return this.ajax("load",{timeout:null,data:_.extend({t:(new Date).getTime()},Chorus.Comments.settings.ajaxParams),success:function(e,t){Chorus.Comments.initContext(t.context),e.loaded=!0,e.lastId=t.last_id,e.lastVersion=t.last_version,e.users.reset(t,{parse:!0}),e.flaggings.reset(t,{parse:!0}),e.reset(t,{parse:!0})}})},update:function(){return this.lastRequestId+=1,this.ajax("update",{data:_.extend({request_id:this.lastRequestId,last_id:this.lastId,last_version:this.lastVersion},Chorus.Comments.settings.ajaxParams),success:function(e,t){return e.lastRequestId!==t.last_request_id?void console.warn("Failed to update comments: updates arrived out of order"):(e.lastId=t.last_id,e.lastVersion=t.last_version,t.comments.length?e.emptyUpdateCount=0:e.emptyUpdateCount++,_.each(t.deleted_comment_ids,function(t){var i=e.get(t);i&&(e.remove(i.descendants()),e.remove(i))}),e.users.add(t,{parse:!0}),e.add(t,{parse:!0}),void e.flaggings.add(t,{parse:!0}))},error:function(e,t){e.emptyUpdateCount++}})},findCollapsedAncestor:function(e){var t=_.find(e.ancestors().reverse(),function(e){return e.get("collapsed")});t&&(e.set("collapsedAncestorId",t.id),t.trigger("change"))}})),Chorus.Comments.Collections.Flaggings=Backbone.Collection.extend({model:Chorus.Comments.Models.Flagging,initialize:function(e,t){this.users=t.users,this.comments=t.comments},parse:function(e){return e.flaggings||[]}}),Chorus.Comments.Collections.Users=Backbone.Collection.extend({model:Chorus.Comments.Models.User,parse:function(e,t){return e.users||[]},current:function(){return this.get(Chorus.Comments.context.user_id)}}),Chorus.Comments.Views.AccountActions=Backbone.View.extend({id:"",className:"",templateId:"comment-account-actions-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.AutoUpdateAlert=Backbone.View.extend({id:"autoupdate_info",templateId:"comment-auto-update-alert-template",events:{"click .close":"hide","click .go_to_comment":"goToComment"},initialize:function(e){this.listenTo(this.collection,"updateSuccess",this.show)},render:function(){return this.$el.hide(),this.trigger("render",this),this},show:function(e,t){if(Chorus.Comments.settings.showAutoUpdateAlert!==!1){var i=[];if(_.each(t.comments,function(t){if(t.user_id!==Chorus.Comments.context.user_id){var n=e.get(t.id),o=n.toJSON(),r=n.parent();r&&(o.parent=r.toJSON()),i.push(o)}}),0!==i.length){var n=this.template({comments:i,settings:Chorus.Comments.settings});this.$el.html(n).fadeIn(1e3),setTimeout(_.bind(this.hide,this),Chorus.Comments.settings.autoUpdateAlertTimeShown)}}},hide:function(){return this.$el.fadeOut(500),!1},goToComment:function(e){var t=e.currentTarget.getAttribute("data-comment-id");return Chorus.Comments.trigger("activateComment",t),!1}}),Chorus.Comments.Views.BaseForm=Backbone.View.extend({events:{"submit form":"submit","click .post_comment_button":"post","click .preview_comment_button":"preview","click .cancel_comment_button":"cancel","focusin textarea":"hideTouchTools","focusout textarea":"showTouchTools"},renderPreview:function(e){return this.previewView?this.previewView.model=e:this.previewView=new Chorus.Comments.Views.Comment({model:e}),this.previewView.render().$el.prependTo(this.el),this.$(".preview-controls").show(),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){return this.previewView?this.post():this.preview(),!1},post:function(){var e=this.$(".post_comment_button");e.prop("disabled",!0).val(this.submitText+"ing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("postSuccess",function(){this.cancel()},this),t.once("postError",function(){e.prop("disabled",!1).val(this.submitText)},this),t.post(),!1},preview:function(){var e=this.$(".preview_comment_button");e.prop("disabled",!0).val("Previewing...");var t=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});return t.once("previewSuccess",this.renderPreview,this),t.once("previewError",function(){e.prop("disabled",!1).val("Preview")},this),t.preview(),!1},remove:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),Backbone.View.prototype.remove.call(this)},hideTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.hide()},showTouchTools:function(){"undefined"!=typeof Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.show()}}),Chorus.Comments.Views.Comment=Backbone.View.extend({templateId:"comment-template",events:{"click .reply_link":"reply","click .edit_link":"edit","click .flag_link":"toggleFlagged","click .rec_link":"toggleRecommended","click .delete_link":"destroy","click .hide_link":"toggleHidden","click .up_link":"activateParent","click .actions_toggle":"toggleActions","click .inspect_flags_link":"inspectFlags","click .inspect_user_link":"inspectUser","click .block_user_link":"blockUser","click .collapse_toggle":"toggleCollapsed","click .image_toggle .message":"toggleImage"},renderTriggers:["id","parent_id","title","body","user_id","signature","hidden","created_on_long","created_on_short","created_on_timestamp","recommended_flags_count","is_recommended_by_user","troll_flags_count","spam_flags_count","inappropriate_flags_count","bad_flags_count","is_flagged_by_user"],initialize:function(){return this.listenTo(this.model,"change:"+this.renderTriggers.join(" change:"),this.render),this.listenTo(this.model,"change",this.regenerateWrapperClass),this.listenTo(this.model,"markRead",this.markCollapsedDescendantsRead),this.listenTo(this.model,"remove",this.remove),this},className:function(){var e=this.model.toJSON(),t=Chorus.Comments.context,i=[],n=function(e,t){t?i.push(e):i=_.without(i,e)};return this.el&&this.el.className&&(i=i.concat(this.el.className.split(" "))),n("citem",!0),n("cdepth-"+e.depth,!0),n("recommended",e.is_recommended),n("flagged",t.able_to_moderate&&e.is_flagged),n("new",e.is_new),n("hidden",e.hidden),n("obscured",e.obscured),n("collapsed",e.collapsed),n("collapsed-child",e.collapsedAncestorId),n("moderator",e.is_posted_by_moderator),n("preview",e.is_preview),_.uniq(i).join(" ")},attributes:function(){return{id:this.model.id}},delegateEvents:function(){},hasProfilePicture:function(){return this.model.user().get("profile_image")&&Chorus.Environment.currentBreakpoint().index>=Chorus.Comments.settings.avatarBreakpointIndex&&Chorus.Comments.settings.showAvatars},render:function(){var e=this.model.toJSON();return this.$el.html(this.template({view:this,context:Chorus.Comments.context,settings:Chorus.Comments.settings,comment:e})),this.model.isEditable()&&this.updateEditCountdown(),Chorus.Comments.settings.removeImages?this.removeImages():this.makeImagesHideable(),Chorus.Comments.settings.removeEmoji&&this.$(".cbody img.emoji").each(function(){jQuery(this).replaceWith(this.getAttribute("alt"))}),this.replyForm&&(this.$el.append(this.replyForm.el),this.replyForm.delegateEvents()),this.trigger("render",this),this},makeImagesHideable:function(){var e=this.$(".cbody img:not(.emoji)");e.wrap('<span href="#" class="image_toggle"></span>').parent().toggleClass("hidden",!Chorus.Comments.settings.showImages).append('<span class="message"></span>'),Chorus.Modernizr.localstorage&&e.each(function(){var e=jQuery(this);localStorage.getItem(e.attr("src"))&&e.parent().addClass("hidden")})},removeImages:function(){this.$(".cbody img:not(.emoji)").remove()},toggleImage:function(e){if(jQuery(e.currentTarget).parent().toggleClass("hidden"),Chorus.Modernizr.localstorage){var t=jQuery(e.currentTarget).parent(),i=t.find("img").attr("src");t.hasClass("hidden")?localStorage.setItem(i,"hidden"):localStorage.removeItem(i)}return!1},renderReplyCounts:function(){var e=this.model.descendants(),t=e.length;if(t>0){var i=_.filter(e,function(e){return e.get("is_new")}).length,n=1===t?"1 reply":t+" replies";i>0&&(n+=", "+i+" new"),this.$(".reply_count").text(n)}},regenerateWrapperClass:function(){this.$el.attr("class",this.className())},updateEditCountdown:function(){var e=Chorus.Comments.settings.editTimeWindow-this.model.secondsSinceCreate();e>0?(this.$(".countdown_timer").text(Math.round(e)),this.$(".countdown_timer_bar").width(100*(e/Chorus.Comments.settings.editTimeWindow)+"%"),setTimeout(_.bind(this.updateEditCountdown,this),1e3)):(this.$(".edit_link").remove(),this.$(".countdown_timer").text(""),this.$(".countdown_timer_bar").remove())},reply:function(){if(Chorus.Comments.context.user_id)if(Chorus.Comments.context.able_to_comment)this.replyForm||(this.replyForm=new Chorus.Comments.Views.ReplyForm({model:this.model,collection:this.model.collection}),this.replyForm.renderTo(this.el),this.listenTo(this.replyForm,"cancel",function(){this.replyForm=null}));else{var e=jQuery("#comment_tease, #comments .m-user-msg__account-action, #comments .m-user-msg__membership_required").offset();e&&jQuery("html, body").animate({scrollTop:e.top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})}else Chorus.Auth.modal.open("login");return!1},edit:function(){this.$el.addClass("ui-state-editing");var e=new Chorus.Comments.Views.EditForm({model:this.model});return e.render().$el.prependTo(this.el),e.once("cancel",function(){this.$el.removeClass("ui-state-editing")},this),!1},toggleHidden:function(){var e=this.model.get("hidden"),t=_.any(this.model.ancestors(),function(e){return e.get("hidden")});return t?alert("You can't "+(e?"unhide":"hide")+" this comment, because its parents are already hidden."):e?this.model.unhide():this.model.hide(),!1},destroy:function(){var e=confirm("You're about to delete this comment and all its replies. Are you sure?");return e===!0&&this.model.destroy(),!1},blockUser:function(){var e=["Spam ban is to be used exclusively for obvious spam, and not for normal moderation of community members.","","This action will ban the user from all Chorus communities (not just this one) and delete their comments. It is not reversible."].join("\n");return confirm(e)&&("BAN"==prompt("Enter the word 'BAN' (all caps) to confirm.")?this.model.blockUser():alert("Confirmation did not match.")),!1},toggleActions:function(){return this.$el.toggleClass("ui-state-tools-active"),!1},toggleRecommended:function(){return this.model.get("is_recommended_by_user")?this.model.unrecommend():this.model.recommend(),!1},toggleFlagged:function(){return this.model.get("is_flagged_by_user")?this.model.unflag():new Chorus.Comments.Views.FlagDialog({model:this.model}).render(),!1},inspectFlags:function(){return new Chorus.Comments.Views.InspectFlagsDialog({model:this.model}).render(),!1},inspectUser:function(){var e=this.model.user();return window.open(e.get("inspect_user_url")),!1},toggleCollapsed:function(){return this.model.get("collapsed")?this.uncollapse():(this.collapse(),this.renderReplyCounts()),!1},collapse:function(){this.model.set("collapsed",!0)},uncollapse:function(){this.model.set("collapsed",!1)},activate:function(){this.$el.addClass("active"),jQuery("html, body").stop(!0).animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})},activateParent:function(){var e=this.model.parent();return e&&Chorus.Comments.trigger("activateComment",e.id),!1},deactivate:function(){this.$el.removeClass("active")},markCollapsedDescendantsRead:function(){this.model.get("collapsed")&&(_.each(this.model.descendants(),function(e){e.set("is_new",!1)}),this.renderReplyCounts())}}),Chorus.Comments.Views.CommentList=Backbone.View.extend({id:"comments_list",className:"comment_master_list",childSelector:".citem",childView:Chorus.Comments.Views.Comment,shortcuts:{"Shift+a":"markAllRead","Shift+c":"activatePrev",c:"activateNext",j:"activateNext",k:"activatePrev",x:"markRead",z:"markReadAndActivateNext",r:"replyToCurrent"},initialize:function(){this.childViews={},this.listenTo(this.collection,"loadSuccess",this.renderAll),this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"loadSuccess add",this.renderEmbeds),this.listenTo(Chorus.Comments,"activateComment",this.activateId),this.listenTo(this,"renderAll",this.activateHash),_.each(this.shortcuts,function(e,t){shortcut.add(t,_.bind(this[e],this),{disable_in_input:!0,type:"keypress"})},this)},render:function(){return this},delegateEvents:function(){return _.each(this.childView.prototype.events,function(e,t){var i=t.match(/^(\S+)\s+(.+)$/),n=i[1],o=i[2],r=this.childViews,a=this.childSelector;this.$el.on(n+".delegateEvents",a+" "+o,function(t){var i=jQuery(this).closest(a),n=r[i.attr("id")];return n?n[e].call(n,t):void 0})},this),Backbone.View.prototype.delegateEvents.call(this)},removeAll:function(){return this.$el.empty(),this.trigger("removeAll",this),this.childViews={},this},removeOne:function(e){var t=this.childViews[e.id];return t&&t.remove(),delete this.childViews[e.id],this.trigger("removeOne",this,t,e),this},renderAll:function(){var e=Chorus.Comments.settings;return this.renderPage(0,e.renderChunkLength)},renderPage:function(e,t){var i=(Chorus.Comments.settings,_.map(this.collection.slice(e,t),function(e){return this.renderOne(e,!1).el},this));if(this.$el.append(i),this.trigger("renderPage",this,e,t),t<this.collection.length){e=t,t=Math.min(this.collection.length,e+Chorus.Comments.settings.renderChunkLength);var n=function(){this.renderPage(e,t)};setTimeout(_.bind(n,this),0)}else this.trigger("renderAll",this);return this},renderOne:function(e,t){var i=this.childViews[e.id]||new this.childView({model:e});if(this.childViews[e.id]=i.render(),t){for(var n,o=this.collection.length,r=this.collection.indexOf(e)+1;!n&&o>r;)n=this.collection.at(r++),n=n&&this.childViews[n.id];n?n.$el.before(i.el):this.$el.append(i.el),this.trigger("renderOne",this,i,e)}return i},renderEmbeds:function(){window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load()},activeModel:function(){return this.activeId?this.collection.get(this.activeId):null},activeView:function(){return this.activeId?this.childViews[this.activeId]:null},activateId:function(e){var t=this.activeView(),i=this.childViews[e];return t&&t.deactivate(),i&&(i.$el.hasClass("collapsed-child")?this.activateId(i.model.get("parent_id")):(i.activate(),this.activeId=e)),this},activateHash:function(){var e=window.location.hash.match(/^#(\d+)$/);e&&setTimeout(_.bind(this.activateId,this,e[1]),1e3)},activateNeighbor:function(e){var t,i=this.activeModel();if(i)t=i[e]({is_new:!0},!0);else for(t="next"===e?this.collection.first():this.collection.last();t&&!t.get("is_new");)t=t[e]();return t?this.activateId(t.id):void 0},activatePrev:function(){this.collection.loaded?this.activateNeighbor("prev"):this.loadThenRun("activatePrev")},activateNext:function(){this.collection.loaded?this.activateNeighbor("next"):this.loadThenRun("activateNext")},markRead:function(){var e=this.activeModel(),t=this.activeView();e&&(e.set("is_new",!1),e.trigger("markRead")),t&&t.deactivate()},markAllRead:function(){_.each(this.collection.where({is_new:!0}),function(e){e.set("is_new",!1)})},markAllUnread:function(){this.collection.each(function(e){e.set("is_new",!0)}),this.activeId||(this.activeId=this.collection.first().id)},markReadAndActivateNext:function(){this.collection.loaded?(this.markRead(),this.activateNext()):this.loadThenRun("markReadAndActivateNext")},replyToCurrent:function(){var e=this.activeView();e&&e.reply()},loadThenRun:function(e){jQuery("html, body").animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.animationDuration}),Chorus.Comments.settings.startOnScroll||Chorus.Comments.start(),this.listenToOnce(this.collection,"loadSuccess",this[e])}}),Chorus.Comments.Views.CommentsClosedNotice=Backbone.View.extend({templateId:"comments-closed-notice-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.EditForm=Backbone.View.extend({className:"cedit cform",templateId:"comment-edit-form-template",events:{"submit form":"submit","click .post_edit_button":"submit","click .cancel_edit_button":"cancel"},render:function(){return this.$el.html(this.template({comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.trigger("render",this),this},formData:function(){var e=this.$("form").serializeArray(),t={};return _.each(e,function(e){t[e.name]=e.value}),t},submit:function(){var e=this.$(".post_edit_button");return e.prop("disabled",!0).val("Saving..."),this.model.once("editSuccess",function(){this.cancel()},this),this.model.once("editError",function(){e.prop("disabled",!1).val("Save")},this),this.model.edit(this.formData()),!1},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.FlagDialog=Backbone.View.extend({templateId:"comment-flag-dialog-template",events:{"submit form":"submit"},render:function(){var e=this.template({comment:this.model.toJSON()});return Chorus.Comments.openModal(e),this.setElement("#comment_flag_modal"),this.trigger("render",this),this},submit:function(){return this.model.flag(this.$("form").serialize()),Chorus.Comments.closeModal(),!1}}),Chorus.Comments.Views.Footer=Backbone.View.extend({templateId:"comments-footer-template",render:function(){return this.$el.html(this.template()),this.trigger("render",this),this}}),Chorus.Comments.Views.FormattingGuide=Backbone.View.extend({id:"comment_formatting_guide",templateId:"comment-formatting-guide-template",render:function(){return this.$el.html(this.template()).hide(),this.trigger("render",this),this}}),Chorus.Comments.Views.Header=Backbone.View.extend({className:"comments-header ui-state-unloaded",templateId:"comments-header-template",events:{"click .show_comments_link":"loadComments","click .tips_link":"toggleTips","click .auto_update_alert_toggle":"toggleAutoUpdateAlert","click .touch_tools_toggle":"toggleTouchTools"},initialize:function(){this.listenTo(Chorus.Comments,"start",this.showLoadingIndicator),this.listenTo(this.collection,"loadSuccess",this.hideLoadingIndicator),this.listenTo(this.collection,"loadError",this.showLoadError),this.listenTo(this.collection,"loadSuccess",this.render),this.listenTo(this.collection,"updateSuccess",this.updateCount)},render:function(){return this.$el.html(this.template({context:Chorus.Comments.context,settings:Chorus.Comments.settings})),this.trigger("render",this),this},loadComments:function(){return Chorus.Comments.start(),!1},toggleTips:function(){return this.$el.toggleClass("ui-state-tips-active"),!1},showLoadError:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-loading").addClass("ui-state-load-error")},showLoadingIndicator:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-load-error").addClass("ui-state-loading")},hideLoadingIndicator:function(){this.$el.removeClass("ui-state-unloaded").removeClass("ui-state-loading").removeClass("ui-state-load-error").addClass("ui-state-loaded")},updateCount:function(){this.$(".count").text(this.collection.length)},toggleAutoUpdateAlert:function(){var e=!Chorus.Comments.settings.showAutoUpdateAlert;return Chorus.Comments.settings.showAutoUpdateAlert=e,this.$(".auto_update_alert_toggle").text(e?"Hide it!":"Show it!"),!1},toggleTouchTools:function(){return Chorus.Comments.view.touchTools&&Chorus.Comments.view.touchTools.toggle(),!1}}),Chorus.Comments.Views.InspectFlagsDialog=Backbone.View.extend({templateId:"comment-inspect-flags-dialog-template",render:function(){if(!this.model.flaggingsLoaded)return this.model.once("loadFlaggingsSuccess",this.render,this),this.model.loadFlaggings(),this;var e=this.template({comment:this.model.toJSON(),flaggings:_.invoke(this.model.flaggings(),"toJSON")});return Chorus.Comments.openModal(e),this.setElement("#inspect_flags_modal"),this.trigger("render",this),this}}),Chorus.Comments.Views.MainForm=Chorus.Comments.Views.BaseForm.extend({id:"main_comment_form",className:"cform cform-main",templateId:"comment-main-form-template",submitText:"Post",events:function(){var e=_.clone(Chorus.Comments.Views.BaseForm.prototype.events);return e["click #formatting_guide_links a"]="toggleFormattingGuide",e},render:function(){this.$el.html(this.template({context:Chorus.Comments.context})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);var e=new Chorus.Comments.Views.FormattingGuide;return e.render().$el.appendTo(this.el),this.trigger("render",this),this},cancel:function(){return this.previewView&&(this.previewView.remove(),this.previewView=null),this.$(".preview-controls").hide(),this.$(".post_comment_button").prop("disabled",!1).val("Post"),this.$(".preview_comment_button").prop("disabled",!1).val("Preview"),this.$("form").get(0).reset(),this.trigger("cancel"),!1},toggleFormattingGuide:function(e){return jQuery(e.target).hide().siblings().show(),jQuery("#comment_formatting_guide").slideToggle(),!1}}),Chorus.Comments.Views.Main=Backbone.View.extend({events:{"click .spoiler":"toggleSpoiler"},initialize:function(){var e=Chorus.Comments.Views;this.header=new e.Header({collection:this.collection}),this.commentList=new e.CommentList({collection:this.collection}),this.footer=new e.Footer,Chorus.Comments.settings.startOnScroll&&this.pollScrollPosition(),this.listenTo(this.collection,"loadSuccess",this.renderWithContext),this.listenTo(this.collection,"loadError",this.renderError)},render:function(){return this.$el.append(this.header.render().el,this.commentList.render().el),this.trigger("render",this),this},remove:function(){return this.header.remove(),this.commentList.remove(),this.footer.remove(),this.mainForm&&this.mainForm.remove(),this.touchTools&&this.touchTools.remove(),this.autoUpdateAlert&&this.autoUpdateAlert.remove(),this.$el.remove(),this},renderWithContext:function(){var e=Chorus.Comments.Views,t=Chorus.Comments.context,i=Chorus.Comments.settings,n=!1;t.comments_closed?(this.mainForm=new e.CommentsClosedNotice,n=!0):t.able_to_comment?this.mainForm=new e.MainForm({collection:this.collection}):(this.mainForm=new Backbone.View,n=!0);var o=new e.AccountActions;return this.$el.append(o.render().el,this.mainForm.render().el,this.footer.render().el),n&&!_.isUndefined(Chorus.Auth)&&Chorus.Auth.init(),t.able_to_comment&&Chorus.Environment.touch()&&(this.touchTools=new e.TouchTools({collection:this.collection
}),this.touchTools.render().$el.appendTo(this.el)),i.autoUpdateEnabled&&i.showAutoUpdateAlert&&(this.autoUpdateAlert=new e.AutoUpdateAlert({collection:this.collection}),this.autoUpdateAlert.render().$el.appendTo(this.el)),this.trigger("render",this),this},renderError:function(){this.$el.append('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later</h2>')},pollScrollPosition:function(){var e=this.$el,t=jQuery(window),i=Chorus.Comments.settings.scrollBuffer,n=function(){e.offset().top-t.scrollTop()-t.height()-i<0&&Chorus.Comments.start()};n=_.throttle(n,200),n(),t.on("scroll",n),Chorus.Comments.once("start",function(){t.off("scroll",n)})},toggleSpoiler:function(e){return jQuery(e.target).toggleClass("reveal_spoiler"),!1}}),Chorus.Comments.Views.ReplyForm=Chorus.Comments.Views.BaseForm.extend({className:"cform",templateId:"comment-reply-form-template",submitText:"Reply",renderTo:function(e){return this.$el.html(this.template({context:Chorus.Comments.context,comment:this.model.toJSON()})),this.$("textarea").markItUp(Chorus.Comments.settings.markItUp),this.$el.appendTo(e),this.$("[autofocus]:first").focus(),this.trigger("render",this),this},cancel:function(){return this.remove(),this.trigger("cancel"),!1}}),Chorus.Comments.Views.TouchTools=Backbone.View.extend({id:"comment_touch_tools",templateId:"comment-touch-tools-template",events:{"click .close":"toggle","click .refresh":"refresh","click .next":"activateNext","click .mark":"markAllRead"},initialize:function(){this.listenTo(this.collection,"updateSuccess updateError",this.stopLoading)},render:function(){return this.$el.html(this.template()),this.trigger("render",this),this},toggle:function(){return this.$el.toggle(),!1},refresh:function(){return this.$el.addClass("loading"),this.collection.update(),!1},stopLoading:function(){this.$el.removeClass("loading")},activateNext:function(){return Chorus.Comments.view.commentList.markReadAndActivateNext(),!1},markAllRead:function(){return Chorus.Comments.view.commentList.markAllRead(),!1},show:function(){return this.$el.show(),!1},hide:function(){return this.$el.hide(),!1}});var Chorus=Chorus||{};Chorus.RemoteEntryAdminPermissions=function(e){"use strict";function t(){var t=e(s).map(function(t,i){return e(i).data(r)});t=_.uniq(_.compact(t)).sort(),t.length&&e.ajax({method:"GET",url:a,dataType:"json",data:{entry_ids:t.join(":")},success:i,error:n})}function i(e){o=_.extend(o,{loaded:!0},e),Chorus.EventDispatcher.publish("permissionsLoaded",_.clone(o),!0)}function n(){console&&console.error("there was an error loading the permissions object from the client controls")}var o={loaded:!1},r="remote-admin-entry-id",a="/remote_entry_admin/check_permissions",s="*[data-"+r+"]";return{init:function(){Chorus.Context.logged_in!==!1&&t()},getPermissions:function(){return o}}}(jQuery),jQuery(Chorus.RemoteEntryAdminPermissions.init);var Chorus=Chorus||{};Chorus.EntryAdminControls=function(e){"use strict";function t(t){e(f).each(function(i,n){var o=e(n),r=o.data(m),a=t[r];if(a&&a.permitted===!0){var s=o.data(p);"button"===s&&(o.append(C(a)),o.on("click",l)),"pane"===s&&o.load(g,{entry_id:r},function(){o.on("mouseenter",c),o.on("mouseleave",d)})}}),e("body").on("click","#inspect-images-link",u),e("body").on("click","#hide-entry-link",h)}function i(e){Chorus.EventDispatcher.publish("modal_open",{url:v,data:{entry_id:e}})}function n(e){return"*[data-"+m+'="'+e+'"][data-'+p+'="pane"]'}function o(t){e(n(t)).addClass("is-active")}function r(t){e(n(t)).removeClass("is-active")}function a(t){var i="Hidden"===t.text();t.text(i?"Unhiding":"Hiding"),e.ajax({method:"POST",url:t.attr("href"),dataType:"text",complete:function(){location.reload(!0)}})}function s(e){t(e)}function l(t){if(Util.UserAgentProfiler.isMobile()===!1){var o=e(t.delegateTarget).data(m);e(n(o)).length<1&&(t.preventDefault(),i(o))}}function c(t){o(e(t.delegateTarget).data(m))}function d(t){r(e(t.delegateTarget).data(m))}function u(t){t.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:w+"/"+e(t.target).data(m)})}function h(t){var i=confirm("Are you sure?");return i?(t.preventDefault(),void a(e(t.target))):!1}var m="remote-admin-entry-id",p="remote-admin-entry-type",f="*[data-"+p+"]",g="/remote_entry_admin/pane",v="/remote_entry_admin/actions_modal",w="/remote_entry_admin/image_sizes_modal",C=_.template('<a href="[%= data.edit_url%]">Edit Entry</a>');return{init:function(){Chorus.Context.logged_in!==!1&&Chorus.EventDispatcher.subscribe("permissionsLoaded",s)}}}(jQuery),jQuery(Chorus.EntryAdminControls.init);var Chorus=Chorus||{};Chorus.RemoteHeadlineEdit=function(e){"use strict";function t(t){var i=t.data("remote-headline-promo-headine"),n=e(C({current_headline:t.text().replace(/"/g,"&quot;"),headline_save_url:v,field:t.data(f),entry_id:t.data(p),include_buttons:i?!1:!0}));if(t.after(n),t.addClass("is-editing"),n.on("change",'input[type="text"]',h),n.on("click",'input[type="submit"]',u),n.on("click",'input[value="cancel"]',d),n.on("submit",function(e){e.preventDefault()}),i){var o=e(C({current_headline:i.replace(/"/g,"&quot;"),headline_save_url:v,field:g,entry_id:t.data(p),include_buttons:!0}));n.after(o),o.on("change",'input[type="text"]',h),o.on("click",'input[type="submit"]',u),o.on("click",'input[value="cancel"]',d),o.on("submit",function(e){e.preventDefault()})}}function i(t,i){return i===g&&(i="title"),e("*[data-"+f+'="'+i+'"][data-'+p+'="'+t+'"]')}function n(e){i(e.data(p),e.data(f)).removeClass("is-editing"),e.siblings(".m-inline-headline-edit__form").remove(),e.remove()}function o(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!0)}function r(e){e.find('input[type="text"], input[type="submit"]').prop("disabled",!1)}function a(e){e.data("remote-headline-edit-submit",!0)}function s(t){t.add(t.siblings(".m-inline-headline-edit__form")).each(function(t,a){var s=e(a);if(s.data("remote-headline-edit-submit")===!0){var l=s.find('input[name="entry_id"]').val(),c=s.find('input[name="new_value"]').val(),d=s.find('input[name="field"]').val();o(s),e.ajax({method:"POST",url:v,dataType:"json",data:{entry_id:l,field:d,value:c},success:function(e){d===g?i(l,"title").data("remote-headline-promo-headine",c):i(l,d).text(c),n(s),alert(Util.stringToTitleCase(d.replace(/_/g," "))+" saved!")},error:function(e,t){r(s),alert("There was an error recieving data from the server.")}})}})}function l(t){e("*[data-"+f+"]").each(function(i,n){var o=e(n),r=t[o.data(p)];r&&r.permitted===!0&&(o.addClass("is-editable"),o.on("click",c))})}function c(i){i.preventDefault();var n=e(i.delegateTarget);n.hasClass("is-editing")===!1&&t(n)}function d(t){t.preventDefault(),n(e(t.delegateTarget))}function u(t){t.preventDefault(),s(e(t.delegateTarget))}function h(t){a(e(t.delegateTarget))}function m(e){e.is_headline_editor===!0&&l(e)}var p="remote-admin-entry-id",f="remote-headline-edit",g="promo_headline_field",v="/remote_entry_admin/update_title",w=['<form action="[%= data.headline_save_url %]" data-'+p+'="[%= data.entry_id %]" data-'+f+'= "[%= data.field %]" method="post" class="m-inline-headline-edit__form">','<label for="new_value">[%= data.field.replace(/_/g, " ")  %]</label>','<input type="text" name="new_value" value="[%= data.current_headline %]" />','<input type="hidden" name="entry_id" value="[%= data.entry_id %]" />','<input type="hidden" name="field" value="[%= data.field %]" />','[% if (data.include_buttons === true) { %]<input type="submit" value="Save" class="p-button"/>','<input type="button" value="cancel" class="p-button" /> [% } %]',"</form>"].join(""),C=_.template(w);return{init:function(){Chorus.Context.logged_in!==!1&&Util.UserAgentProfiler.isMobile()!==!0&&Chorus.EventDispatcher.subscribe("permissionsLoaded",m)}}}(jQuery),jQuery(Chorus.RemoteHeadlineEdit.init);var Chorus=Chorus||{};Chorus.HubAdminMenu=function(e){"use strict";function t(){n.on("click",function(){n.toggleClass("is-open")}),i()}function i(){n.on("mouseenter",function(){if(!o){o=!0;var t=n.find(".m-quick_admin__pageviews");if(0!==t.length){var i=t.find(".m-quick_admin__pageviews-count"),r=window.location.hostname+window.location.pathname;e.ajax({method:"GET",dataType:"json",url:"http://providence.voxmedia.com/api/count.json",data:{event_name:"page_view",location:r},success:function(e){i.html(Number(e.count).toLocaleString()+" "+i.html()),t.show()}})}}})}var n=e("#hub-admin-menu"),o=!1;return{init:function(){t()}}}(jQuery),jQuery(Chorus.HubAdminMenu.init);var Util=Util||{};Util.UserAgentProfiler=function(){var e="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||navigator.msMaxTouchPoints>0,t=window.innerWidth,i=window.navigator.userAgent,n=e&&728>t||window.location.href.indexOf("mobile=true")>0,o=e&&t>=728,r=!n&&!o,a=/(iPad|iPhone|iPod)/g.test(i),s=a&&/OS\s(7|6_1_4)/g.test(i),l=/Android/g.test(i),c=!1,d=n?"mobile":o?"tablet":"desktop";if(i.indexOf("Android")>0)for(var u=i.split(";"),h=0,m=u.length;m>h;h++)if(u[h].indexOf("Android")>0){var p=u[h].split(" ");if(parseInt(p[p.length-1].split(".")[0])<3){c=!0;break}}return{screenWidth:function(){return t},profile:function(){return d},isTablet:function(){return o},isMobile:function(){return n},isDesktop:function(){return r},isAndroid:function(){return l},isAndroidLt3:function(){return c},isIOS:function(){return a},isIOS7:function(){return s},deviceTypeForAds:function(){return this.profile()},browserWidthForAds:function(){return Chorus.Environment.currentBreakpoint().name},doNotTrack:function(){var e;if(void 0!==navigator.doNotTrack)e=navigator.doNotTrack;else if(void 0!==window.doNotTrack)e=window.doNotTrack;else{if(void 0===navigator.msDoNotTrack)return"unsupported";e=navigator.msDoNotTrack}return/1|yes|true/.test(e)?"1":"0"}}}();var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(e){e.domains=e.domains||Kicksend.mailcheck.defaultDomains,e.topLevelDomains=e.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains,e.distanceFunction=e.distanceFunction||Kicksend.sift3Distance;var t=Kicksend.mailcheck.suggest(encodeURI(e.email),e.domains,e.topLevelDomains,e.distanceFunction);t?e.suggested&&e.suggested(t):e.empty&&e.empty()},suggest:function(e,t,i,n){if(e=e.toLowerCase(),e=this.splitEmail(e),t=this.findClosestDomain(e.domain,t,n)){if(t!=e.domain)return{address:e.address,domain:t,full:e.address+"@"+t}}else if(i=this.findClosestDomain(e.topLevelDomain,i),e.domain&&i&&i!=e.topLevelDomain)return t=e.domain,t=t.substring(0,t.lastIndexOf(e.topLevelDomain))+i,{address:e.address,domain:t,full:e.address+"@"+t};return!1},findClosestDomain:function(e,t,i){var n,o=99,r=null;if(!e||!t)return!1;i||(i=this.sift3Distance);for(var a=0;a<t.length;a++){if(e===t[a])return e;n=i(e,t[a]),o>n&&(o=n,r=t[a])}return o<=this.threshold&&null!==r?r:!1},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var i=0,n=0,o=0,r=0;i+n<e.length&&i+o<t.length;){if(e.charAt(i+n)==t.charAt(i+o))r++;else for(var a=o=n=0;5>a;a++){if(i+a<e.length&&e.charAt(i+a)==t.charAt(i)){n=a;break}if(i+a<t.length&&e.charAt(i)==t.charAt(i+a)){o=a;break}}i++}return(e.length+t.length)/2-r},splitEmail:function(e){if(e=e.split("@"),2>e.length)return!1;for(var t=0;t<e.length;t++)if(""===e[t])return!1;var i=e.pop(),n=i.split("."),o="";if(0==n.length)return!1;if(1==n.length)o=n[0];else{for(t=1;t<n.length;t++)o+=n[t]+".";2<=n.length&&(o=o.substring(0,o.length-1))}return{topLevelDomain:o,domain:i,address:e.join("@")}}}};window.jQuery&&function(e){e.fn.mailcheck=function(e){var t=this;if(e.suggested){var i=e.suggested;e.suggested=function(e){i(t,e)}}if(e.empty){var n=e.empty;e.empty=function(){n.call(null,t)}}e.email=this.val(),Kicksend.mailcheck.run(e)}}(jQuery);var Chorus=Chorus||{};Chorus.Auth=function(e){return{init:function(){e('*[data-chorus-auth="login"]').on("click",function(e){e.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:Chorus.Context.login_action,includeCloseButton:!0})}),e('*[data-chorus-auth="register"]').on("click",function(e){e.preventDefault(),Chorus.EventDispatcher.publish("modal_open",{url:Chorus.Context.register_action,includeCloseButton:!0})})}}}(jQuery),jQuery(function(){Chorus.Auth.init()}),/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
function(e,t){var i=e(t);e.fn.lazyload=function(n){function o(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function r(){var t=0;s.each(function(){var i=e(this);if(!l.skip_invisible||i.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else i.trigger("lazyload:appear")})}var a,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(n&&(void 0!==n.failurelimit&&(n.failure_limit=n.failurelimit,delete n.failurelimit),void 0!==n.effectspeed&&(n.effect_speed=n.effectspeed,delete n.effectspeed),e.extend(l,n)),a=void 0===l.container||l.container===t?i:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return r()};a.bind(l.event,o(c,l.scrollInterval))}this.each(function(){var i=this,n=e(i);i.loaded=!1,i.error_event_set=!1;var r=4e3,a=4,c=0,d=function(){if(!this.loaded){if(l.appear){var o=s.length;l.appear.call(i,o,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){n.hide().attr("src",n.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),i.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var o=s.length;l.load.call(i,o,l)}}).bind("error",function(){i.error_event_set||t.setTimeout(e.proxy(u,this),r),i.error_event_set=!0}).attr("src",n.attr("data-"+l.data_attribute));else{n.css("background-image","url('"+n.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),i.loaded=!0;var a=e.grep(s,function(e){return!e.loaded});if(s=e(a),l.load){var o=s.length;l.load.call(i,o,l)}}}},u=function(){if(c+=1,a>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(u,this),r)});var i=this.src.split("?")[0];this.src=i+"?"+(new Date).getTime()}};if(n.one("lazyload:appear",d),0!==l.event.indexOf("scroll")){var h=function(e){i.loaded||n.trigger("lazyload:appear")};n.bind(l.event,o(h,l.scrollInterval))}});var d=function(e){r()};return i.bind("resize",o(d,l.resizeInterval)),r(),this},e.belowthefold=function(n,o){var r;return r=void 0===o.container||o.container===t?i.height()+i.scrollTop():e(o.container).offset().top+e(o.container).height(),r<=e(n).offset().top-o.threshold},e.rightoffold=function(n,o){var r;return r=void 0===o.container||o.container===t?i.width()+i.scrollLeft():e(o.container).offset().left+e(o.container).width(),r<=e(n).offset().left-o.threshold},e.abovethetop=function(n,o){var r;return r=void 0===o.container||o.container===t?i.scrollTop():e(o.container).offset().top,r>=e(n).offset().top+o.threshold+e(n).height()},e.leftofbegin=function(n,o){var r;return r=void 0===o.container||o.container===t?i.scrollLeft():e(o.container).offset().left,r>=e(n).offset().left+o.threshold+e(n).width()},e.inviewport=function(t,i){return!(e.rightofscreen(t,i)||e.leftofscreen(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,i){var s={failure_limit:20,load:function(){var t=e(this),i=t.parent(".image-window");if(t.is("img")&&(i.length>0?(t.css({position:"absolute",top:Math.round((i.outerHeight()-t.outerHeight())/2),left:Math.round((i.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(r),t.removeClass(a),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var n=Chorus.Context.gif_opts||{};if(Chorus.Context&&Chorus.Context.main_link_color&&(n.circleBackgroundColor=Chorus.Context.main_link_color,n.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var o=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),s=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');o.length+s.length===1?PLAYGIF_DISABLE_FLAG=!0:o&&o.length>0&&(PLAYGIF_DISABLE_FLAG=!1,o.playGIF(n))}t.playGIF(n)}},threshold:800};i&&e.extend(s,i),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(o+":visible").not("."+a+", ."+r),c=[],d=[];l.each(function(){var t,i,o,r,l,u=e(this),h=u.attr("data-imgkey"),m=u.data("chorus-asset-id");if("undefined"!=typeof h){if(s.parentDimensionSlc){var p=u.closest(s.parentDimensionSlc);t=p.outerWidth(),i=p.outerHeight()}t||(t=u.outerWidth()),i||(i=u.outerHeight()),0==i&&(o=u.data("ratio"),i="undefined"!=typeof o&&o>0?Math.ceil(t/o):t),u.is("img")&&(o=u.data("ratio"),r=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(i=Math.ceil(t/o)),r.length>0&&(t=Math.ceil(r.outerWidth()),i=Math.ceil(r.outerHeight())),i>0&&u.css("height",i)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),i=Math.ceil(i*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),i=Math.ceil(1.3*i)),/\.(png|jpg|jpeg)$/i.test(u.attr("data-original"))&&n.webp&&!Chorus.Modernizr.touch&&(l="webp");var f=h+":"+t+"x"+i+(l?":"+l:"");c.push(f),u.attr("data-dim",t+"x"+i),u.addClass(a)}else if("undefined"!=typeof m){t=u.outerWidth(),i=u.outerHeight(),u.is("img")&&(o=u.data("ratio"),r=u.parent(".image-window"),"undefined"!=typeof o&&o>0&&(i=Math.ceil(t/o)),r.length>0&&(t=Math.ceil(r.outerWidth()),i=Math.ceil(r.outerHeight())),i>0&&u.css("height",i)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),i=Math.ceil(i*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),i=Math.ceil(1.3*i));var g=m+":"+t+":"+i;d.push(g),u.data("asset-key",g),u.addClass(a)}else u.lazyload(s)}),(0!==c.length||0!==d.length)&&(e.each([d,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:d.join(",")},success:function(t){var i=t.urls,n={};_.forEach(i,function(e,t){var i=t.replace(/\:webp|\:jp2/,"");n[i]=e}),i=n,l.each(function(){var t,n=e(this);t=n.attr("data-imgkey")?n.attr("data-imgkey")+":"+n.attr("data-dim"):n.data("asset-key");var o=i[t];"undefined"!=typeof o&&(n.attr("data-original",o),n.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var i={},n={webp:!1,jp2:!1},o=".vox-lazy-load",r="lazy-loaded",a="lazy-loading";return i.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))n.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,o();else{var e=new Image;e.onload=function(){n.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",n.webp),o()},e.onerror=function(){n.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",n.webp),o()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function o(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:i.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},i.initUI=function(e,i){t(e,i)},i.applyTo=function(e,i){t(e,i)},i}(jQuery),function(){"use strict";/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */
function e(t,n){function o(e,t){return function(){return e.apply(t,arguments)}}var r;if(n=n||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=n.touchBoundary||10,this.layer=t,this.tapDelay=n.tapDelay||200,this.tapTimeout=n.tapTimeout||700,!e.notNeeded(t)){for(var a=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,l=0,c=a.length;c>l;l++)s[a[l]]=o(s[a[l]],s);i&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,i,n){var o=Node.prototype.removeEventListener;"click"===e?o.call(t,e,i.hijacked||i,n):o.call(t,e,i,n)},t.addEventListener=function(e,i,n){var o=Node.prototype.addEventListener;"click"===e?o.call(t,e,i.hijacked||(i.hijacked=function(e){e.propagationStopped||i(e)}),n):o.call(t,e,i,n)}),"function"==typeof t.onclick&&(r=t.onclick,t.addEventListener("click",function(e){r(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,i=navigator.userAgent.indexOf("Android")>0&&!t,n=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,o=n&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=n&&/OS [6-7]_\d/.test(navigator.userAgent),a=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(n&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!i;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var i,n;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),n=t.changedTouches[0],i=document.createEvent("MouseEvents"),i.initMouseEvent(this.determineEventType(e),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),i.forwardedTouchEvent=!0,e.dispatchEvent(i)},e.prototype.determineEventType=function(e){return i&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;n&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,i;if(t=e.fastClickScrollParent,!t||!t.contains(e)){i=e;do{if(i.scrollHeight>i.offsetHeight){t=i,e.fastClickScrollParent=i;break}i=i.parentElement}while(i)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,i,r;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),i=e.targetTouches[0],n){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!o){if(i.identifier&&i.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=i.pageX,this.touchStartY=i.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],i=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>i||Math.abs(t.pageY-this.touchStartY)>i?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,a,s,l,c,d=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(c=e.changedTouches[0],d=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||d,d.fastClickScrollParent=this.targetElement.fastClickScrollParent),s=d.tagName.toLowerCase(),"label"===s){if(t=this.findControl(d)){if(this.focus(d),i)return!1;d=t}}else if(this.needsFocus(d))return e.timeStamp-a>100||n&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(d),this.sendClick(d,e),n&&"select"===s||(this.targetElement=null,e.preventDefault()),!1);return n&&!o&&(l=d.fastClickScrollParent,l&&l.fastClickLastScrollTop!==l.scrollTop)?!0:(this.needsClick(d)||(e.preventDefault(),this.sendClick(d,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;i&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,n,o,r;if("undefined"==typeof window.ontouchstart)return!0;if(n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!i)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(n>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(a&&(o=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),o[1]>=10&&o[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(r=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],r>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,i){return new e(t,i)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1);