/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2012 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.8.0.sbn
 * - Hacked so that it lazy loads non-IMG tags
 * - Hacked so that the scroll event that ends up firing lazyload:appear is debounced
 * - Hacked so resize event is debounced
 * - Hacked so data attributes are not cached via jQuery (neccesary for optimization)
 *
 */
!function(e,t){var i=e(t);e.fn.lazyload=function(n){function r(e,t){return"undefined"!=typeof _?_.debounce(e,t):e}function o(){var t=0;s.each(function(){var i=e(this);if(!l.skip_invisible||i.is(":visible"))if(e.abovethetop(this,l)||e.leftofbegin(this,l));else if(e.belowthefold(this,l)||e.rightoffold(this,l)){if(++t>l.failure_limit)return!1}else i.trigger("lazyload:appear")})}var a,s=this,l={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:t,data_attribute:"original",skip_invisible:!0,appear:null,load:null,scrollInterval:200,resizeInterval:250};if(n&&(void 0!==n.failurelimit&&(n.failure_limit=n.failurelimit,delete n.failurelimit),void 0!==n.effectspeed&&(n.effect_speed=n.effectspeed,delete n.effectspeed),e.extend(l,n)),a=void 0===l.container||l.container===t?i:e(l.container),0===l.event.indexOf("scroll")){var c=function(e){return o()};a.bind(l.event,r(c,l.scrollInterval))}this.each(function(){var i=this,n=e(i);i.loaded=!1,i.error_event_set=!1;var o=4e3,a=4,c=0,d=function(){if(!this.loaded){if(l.appear){var r=s.length;l.appear.call(i,r,l)}if("IMG"===this.tagName)e("<img />").bind("load",function(){n.hide().attr("src",n.attr("data-"+l.data_attribute))[l.effect](l.effect_speed),i.loaded=!0;var t=e.grep(s,function(e){return!e.loaded});if(s=e(t),l.load){var r=s.length;l.load.call(i,r,l)}}).bind("error",function(){i.error_event_set||t.setTimeout(e.proxy(h,this),o),i.error_event_set=!0}).attr("src",n.attr("data-"+l.data_attribute));else{n.css("background-image","url('"+n.attr("data-"+l.data_attribute)+"')")[l.effect](l.effect_speed),i.loaded=!0;var a=e.grep(s,function(e){return!e.loaded});if(s=e(a),l.load){var r=s.length;l.load.call(i,r,l)}}}},h=function(){if(c+=1,a>=c){e(this).bind("error",function(){t.setTimeout(e.proxy(h,this),o)});var i=this.src.split("?")[0];this.src=i+"?"+(new Date).getTime()}};if(n.one("lazyload:appear",d),0!==l.event.indexOf("scroll")){var u=function(e){i.loaded||n.trigger("lazyload:appear")};n.bind(l.event,r(u,l.scrollInterval))}});var d=function(e){o()};return i.bind("resize",r(d,l.resizeInterval)),o(),this},e.belowthefold=function(n,r){var o;return o=void 0===r.container||r.container===t?i.height()+i.scrollTop():e(r.container).offset().top+e(r.container).height(),o<=e(n).offset().top-r.threshold},e.rightoffold=function(n,r){var o;return o=void 0===r.container||r.container===t?i.width()+i.scrollLeft():e(r.container).offset().left+e(r.container).width(),o<=e(n).offset().left-r.threshold},e.abovethetop=function(n,r){var o;return o=void 0===r.container||r.container===t?i.scrollTop():e(r.container).offset().top,o>=e(n).offset().top+r.threshold+e(n).height()},e.leftofbegin=function(n,r){var o;return o=void 0===r.container||r.container===t?i.scrollLeft():e(r.container).offset().left,o>=e(n).offset().left+r.threshold+e(n).width()},e.inviewport=function(t,i){return!(e.rightofscreen(t,i)||e.leftofscreen(t,i)||e.belowthefold(t,i)||e.abovethetop(t,i))},e.extend(e.expr[":"],{"below-the-fold":function(t){return e.belowthefold(t,{threshold:0})},"above-the-top":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-screen":function(t){return e.rightoffold(t,{threshold:0})},"left-of-screen":function(t){return!e.rightoffold(t,{threshold:0})},"in-viewport":function(t){return!e.inviewport(t,{threshold:0})},"above-the-fold":function(t){return!e.belowthefold(t,{threshold:0})},"right-of-fold":function(t){return e.rightoffold(t,{threshold:0})},"left-of-fold":function(t){return!e.rightoffold(t,{threshold:0})}})}(jQuery,window);var PLAYGIF_DISABLE_FLAG;!function(e){e.fn.playGIF=function(t){var i=e.extend({on:"touchstart mouseenter",off:"touchstart mouseleave",autoResize:!1,enable:!0,circleBackgroundColor:"FFF200",circleTextColor:"4C4E4D",gifText:"GIF",removeAnchor:!0},t);"undefined"!=typeof PLAYGIF_DISABLE_FLAG&&(i.enable=!PLAYGIF_DISABLE_FLAG);var n=function(e,t,n){t=Math.floor(t),n=Math.floor(n);var r=35;e.fillStyle="#"+i.circleBackgroundColor,e.beginPath(),e.arc(t,n,r,0,2*Math.PI,!0),e.closePath(),e.fill(),e.fillStyle="#"+i.circleTextColor,e.font="15px 'Gotham SSm A', 'Gotham SSm B', sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(i.gifText,t,n)};return this.each(function(){if(i.enable!==!1){var t=e(this);if(!t.is("img")||!/\.gif$/i.test(t.attr("src")))return!0;var r=document.createElement("canvas");if("undefined"==typeof r.getContext)return!0;var o=r.getContext("2d"),a=new Image,s=function(e,t){t.on(i.off,function(){l(e,t)});var n=t.attr("src");t.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t.css({width:e.attr("width"),height:e.attr("height")}),setTimeout(function(){t.attr("src",n)},0),e.replaceWith(t)},l=function(e,t){e.on(i.on,function(){s(e,t)}),t.replaceWith(e)};a.onload=function(){var l=t.width(),c=t.height();r.width=l,r.height=c,o.drawImage(a,0,0,l,c);var d=e(r);if(i.autoResize===!0){r.setAttribute("data-src",t.attr("src")),r.setAttribute("class","gif");var h=e('<span class="faux-image">');h.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),"max-width":"100%",position:"relative",display:"block",height:r.height}),d.css({position:"absolute",top:0,left:0}),d=h.append(d)}else d.css({"float":t.css("float"),margin:t.css("margin"),padding:t.css("padding"),display:t.css("display")});t.replaceWith(d);var u=d.parent();u.is("p")||"none"===u.css("max-width")&&"none"===u.css("max-height")||(l=u.width(),c=u.height()),i.removeAnchor&&u.is("a")&&/\.gif$/i.test(u.attr("href"))&&u.replaceWith(d),l>150&&c>150&&n(o,l/2,c/2),d.on(i.on,function(){s(d,t)})},a.src=t.attr("src")}})}}(jQuery);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(e){function t(t,i){var s={failure_limit:20,load:function(){var t=e(this),i=t.parent(".image-window");if(t.is("img")&&(i.length>0?(t.css({position:"absolute",top:Math.round((i.outerHeight()-t.outerHeight())/2),left:Math.round((i.outerWidth()-t.outerWidth())/2)}),"undefined"==typeof t.attr("height")&&t.css("height","auto")):"undefined"==typeof t.attr("height")&&t.css("height","auto")),t.addClass(o),t.removeClass(a),t.removeClass("m-chorus-asset__in-entry-body"),e.fn.playGIF){var n=Chorus.Context.gif_opts||{};if(Chorus.Context&&Chorus.Context.main_link_color&&(n.circleBackgroundColor=Chorus.Context.main_link_color,n.circleTextColor="FFFFFF"),"undefined"==typeof PLAYGIF_DISABLE_FLAG){var r=e('.m-entry__body img[src*=".gif"], .m-entry__body img[data-original*=".gif"], .m-block__fanshot-media img[src*=".gif"]'),s=e('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');r.length+s.length===1?PLAYGIF_DISABLE_FLAG=!0:r&&r.length>0&&(PLAYGIF_DISABLE_FLAG=!1,r.playGIF(n))}t.playGIF(n)}},threshold:800};i&&e.extend(s,i),t=e("undefined"!=typeof t&&null!==t?t:"body");var l=t.find(r+":visible").not("."+a+", ."+o),c=[],d=[];l.each(function(){var t,i,r,o,l,h=e(this),u=h.attr("data-imgkey"),p=h.data("chorus-asset-id");if("undefined"!=typeof u){if(s.parentDimensionSlc){var m=h.closest(s.parentDimensionSlc);t=m.outerWidth(),i=m.outerHeight()}t||(t=h.outerWidth()),i||(i=h.outerHeight()),0==i&&(r=h.data("ratio"),i="undefined"!=typeof r&&r>0?Math.ceil(t/r):t),h.is("img")&&(r=h.data("ratio"),o=h.parent(".image-window"),"undefined"!=typeof r&&r>0&&(i=Math.ceil(t/r)),o.length>0&&(t=Math.ceil(o.outerWidth()),i=Math.ceil(o.outerHeight())),i>0&&h.css("height",i)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),i=Math.ceil(i*window.devicePixelRatio)),Chorus.Context&&"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),i=Math.ceil(1.3*i)),/\.(png|jpg|jpeg)$/i.test(h.attr("data-original"))&&n.webp&&!Chorus.Modernizr.touch&&(l="webp");var f=u+":"+t+"x"+i+(l?":"+l:"");c.push(f),h.attr("data-dim",t+"x"+i),h.addClass(a)}else if("undefined"!=typeof p){t=h.outerWidth(),i=h.outerHeight(),h.is("img")&&(r=h.data("ratio"),o=h.parent(".image-window"),"undefined"!=typeof r&&r>0&&(i=Math.ceil(t/r)),o.length>0&&(t=Math.ceil(o.outerWidth()),i=Math.ceil(o.outerHeight())),i>0&&h.css("height",i)),"undefined"!=typeof window.devicePixelRatio&&(t=Math.ceil(t*window.devicePixelRatio),i=Math.ceil(i*window.devicePixelRatio)),"racked"===Chorus.Context.network_slug&&(t=Math.ceil(1.3*t),i=Math.ceil(1.3*i));var g=p+":"+t+":"+i;d.push(g),h.data("asset-key",g),h.addClass(a)}else h.lazyload(s)}),(0!==c.length||0!==d.length)&&(e.each([d,c],function(e,t){t.sort(function(e,t){return+e.split(":")[0]-+t.split(":")[0]})}),e.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",timeout:1e4,data:{imgkeys:c.join(","),asset_keys:d.join(",")},success:function(t){var i=t.urls,n={};_.forEach(i,function(e,t){var i=t.replace(/\:webp|\:jp2/,"");n[i]=e}),i=n,l.each(function(){var t,n=e(this);t=n.attr("data-imgkey")?n.attr("data-imgkey")+":"+n.attr("data-dim"):n.data("asset-key");var r=i[t];"undefined"!=typeof r&&(n.attr("data-original",r),n.lazyload(s))})}}))}e(document).ready(function(){Chorus.DynamicSizedImages.init(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("dynamic-images-available",{},!0)});var i={},n={webp:!1,jp2:!1},r=".vox-lazy-load",o="lazy-loaded",a="lazy-loading";return i.init=function(){function e(){if(Chorus.Modernizr.localstorage&&window.localStorage.getItem("supportsWebp"))n.webp="true"===window.localStorage.getItem("supportsWebp")?!0:!1,r();else{var e=new Image;e.onload=function(){n.webp=!!(e.height>0&&e.width>0),Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",n.webp),r()},e.onerror=function(){n.webp=!1,Chorus.Modernizr.localstorage&&window.localStorage.setItem("supportsWebp",n.webp),r()},e.src="data:image/webp;base64,UklGRiYAAABXRUJQVlA4IBoAAAAwAQCdASoBAAEAAIAOJaQAA3AA/v89WAAAAA=="}}function r(){Chorus&&Chorus.Context&&Chorus.Context.defer_image_loading?Chorus.Context.defer_image_loading=!1:i.initUI(),Chorus.EventDispatcher&&Chorus.EventDispatcher.subscribe("moduleInserted",function(e){t(e.modules)})}e()},i.initUI=function(e,i){t(e,i)},i.applyTo=function(e,i){t(e,i)},i}(jQuery),function(e){function t(e){var t={};e=(e||"").replace(/^(\?|\&)/,"").split("&");for(var i=0;i<e.length;i++){var n=e[i].split("=");n.length>1&&(t[n[0]]=n[1])}return t}function i(i,n){var o=i.attr("href"),a=i.attr("data-url");if(a&&r[n]&&(o=r[n]+encodeURIComponent(a)),o&&"#"!==o[0]){var s=o.match(/(.*(?:\?|\&)(?:url|u)=)([^&]+)(.*)/),l=i.closest("[data-analytics-placement]").attr("data-analytics-placement"),c=decodeURIComponent(s[2]).split("?"),d=c[0].split("#"),h=d[0]||c[0],u=d[1]||"",p=e.extend({utm_campaign:location.hostname.replace(/(www\.)?(.+)\.com/,"$2"),utm_content:Chorus.Analytics.contentType()+(l?":"+l:""),utm_medium:"social",utm_source:n},t(c[1]),t(i.attr("data-params")));o=""==u.trim()?s[1]+encodeURIComponent(h+"?"+e.param(p))+s[3]:s[1]+encodeURIComponent(h+"?"+e.param(p)+"#"+u)+s[3],i.attr("href",o)}return o}var n,r={facebook:"http://www.facebook.com/share.php?u=",twitter:"https://twitter.com/intent/tweet?url=",pinterest:"https://www.pinterest.com/pin/create/button/?url="};e("[data-analytics-social]").on("click",function(t){var r,o,a=e(this),s=a.attr("data-analytics-social"),l=i(a,s),c=570,d=570;if(Chorus.Context.is_preview)return t.stopPropagation(),alert("Social buttons cannot be used during preview.");switch(s){case"facebook":d=279;break;case"twitter":d=279;break;case"linkedin":d=520;break;case"pinterest":c=d=750}if("#"!==l[0]&&"_blank"!==a.attr("target")&&"whatsapp"!==s){n&&n.close&&n.close(),o=screen.width/2-c/2,r=screen.height/2-d/2,n=window.open(l,"","width="+c+", height="+d+", top="+r+", left="+o),t.preventDefault();var h=window.open;window.open=function(){},setTimeout(function(){window.open=h},0)}}),function(e,t,i){function n(){var e,n=t.getElementsByTagName(i)[0],r=function(r,o){t.getElementById(o)||(e=t.createElement(i),e.src=r,e.id=o,n.parentNode.insertBefore(e,n))};Util.UserAgentProfiler.isAndroidLt3()||(r("https://connect.facebook.net/en_US/sdk.js","fbjs"),r("https://platform.twitter.com/widgets.js","tweetjs"))}e.addEventListener?e.addEventListener("load",n,!1):e.attachEvent&&e.attachEvent("onload",n)}(window,document,"script"),function(){function t(){d();var e=c,t=n.scrollTop(),r=t>=a,o=!s||s>=t;c=r&&o&&!l,c!==e&&(Chorus.EventDispatcher.publish("fixedSocial",{isFixed:c,position:i.position()}),i.toggleClass("fixed",c))}var i=e("#chorus-social-fixed");if(i.length){i.appendTo("body");var n=e(window),r=e("#chorus-social-fixed-threshold"),o=e("#comments"),a=0,s=0,l=!1,c=!1,d=_.throttle(function(){Chorus.Environment.touch()&&(l=screen.width>window.innerWidth),r.length&&(a=r.offset().top),o.length&&(s=o.offset().top)},1500);e(document).on("scroll",_.throttle(t,150)),t()}}(),e("[data-shareable-content]").each(function(){var t=e(this),i=t.attr("data-original")||t.attr("src");if(!i){var n=this.currentStyle||window.getComputedStyle(this,!1);i=n&&n.backgroundImage.slice(4,-1)}if(i){var o="m-shareable-content",a=o+"__wrap",s=r.pinterest+encodeURIComponent(location.href)+"&media="+encodeURIComponent(i),l=Chorus.Environment.touch()?" touch":"";if(t.is("img")){var c=t.closest("."+a);t=c.length?c:t.wrap('<div class="'+a+'"></div>').parent()}else t.toggleClass(a,!0);t.prepend('<a href="'+s+'" class="'+o+"__pinterest"+l+'" data-analytics-social="pinterest"></a>')}})}(jQuery),/*! Hammer.JS - v1.0.6 - 2014-01-02
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
function(e,t){"use strict";function i(){n.READY||(n.event.determineEventTypes(),n.utils.each(n.gestures,function(e){n.detection.register(e)}),n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0)}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&e.navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=e.document,n.plugins=n.plugins||{},n.gestures=n.gestures||{},n.READY=!1,n.utils={extend:function(e,i,n){for(var r in i)e[r]!==t&&n||(e[r]=i[r]);return e},each:function(e,i,n){var r,o;if("forEach"in e)e.forEach(i,n);else if(e.length!==t){for(r=0,o=e.length;o>r;r++)if(i.call(n,e[r],r,e)===!1)return}else for(r in e)if(e.hasOwnProperty(r)&&i.call(n,e[r],r,e)===!1)return},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],i=[];return n.utils.each(e,function(e){t.push("undefined"!=typeof e.clientX?e.clientX:e.pageX),i.push("undefined"!=typeof e.clientY?e.clientY:e.pageY)}),{pageX:(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(e,t,i){return{x:Math.abs(t/e)||0,y:Math.abs(i/e)||0}},getAngle:function(e,t){var i=t.pageY-e.pageY,n=t.pageX-e.pageX;return 180*Math.atan2(i,n)/Math.PI},getDirection:function(e,t){var i=Math.abs(e.pageX-t.pageX),r=Math.abs(e.pageY-t.pageY);return i>=r?e.pageX-t.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:e.pageY-t.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(e,t){var i=t.pageX-e.pageX,n=t.pageY-e.pageY;return Math.sqrt(i*i+n*n)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==n.DIRECTION_UP||e==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){t&&e&&e.style&&(n.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(i){n.utils.each(t,function(t){i&&(t=i+t.substring(0,1).toUpperCase()+t.substring(1)),t in e.style&&(e.style[t]=t)})}),"none"==t.userSelect&&(e.onselectstart=function(){return!1}),"none"==t.userDrag&&(e.ondragstart=function(){return!1}))}},n.Instance=function(e,t){var r=this;return i(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){r.enabled&&n.detection.startDetect(r,e)}),this},n.Instance.prototype={on:function(e,t){var i=e.split(" ");return n.utils.each(i,function(e){this.element.addEventListener(e,t,!1)},this),this},off:function(e,t){var i=e.split(" ");return n.utils.each(i,function(e){this.element.removeEventListener(e,t,!1)},this),this},trigger:function(e,t){t||(t={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t;var r=this.element;return n.utils.hasParent(t.target,r)&&(r=t.target),r.dispatchEvent(i),this},enable:function(e){return this.enabled=e,this}};var r=null,o=!1,a=!1;n.event={bindDom:function(e,t,i){var r=t.split(" ");n.utils.each(r,function(t){e.addEventListener(t,i,!1)})},onTouch:function(e,t,i){var s=this;this.bindDom(e,n.EVENT_TYPES[t],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!a){c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which?o=!0:c.match(/mouse/)&&!l.which&&(o=!1),c.match(/touch|pointer/)&&(a=!0);var d=0;o&&(n.HAS_POINTEREVENTS&&t!=n.EVENT_END?d=n.PointerEvent.updatePointer(t,l):c.match(/touch/)?d=l.touches.length:a||(d=c.match(/up/)?0:1),d>0&&t==n.EVENT_END?t=n.EVENT_MOVE:d||(t=n.EVENT_END),(d||null===r)&&(r=l),i.call(n.detection,s.collectEventData(e,t,s.getTouchList(r,t),l)),n.HAS_POINTEREVENTS&&t==n.EVENT_END&&(d=n.PointerEvent.updatePointer(t,l))),d||(r=null,o=!1,a=!1,n.PointerEvent.reset())}})},determineEventTypes:function(){var e;e=n.HAS_POINTEREVENTS?n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=e[0],n.EVENT_TYPES[n.EVENT_MOVE]=e[1],n.EVENT_TYPES[n.EVENT_END]=e[2]},getTouchList:function(e){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():e.touches?e.touches:(e.identifier=1,[e])},collectEventData:function(e,t,i,r){var o=n.POINTER_TOUCH;return(r.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,r))&&(o=n.POINTER_MOUSE),{center:n.utils.getCenter(i),timeStamp:(new Date).getTime(),target:r.target,touches:i,eventType:t,pointerType:o,srcEvent:r,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return n.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var i=t.pointerType,r={};return r[n.POINTER_MOUSE]=i===t.MSPOINTER_TYPE_MOUSE||i===n.POINTER_MOUSE,r[n.POINTER_TOUCH]=i===t.MSPOINTER_TYPE_TOUCH||i===n.POINTER_TOUCH,r[n.POINTER_PEN]=i===t.MSPOINTER_TYPE_PEN||i===n.POINTER_PEN,r[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:n.utils.extend({},t),lastEvent:!1,name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst.options;return n.utils.each(this.gestures,function(i){return this.stopped||t[i.name]===!1||i.handler.call(i,e,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=e),e.eventType==n.EVENT_END&&!e.touches.length-1&&this.stopDetect(),e}},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(e){var t=this.current.startEvent;!t||e.touches.length==t.touches.length&&e.touches!==t.touches||(t.touches=[],n.utils.each(e.touches,function(e){t.touches.push(n.utils.extend({},e))}));var i,r,o=e.timeStamp-t.timeStamp,a=e.center.pageX-t.center.pageX,s=e.center.pageY-t.center.pageY,l=n.utils.getVelocity(o,a,s);return"end"===e.eventType?(i=this.current.lastEvent&&this.current.lastEvent.interimAngle,r=this.current.lastEvent&&this.current.lastEvent.interimDirection):(i=this.current.lastEvent&&n.utils.getAngle(this.current.lastEvent.center,e.center),r=this.current.lastEvent&&n.utils.getDirection(this.current.lastEvent.center,e.center)),n.utils.extend(e,{deltaTime:o,deltaX:a,deltaY:s,velocityX:l.x,velocityY:l.y,distance:n.utils.getDistance(t.center,e.center),angle:n.utils.getAngle(t.center,e.center),interimAngle:i,direction:n.utils.getDirection(t.center,e.center),interimDirection:r,scale:n.utils.getScale(t.touches,e.touches),rotation:n.utils.getRotation(t.touches,e.touches),startEvent:t}),e},register:function(e){var i=e.defaults||{};return i[e.name]===t&&(i[e.name]=!0),n.utils.extend(n.defaults,i,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(e,t){if(n.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void(this.triggered=!1);if(!(t.options.drag_max_touches>0&&e.touches.length>t.options.drag_max_touches))switch(e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(e.distance<t.options.drag_min_distance&&n.detection.current.name!=this.name)return;if(n.detection.current.name!=this.name&&(n.detection.current.name=this.name,t.options.correct_for_drag_min_distance&&e.distance>0)){var i=Math.abs(t.options.drag_min_distance/e.distance);n.detection.current.startEvent.center.pageX+=e.deltaX*i,n.detection.current.startEvent.center.pageY+=e.deltaY*i,e=n.detection.extendEventData(e)}(n.detection.current.lastEvent.drag_locked_to_axis||t.options.drag_lock_to_axis&&t.options.drag_lock_min_distance<=e.distance)&&(e.drag_locked_to_axis=!0);var r=n.detection.current.lastEvent.direction;e.drag_locked_to_axis&&r!==e.direction&&(n.utils.isVertical(r)?e.direction=e.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:e.direction=e.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),t.trigger(this.name+e.direction,e),(t.options.drag_block_vertical&&n.utils.isVertical(e.direction)||t.options.drag_block_horizontal&&!n.utils.isVertical(e.direction))&&e.preventDefault();break;case n.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(e,t){switch(e.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==n.detection.current.name&&t.trigger("hold",e)},t.options.hold_timeout);break;case n.EVENT_MOVE:e.distance>t.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==n.EVENT_END&&t.trigger(this.name,e)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(e,t){if(e.eventType==n.EVENT_END){if(t.options.swipe_max_touches>0&&e.touches.length<t.options.swipe_min_touches&&e.touches.length>t.options.swipe_max_touches)return;(e.velocityX>t.options.swipe_velocity||e.velocityY>t.options.swipe_velocity)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(e,t){if(e.eventType==n.EVENT_END&&"touchcancel"!=e.srcEvent.type){var i=n.detection.previous,r=!1;if(e.deltaTime>t.options.tap_max_touchtime||e.distance>t.options.tap_max_distance)return;i&&"tap"==i.name&&e.timeStamp-i.lastEvent.timeStamp<t.options.doubletap_interval&&e.distance<t.options.doubletap_distance&&(t.trigger("doubletap",e),r=!0),(!r||t.options.tap_always)&&(n.detection.current.name="tap",t.trigger(n.detection.current.name,e))}}},n.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(e,t){return t.options.prevent_mouseevents&&e.pointerType==n.POINTER_MOUSE?void e.stopDetect():(t.options.prevent_default&&e.preventDefault(),void(e.eventType==n.EVENT_START&&t.trigger(this.name,e)))}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(e,t){if(n.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void(this.triggered=!1);if(!(e.touches.length<2))switch(t.options.transform_always_block&&e.preventDefault(),e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-e.scale),r=Math.abs(e.rotation);if(i<t.options.transform_min_scale&&r<t.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),r>t.options.transform_min_rotation&&t.trigger("rotate",e),i>t.options.transform_min_scale&&(t.trigger("pinch",e),t.trigger("pinch"+(e.scale<1?"in":"out"),e));break;case n.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return n}):"object"==typeof module&&"object"==typeof module.exports?module.exports=n:e.Hammer=n}(this);var Vox=Vox||{};Vox.Explainers=_.extend({},Backbone.Events,{Views:{},initialize:function(){$("[data-explainer]").each(function(){Vox.Explainers.embed(this)})},embed:function(e){"undefined"!=typeof Chorus&&Chorus.Analytics&&Chorus.Analytics.disableScrollDepth(),new Vox.Explainers.Views.Embed({el:e}).render()}}),jQuery(function(){Vox.Explainers.initialize()}),Vox.Explainers.Model=Backbone.Model.extend({initialize:function(e,t){this.cards=new Backbone.Collection(e.cards),this.cards.url=this.get("url"),this.active_card=e.cards[e.active_index]},url:function(){return this.get("url")+".json"},parse:function(e){for(var t=e.cards.length;t--;)if(this.active_card&&e.cards[t].id==this.active_card.id){e.cards[t]=this.active_card;break}return this.cards.set(e.cards,{remove:!1}),delete e.cards,e}}),Vox.Explainers.Views.Card=Backbone.View.extend({tagName:"li",templateId:"explainers-card-template",className:"m-explainer__card",feedbackPromptSlc:".m-explainer__card__prompt",events:{scroll:"onScroll","click .m-feedback-prompt__button":"toggleFeedbackPrompt"},initialize:function(){this.listenTo(this.model,"change",this.render)},attributes:function(){return{"data-id":this.model.id}},onScroll:function(e){$(e.target).parent().trigger("scroll")},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e,t,i,n;return _.isNumber(this.options.index)&&(e=this.options.index+1,t=this.model.collection.at(this.options.index-1),i=this.model.collection.at(this.options.index+1)),n=_.extend({prevTitle:t&&t.get("title"),nextTitle:i&&i.get("title"),prevUrl:t&&t.get("url"),nextUrl:i&&i.get("url"),shareUrl:encodeURIComponent(this.model.get("share_url")+window.location.hash),position:e,fullUrl:this.model.get("url"),total:this.options.total},this.model.toJSON()),n.url&&(n.url=encodeURIComponent(n.url+window.location.hash)),this.$el.html(this.template(n)),this.$el.find(".m-explainer__card-content a[href^='http']").attr("target","_blank"),this.$el.find(".chorus-video-embed").each(function(){$(this).attr("id","cardstack-chorus-video-"+$(this).data("chorus-video-id"))}),Chorus.VideoContext.addVideo(n.chorus_videos||[]),this.model.get("isEmbedded")||this.renderFeedbackPrompt(),this},renderFeedbackPrompt:function(){var e=new Vox.Explainers.Views.FeedbackPrompt({model:this.model});e.render();e.$el.html().trim();return this.$el.find(this.feedbackPromptSlc).append(e.render().el),this},toggleFeedbackPrompt:function(e){Vox&&Vox.FeedbackPrompt&&Vox.FeedbackPrompt.toggleFeedbackPrompt(e)}}),Vox.Explainers.Views.Explore=Vox.Explainers.Views.Card.extend({searchUrl:"/cardstacks/search",cardStacksUrl:"/cards.json",isFetchingCardStacks:!1,isSearching:!1,isCurrentCard:!1,pagesFetched:0,templateId:"explainers-explore-template",className:"m-explainer__card m-explainer-explore",events:{"keydown input.m-explainer-explore__nav__input":"search","focus input.m-explainer-explore__nav__input":"onSearchInputFocus","blur input.m-explainer-explore__nav__input":"enableKeyboardNavigation","click .m-explainer-explore__no-results__submit button":"submitQuery"},resultsSlc:"#__results",searchInputSlc:"#__query",browseHeaderSlc:"#cards_browse_copy",noResultsSubmitSlc:".m-explainer-explore__no-results__submit",suggestedResultsLimit:6,infiniteScrollTimerInterval:250,infiniteScrollTimer:void 0,initialize:function(e){e=$.extend({},e),_.bindAll(this,"search","checkScroll"),this.model=e.model,this.initialCardStacks=e.initialCardStacks||[],this.suggestedCardStacks=new Backbone.Collection({model:Backbone.Model}),this.chorusImageId=e.chorusImageId,this.backgroundSlc=e.backgroundSlc,this.binderEffectHasTriggered=!1,this.exploreCardMode=e.exploreCardMode,this.parentView=e.parentView,this.listenTo(this.collection,"reset add",this.renderResults),this.initInfiniteScroll()},template:function(e){var t=$("#"+this.templateId).html();return _.template(t,e)},submitQuery:function(){return $(this.noResultsSubmitSlc).html("<p>Thanks for submitting a new card stack topic! We're constantly adding new card stacks and have added your term for review.</p>"),$(this.searchInputSlc).val("").focus(),!1},enableKeyboardNavigation:function(){this.parentView&&(this.parentView.events.keydown=this.parentView.events.keydown.replace("__disabled__",""),this.parentView.delegateEvents(this.parentView.events))},onSearchInputFocus:function(){return this.disableKeyboardNavigation(),0==Util.UserAgentProfiler.isIOS()&&this.binderEsqueEffect(),!1},binderEsqueEffect:function(){if(!this.binderEffectHasTriggered){this.binderEffectHasTriggered=!0;var e=$(this.searchInputSlc),t="search ".split("").reverse(),i=[];window.setTimeout(function(){var n=function(){var n=t.pop();"undefined"==typeof n?(window.clearInterval(r),window.setTimeout(function(){e.attr("placeholder","")},500)):(i+=n,e.attr("placeholder",i))},r=window.setInterval(n,150)},500)}},disableKeyboardNavigation:function(){if(this.parentView){var e=this.parentView.undelegateEvents().events;e.keydown=e.keydown+"__disabled__",this.parentView.delegateEvents(e)}},enableInfiniteScroll:function(){"undefined"==typeof this.infiniteScrollTimer&&(this.infiniteScrollTimer=window.setInterval(this.checkScroll,this.infiniteScrollTimerInterval),this.pagesFetched=0)},disableInfiniteScroll:function(){"undefined"!=typeof this.infiniteScrollTimer&&(window.clearInterval(this.infiniteScrollTimer),this.infiniteScrollTimer=void 0)},render:function(e){return this.$el.html(this.template({exploreCardMode:this.exploreCardMode})),this.applyBackgroundImage(),0==Util.UserAgentProfiler.isIOS()&&this.$el.find(this.searchInputSlc).focus(),0==this.initialCardStacks.length?this.fetchCardStacks({},function(e){this.initialCardStacks=e,this.collection.reset(this.initialCardStacks),this.populateSuggestedCardStacks(this.initialCardStacks)}.bind(this)):(this.collection.reset(this.initialCardStacks),this.populateSuggestedCardStacks(this.initialCardStacks)),e&&e(),Chorus.EventDispatcher&&Chorus.EventDispatcher.publish("explore:rendered",{},!0),this},fetchCardStacks:function(e,t){this.isFetchingCardStacks=!0,$.getJSON(this.cardStacksUrl,e,function(e){this.isFetchingCardStacks=!1,t&&t(e)}.bind(this))},populateSuggestedCardStacks:function(e){this.suggestedCardStacks.reset(e.slice(0,3))},renderResults:function(){var e=new Vox.Explainers.Views.ExploreResults({collection:this.collection,suggestedCardStacks:this.suggestedCardStacks});e.render();var t=e.$el.html().trim();return this.$el.find(this.resultsSlc).html(t),this},applyBackgroundImage:function(){if(this.chorusImageId&&this.backgroundSlc){var e=this.chorusImageId+":standard:1",t=$(this.backgroundSlc);t.attr("data-imgkey",e),t.addClass("vox-lazy-load"),Chorus.DynamicSizedImages.applyTo()}},search:_.debounce(function(){this.isSearching=!0;var e=$(this.searchInputSlc),t=e.val().trim(),i=2;t.length>=i?(this.model.trigger("explore:out_of_view"),$.get(this.searchUrl,{query:t},function(e){$(this.browseHeaderSlc).addClass("hide"),this.collection.reset(e),Chorus.Analytics.event("cardstack-explore","cardstack:search",encodeURIComponent(t),e.length)}.bind(this))):0==t.length&&($(this.browseHeaderSlc).removeClass("hide"),this.isSearching=!1,this.model.trigger("explore:in_view"))},300),initInfiniteScroll:function(){this.listenTo(this.model,"explore:in_view",function(){this.collection.reset(this.initialCardStacks),this.isCurrentCard=!0,this.enableInfiniteScroll()}.bind(this)),this.listenTo(this.model,"explore:out_of_view",function(){this.isCurrentCard=!1,this.disableInfiniteScroll()}.bind(this)),this.exploreCardMode||this.model.trigger("explore:in_view")},canUseInfiniteScroll:function(){var e=!this.isSearching&&!this.isFetchingCardStacks&&-1!=this.pagesFetched;return this.exploreCardMode&&(e=e&&this.isCurrentCard),e},checkScroll:function(){if(this.canUseInfiniteScroll()){var e=$(".m-explainer-explore .m-explainer__card-wrapper").outerHeight(!0),t=$(window).height(),i=this.$el.scrollTop(),n=300,r=e-t-i;if(n>=r){var o={page:this.pagesFetched+1};this.fetchCardStacks(o,function(e){e.length>0?(this.collection.add(e),this.pagesFetched++):(this.disableInfiniteScroll(),this.pagesFetched=-1)}.bind(this))}}}}),Vox.Explainers.Views.Share=Vox.Explainers.Views.Card.extend({templateId:"explainers-share-template",embedTextBoxSlc:'.m-explainer__embed-code[data-type="card"]',events:{"click .m-explainer__share-card .m-explainer__share-card--embed":"toggleShareEmbedTextBox"},initialize:function(e){e=$.extend({},e),this.model=e.model},render:function(){return data=_.extend({},this.model.toJSON()),this.$el.html(this.template(data)),this},toggleShareEmbedTextBox:function(e){e&&e.preventDefault(),e.stopPropagation();var t=$(this.embedTextBoxSlc);t.toggleClass("show"),t.hasClass("show")&&t.select()}}),Vox.Explainers.Views.Cover=Backbone.View.extend({className:"m-explainers-cover",templateId:"explainers-cover-template",initialize:function(e){this.model=e.model,this.cards=e.cards},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e={title:this.model.get("title"),body:this.model.get("body"),users:this.model.get("users"),cards:this.cards.map(function(e){return{title:e.get("title"),url:e.get("url"),status:e.get("status"),type:e.get("type")}})};return this.$el.html(this.template(e)),this}}),Vox.Explainers.Views.ExploreResults=Backbone.View.extend({templateId:"explainers-explore-results-template",cardStackSlc:".m-explainer-explore__explainer",initialize:function(e){this.suggestedCardStacks=e.suggestedCardStacks},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e={cardStacks:this.collection,suggestedCardStacks:this.suggestedCardStacks},t=this.template(e);return this.$el.html(t),this}}),Vox.Explainers.Views.EmbedCode=Backbone.View.extend({templateId:"explainers-embed-code-template",initialize:function(e){this.url=e.url,this.title=e.title},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e={url:this.url,title:this.title};return this.$el.html(this.template(e)),this}}),Vox.Explainers.Views.FeedbackPrompt=Backbone.View.extend({templateId:"explainers-feedback-prompt-template",initialize:function(){},template:function(e){return _.template($("#"+this.templateId).html(),e)},render:function(){var e=this.model.attributes,t=this.model.get("url")+"?utm_campaign=vox&utm_content=feedback-prompt&utm_medium=social";return e.shareUrl=encodeURIComponent(t),e.shareText=encodeURIComponent(e.social_headline),this.$el.html(this.template(e)),this}}),Vox.Explainers.Views.Fullscreen=Backbone.View.extend({className:"m-explainer",id:"explainer",templateId:"explainers-fullscreen-template",cardSlc:".m-explainer__card",cardsContainerSlc:".m-explainer__cards",pagerSlc:".m-explainer__pager__card-count",tocItemSlc:".m-explainer__toc",footerCounterSlc:".m-explainer__pager__card-count-number",shareOverlaySlc:".m-explainer__share-card.fullscreen",embedModalSlc:".m-explainer__embed--modal",embedTextBoxSlc:'.m-explainer__embed-code[data-type="overlay"]',embedHost:void 0,largeBreakpoint:880,cover:void 0,events:{"click .m-explainer__close":"onCloseClick","click .m-explainer__pager-control.next":"onNextClick","click .m-explainer__pager-control.previous":"onPrevClick","click .m-explainer__card__pager-control.next":"onNextClick","click .m-explainer__card__pager-control.previous":"onPrevClick","click .m-explainer__pager-control":"onPagerClick","pointerdown .m-explainer__toc a":"onTocClick","click .m-explainer__toc a":"onTocClick","pointerdown .m-explainer-cover__toc a":"onTocClick","click .m-explainer-cover__toc a":"onTocClick","click .m-explainer__card-content a":"onContentClick","click #mobile-rail-toggle":"onMobileCoverClick","pointerdown .m-explainer__title--link":"onTitleClick","click .m-explainer__title--link":"onTitleClick","click .m-explainer-cover__start":"gotoFirstCard",keydown:"keyboardNavigation","click .m-explainer__lower-nav__icons-share":"toggleShareOverlay","click .m-explainer__top-nav":"closeShareOverlay",'click .m-explainer__embed--button[data-type="modal"]':"toggleEmbedModal","click .m-explainer__cards":"closeEmbedModal","click .m-explainer__share-card.fullscreen .m-explainer__embed--button":"toggleEmbedTextBox"},animationEndEvent:{WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[Chorus.Modernizr.prefixed("animation")],animationSupport:Chorus.Modernizr.cssanimations,historySupport:Chorus.Modernizr.history,isAnimating:!1,isPreview:!1,isExplore:!1,railOpen:!1,adClass:"ad",adRequestEvent:"Hymnal.requestAd",adResponseEvent:"Vox.Ad.ResponseWithHTML",exploreCardUrl:"/cards",initialize:function(e){_.bindAll(this,"onPopstate","handleSwipes","configToc","onEndAnimation"),this.cardModels=this.model.cards,this.cardViews=[],this.opener=e.opener,this.pageTitle=document.title,this.currentIndex=this.model.get("active_index"),this.hammertime=new Hammer(this.el,{drag_lock_to_axis:!0,prevent_mouseevents:!0,stop_browser_behavior:{userSelect:"text"}}),this.hammertime.on("release dragleft dragright swipeleft swiperight",this.handleSwipes),this.isPreview=e.preview?!0:!1,this.updateBrowserUrlState=this.historySupport&&!this.isPreview,this.cardstackVideos={},this.prefetchCards(),this.addShareCard(),this.addExploreCard(),this.initEmbed()},addExploreCard:function(){this.cardModels.add({id:(new Date).getTime()+Math.floor(1e4*Math.random()),title:"Explore",type:"Explore",url:this.exploreCardUrl})},addShareCard:function(){var e=this.model.get("url"),t=this.model.get("social_headline");this.cardModels.add({id:(new Date).getTime()+Math.floor(1e6*Math.random()),title:"Share this card stack!",type:"Share",embedCode:this.embedCode(),shareUrl:encodeURIComponent(e),shareText:t,url:e+"#share"})},addCard:function(e,t,i){i=$.extend({},i);var n=new Backbone.Model({id:(new Date).getTime(),body:e,type:"Ad"}),r=new Vox.Explainers.Views.Card({model:n,header:null});this.cardModels.add(n,{at:t}),this.cardViews.splice(t,0,r),r.render(),i.isAd&&(r.$el.addClass(this.adClass),i.$tocItem=$('<li class="ad">Advertisement</li>')),r.$el.insertBefore(this.$(this.cardSlc).eq(t)),this.addTocItem(i.$tocItem,t)},removeCard:function(e){var t=this.$(this.cardSlc).index(e),i=this.cardModels.at(t),n=this.cardViews[t];this.currentIndex>=t&&(this.currentIndex-=1),n.remove(),this.cardModels.remove(i),this.removeTocItem(t)},addTocItem:function(e,t){var i=this.$(this.tocItemSlc);$currentTocItem=i.children("li").eq(t),e.insertBefore($currentTocItem)},removeTocItem:function(e){var t=this.$(this.tocItemSlc),i=t.children("li").eq(e);i.remove()},cardCount:function(){return this.cardModels.length},template:function(e){return _.template($("#"+this.templateId).html(),e)},addCover:function(){var e=new Vox.Explainers.Views.Cover({model:this.model,cards:this.cardModels});return e.render(),this.cover=$("#"+this.id),this.cover.append(e.el),e},onTitleClick:function(e){e.preventDefault(),$(window).width()>this.largeBreakpoint?this.showCover():this.gotoFirstCard()},renderCover:function(e){if($(window).width()>this.largeBreakpoint){if(this.showCover(),e){var t=this.model.get("title"),i=this.model.get("url"),n={explainerId:this.model.id,index:-1};this.replaceState(n,t,i)}}else this.showMobileCover()},showCover:function(){var e=$(".m-explainer__cards");e.addClass("hide"),this.cover.addClass("explainer-cover-body")},hideCover:function(){var e=$(".m-explainer__cards");e.removeClass("hide"),this.cover.removeClass("explainer-cover-body")},hideCovers:function(){this.hideCover(),this.hideMobileCover()},render:function(e){var t=this.$el;return t.html(this.template({title:this.model.get("title"),socialHeadline:this.model.get("social_headline"),url:encodeURIComponent(this.model.get("url")+window.location.hash),stackUrl:this.model.get("url")+window.location.hash,exitUrl:this.exitUrl(),chorusImageId:this.model.get("chorus_image_id"),photoCredit:this.model.get("photo_credit"),photoCreditUrl:this.model.get("photo_credit_url"),users:this.model.get("users"),updatedAt:this.model.get("updated_on"),currentCard:this.currentIndex+1,embedCode:this.embedCode(),cards:this.cardModels.map(function(e){return{title:e.get("title"),url:e.get("url"),status:e.get("status"),type:e.get("type")}})})),this.cardViews=this.cardModels.map(function(e,t,i){var n={model:e,index:t,total:i.length};if("Explore"===e.get("type")){n=$.extend({collection:new Backbone.Collection({model:Backbone.Model}),parentView:this,exploreCardMode:!0},n);var r=new Vox.Explainers.Views.Explore(n)}else if("Share"===e.get("type"))var r=new Vox.Explainers.Views.Share(n);else{e.set("embedCode",this.embedCode(e)),e.set("isEmbedded",this.isRenderedInsideIframe());var r=new Vox.Explainers.Views.Card(n)}return r.render(),this.$(this.cardsContainerSlc).append(r.el),r},this),this.addCover(),-1===this.currentIndex?this.renderCover(e):this.gotoIndex(this.currentIndex,{doPushState:e,skipAnimation:!0}),$("body, html").scrollTop(0),$("body").addClass("explainer-opening"),_.delay(_.bind(function(){$("body").addClass("explainer-open").removeClass("explainer-opening"),this.updateTocCurrentItem(),Chorus.DynamicSizedImages.applyTo()},this),500),t.appendTo("body"),setTimeout(function(){t.addClass("loaded")},0),this.isRenderedInsideIframe()||t.attr("tabIndex",-1).focus(),this.applyBackgroundImage(t),Chorus.Video.init({namespace:"CARDSTACK",returnActivePlayer:!1}),this.cardsSeen=0,this.configToc(),$(window).on("resize.explainer",_.bind(_.debounce(this.resizer,300),this)).on("popstate.explainer",this.onPopstate),this},embedCode:function(e){var t=e?e.get("url"):this.model.get("url"),i=e?e.get("title"):this.model.get("title"),n=new Vox.Explainers.Views.EmbedCode({url:t,title:i});n.render();var r=n.el.innerHTML;return r},postMessageToHost:function(e){e.sender="Vox",parent.postMessage(e,"*")},listenForMessages:function(){var e=this,t=window.addEventListener?"addEventListener":"attachEvent",i=window[t],n="attachEvent"==t?"onmessage":"message";i(n,function(t){t.data&&"Vox"==t.data.sender&&(e.embedHost=t.data.url)})},isRenderedInsideIframe:function(){try{return window.self!==window.top}catch(e){return!0}},initEmbed:function(){if(this.isRenderedInsideIframe()){this.listenForMessages();var e=this.cardModels.at(this.currentIndex)||this.model;this.postMessageToHost({backgroundUrl:this.model.get("embed_background_url"),url:e.get("url")}),$("body").addClass("vox-cardstack-iframe"),this.applyEmbedHacks()}},applyEmbedHacks:function(){$.browser&&$.browser.safari&&(this.events["mousedown "+this.tocItemSlc]="disableTocOverflow",this.events["mouseup "+this.tocItemSlc]="enableTocOverflow",this.delegateEvents())},disableTocOverflow:function(){$(this.tocItemSlc).css({"overflow-y":"hidden",overflow:"hidden"})},enableTocOverflow:function(){$(this.tocItemSlc).css({"overflow-y":"auto",overflow:"auto"})},applyBackgroundImage:function(e){var t=this.model.get("chorus_image_id")+":standard:1";e.attr("data-imgkey",t),e.addClass("vox-lazy-load"),Chorus.DynamicSizedImages.applyTo()},resizer:function(){this.railOpen&&$(window).width()>this.largeBreakpoint&&this.toggleMobileCover(),$(window).width()>this.largeBreakpoint&&this.closeShareOverlay()},configToc:function(){var e=$("#explainer-rail-list"),t=$("#explainer-rail-header"),i=$(".m-explainer__toc-scroller"),n=$(window),r=n.height()-(100+t.outerHeight()+2*i.outerHeight());r=240>r?r:240,!this.isRenderedInsideIframe()&&n.width()>this.largeBreakpoint?$("#explainer-rail-list").outerHeight(r):$("#explainer-rail-list").removeAttr("style"),i.on("click",function(t){var i=$(this).hasClass("down")?+r:-r;e.animate({scrollTop:e.scrollTop()+i-100},200),t.preventDefault()})},setContainerOffset:function(e,t){$(e).css("transform","translate("+t+"%,0)")},handleSwipes:function(e){var t=this.$(this.cardSlc).eq(this.currentIndex),i=.25,n=0,r=$(window).width();
if(this.railOpen)return!1;switch(e.type){case"dragright":case"dragleft":n=100/r*e.gesture.deltaX/2,this.setContainerOffset(t,n);break;case"swipeleft":this.gotoNext("swipe"),e.gesture.stopDetect();break;case"swiperight":this.gotoPrev("swipe"),e.gesture.stopDetect();break;case"release":Math.abs(e.gesture.deltaX)>r*i?"right"===e.gesture.direction?this.gotoPrev("swipe"):this.gotoNext("swipe"):this.setContainerOffset(t,0)}},updateFooterCounter:function(){var e=0,t=0;this.cardModels.each(function(i){"Ad"!==i.get("type")&&(e++,this.currentCard===i&&(t=e))},this),this.$(this.footerCounterSlc).text(t)},updateTocCurrentItem:function(){if(!(this.currentIndex<0)){var e=this.$(this.tocItemSlc),t=e.children("li").eq(this.currentIndex),i=t.prev();this.clearTocCurrentItem(),t.addClass("current");var n=e.scrollTop();i.length>0&&(n+=i.position().top),e.animate({scrollTop:n},350)}},clearTocCurrentItem:function(){var e=this.$(this.tocItemSlc);e.children("li").removeClass("current")},onMobileCoverClick:function(e){e.preventDefault(),this.hideCover(),this.toggleMobileCover(),!this.railOpen&&this.currentIndex<0&&this.gotoFirstCard()},toggleMobileCover:function(){this.railOpen?this.hideMobileCover():this.showMobileCover()},showMobileCover:function(){if(!this.railOpen&&$(window).width()<this.largeBreakpoint){var e=$("#explainer-rail"),t=$("#mobile-rail-toggle"),i=$(".m-explainer__cards");t.addClass("open"),e.addClass("open"),i.addClass("hide"),this.railOpen=!0}},hideMobileCover:function(){if(this.railOpen&&$(window).width()<this.largeBreakpoint){var e=$("#explainer-rail"),t=$("#mobile-rail-toggle"),i=$(".m-explainer__cards");t.removeClass("open"),e.removeClass("open"),i.removeClass("hide"),this.railOpen=!1}},onPagerClick:function(e){e.preventDefault(),this.hideMobileCover()},toggleShareOverlay:function(e){e&&e.preventDefault(),e.stopPropagation(),$(this.shareOverlaySlc).toggleClass("open"),this.closeAllEmbeds()},closeShareOverlay:function(e){$(this.shareOverlaySlc).removeClass("open")},toggleOverlayEmbed:function(e){$(this.embedOverlayModalSlc).toggleClass("show")},toggleEmbedModal:function(e){e&&e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).closest(".m-explainer__embed--button"),i=$(this.embedModalSlc),n=!t.next(i).hasClass("show");if(this.closeEmbedModal(),n){var r=t.next(i);r.addClass("show"),r.find(".m-explainer__embed-textarea").select()}$(this.embedModalSlc).on("click",function(e){e.stopPropagation()})},closeEmbedModal:function(e){$(this.embedModalSlc).removeClass("show")},toggleEmbedTextBox:function(e){e&&e.preventDefault(),e.stopPropagation();var t=$(this.embedTextBoxSlc);t.toggleClass("show"),t.hasClass("show")&&t.select()},closeEmbedTextBox:function(e){$(this.embedTextBoxSlc).removeClass("show")},closeAllEmbeds:function(){this.closeEmbedModal(),this.closeEmbedTextBox()},onNextClick:function(e){var t=this.whichPager(e);this.gotoNext("click:"+t),e.preventDefault(),e.stopPropagation()},onPrevClick:function(e){var t=this.whichPager(e);this.gotoPrev("click:"+t),e.preventDefault(),e.stopPropagation()},whichPager:function(e){var t,i=$(e.currentTarget).closest(".m-explainer__pager");return t=i.hasClass("lower")?"lower":i.hasClass("upper")?"upper":"nav"},onCloseClick:function(e){this.trackNavEvent("close:click"),this.close(!0),e.preventDefault(),e.stopPropagation()},onContentClick:function(e){var t=this.cardModels.findWhere({url:$(e.currentTarget).attr("href")});t&&(this.gotoIndex(this.cardModels.indexOf(t),{doPushState:!0,skipAdCheck:!0}),e.preventDefault(),e.stopPropagation())},exitUrl:function(){return this.opener?"/e/"+Chorus.Context.entry_id:window.location.hash.match(/^#E[0-9]+$/)?"/e/"+window.location.hash.substring(2):0===document.referrer.indexOf("http://"+window.location.host)&&document.referrer!==document.URL?document.referrer:"/"},close:function(e){this.opener?(_.invoke(this.cardViews,"stopListening"),this.cardViews=[],this.hammertime.off("release dragleft dragright swipeleft swiperight"),this.remove(),$(window).off("resize.explainer"),$(window).off("popstate.explainer"),$("body").addClass("explainer-closing"),setTimeout(function(){$("body").removeClass("explainer-closing explainer-open")},500),this.opener.closeFullscreen(e)):window.location.href=this.exitUrl()},gotoFirstCard:function(){var e=0;this.gotoIndex(e,{doPushState:!0,navAction:"next:cover"})},gotoNext:function(e){var t=this.currentIndex===this.cardCount()-1?this.currentIndex:this.currentIndex+1;this.gotoIndex(t,{doPushState:!0,navAction:"next:"+e})},gotoPrev:function(e){var t=0===this.currentIndex?this.currentIndex:this.currentIndex-1;this.gotoIndex(t,{doPushState:!0,navAction:"prev:"+e})},onTocClick:function(e){var t=$(e.currentTarget).data("index");this.$el.focus(),this.railOpen&&this.toggleMobileCover(),this.gotoIndex(t,{doPushState:!0,skipAdCheck:!0,navAction:"toc"}),e.preventDefault(),e.stopPropagation()},prefetchCards:function(){this.isPreview||this.model.loaded||this.model.loading||(this.model.loading=!0,this.model.fetch({success:function(e){e.loaded=!0,e.loading=!1},error:function(e){e.loaded=!1,e.loading=!1}}))},detachVideos:function(e){var t=jQuery('.m-explainer__card.current iframe[src*="youtube.com"]'),i={};t.length&&jQuery.each(t,function(e){jQuery(this).parent().addClass("extracted-video-"+e),i[e]=jQuery(this).detach()}),this.cardstackVideos[e]=i},attachVideos:function(e){var t=jQuery('.m-explainer__card[data-id="'+e+'"] [class^="extracted-video-"]:empty'),i=this.cardstackVideos;t.length&&jQuery.each(t,function(t){jQuery(this).append(i[e][t])})},gotoIndex:function(e,t){t=t||{};var i,n,r=!this.isRenderedInsideIframe()&&(t.doPushState||!1),o=t.skipAnimation||!1,a=t.skipAdCheck||!1,s=t.navAction||null,l=e<this.currentIndex?"left":"right",c=this.$(this.cardSlc).eq(this.currentIndex),d=e===this.currentIndex,h=!1,u=!1;if(!this.isAnimating){if(a||d||("left"===l?this.checkForAdContent(e+1)&&(h=!0,e+=1):h=this.checkForAdContent(e)),c.css("overflow-y",""),this.detachVideos(this.cardModels.get(c.data("id")).id),i=this.$(this.cardSlc).eq(e),this.currentCard=n=this.cardModels.get(i.data("id")),o||!this.animationSupport)this.delayedOnEndAnimation(i,c),this.cardsSeen+=1,u=!0;else if(d)this.doBounceAnimation(e,c);else{if(!i.length)return;this.doCardAnimation(i,c,l),this.cardsSeen+=1,u=!0}if(this.hideCovers(),n&&"Explore"==n.get("type"))d?this.doBounceAnimation(e,c):(this.isExplore=!0,this.doExploreAnimationToggle({mode:"show"}),n.trigger("explore:in_view"));else if(this.isExplore&&"left"==l){this.isExplore=!1,this.doExploreAnimationToggle({mode:"hide"});var p=this.$el.find("#__query");p.val(""),oldModel=this.cardModels.get(c.data("id")),oldModel.trigger("explore:out_of_view")}if(this.currentIndex=e,h)this.clearTocCurrentItem();else if(n){if(this.updateTocCurrentItem(),this.updateFooterCounter(),this.attachVideos(this.cardModels.get(i.data("id")).id),this.updateBrowserUrlState){var m={explainerId:this.model.id,index:e},f=n.get("title")+" - "+this.model.get("title")+" - Vox",g=n.get("url");""!==window.location.hash&&/^#E/i.test(window.location.hash)?g+=window.location.hash:this.opener&&(g+="#E"+Chorus.Context.entry_id),r?this.pushState(m,f,g):this.replaceState(m,f,g),document.title=f}Chorus.DynamicSizedImages.applyTo(i),this.closeAllEmbeds(),this.closeShareOverlay()}if(u){if(this.cardsSeen>0){var v=window.location.pathname;""!==window.location.hash&&(v+=window.location.hash),v="/virtual"+v}s&&this.trackNavEvent(s,f),v&&this.trackPageview(v,f)}}},getCardPagination:function(){var e=this.cardModels.at(this.currentIndex),t=e.get("type"),i={Ad:1,Explore:1,Share:1,Title:1};if(i[t])return t;var n=0,r=0;return this.cardModels.each(function(e){i[e.get("type")]||(n++,this.currentCard===e&&(r=n))},this),r+" of "+n},trackPageview:function(e,t){this.isPreview||(!this._vpv&&this.embedHost&&(Chorus.Analytics.push({event:"embedPageView"}),this._vpv=!0),Chorus.Analytics.pageview({virtualPagePath:e,virtualPageTitle:t||this.model.get("title"),"Content ID":this.model.id,"Embed Host":this.embedHost,"Pagination Tracking":this.getCardPagination()}))},trackNavEvent:function(e,t){if(!this.isPreview){var i="navigation",e="cardstack:"+e,n=t||this.model.get("title");Chorus.Analytics.event(i,e,n,{"Content ID":this.model.id,"Embed Host":this.embedHost,"Pagination Tracking":this.getCardPagination()})}},doExploreAnimationToggle:function(e){if(e=$.extend({},e),"show"==e.mode){var t=this.$(this.cardSlc).eq(this.currentIndex);t.find(".m-explainer__card-wrapper").addClass("m-explainer-explore__card"),$("#"+this.id).addClass("explainer-explore-body")}"hide"==e.mode&&$("#"+this.id).removeClass("explainer-explore-body");var i=this.$el.find("#__query");0==Util.UserAgentProfiler.isIOS()&&i.focus()},doCardAnimation:function(e,t,i){var n,r,o,a,s=this.animationEndEvent,l=this.onEndAnimation;e.removeAttr("style").addClass("current"),"right"===i?(o="to-left",a="from-right"):(o="to-right",a="from-left"),this.isAnimating=!0,t.addClass(o).on(s,function(){t.removeClass("current"),t.off(s),n=!0,r&&l(e,t)}),e.addClass(a).on(s,function(){e.off(s),r=!0,n&&l(e,t)})},doBounceAnimation:function(e,t){var i=this.animationEndEvent,n=this.onEndAnimation;t.removeAttr("style").addClass("current"),0!==e?bounceClass="bounce-left":bounceClass="bounce-right",this.isAnimating=!0,t.addClass(bounceClass).on(i,function(){t.off(i),n(t)})},onEndAnimation:function(e,t){e.removeClass("to-left to-right from-left from-right bounce-right bounce-left"),e.addClass("current"),setTimeout(function(){e.css("overflow-y","auto")},1),t&&(t.hasClass(this.adClass)?this.removeCard(t):(t.is(e)||t.removeClass("current"),t.removeAttr("style").removeClass("to-left to-right from-left from-right bounce-right bounce-left"),t.scrollTop(0))),this.isAnimating=!1},delayedOnEndAnimation:function(e,t){var i=this;setTimeout(function(){i.onEndAnimation(e,t)},1)},onPopstate:function(e){var t=e.originalEvent.state;t?t.explainerId===this.model.id?this.gotoIndex(t.index,{navAction:"history"}):this.renderCover():this.opener&&this.close(!1)},keyboardNavigation:function(e){var t=this.$(this.cardSlc).eq(this.currentIndex),i=e.keyCode||e.which,n={left:37,right:39,up:38,down:40,escape:27,pageUp:33,pageDown:34,home:36};switch(i){case n.left:this.gotoPrev("key"),e.preventDefault();break;case n.right:this.gotoNext("key"),e.preventDefault();break;case n.down:t.scrollTop(t.scrollTop()+25),e.preventDefault();break;case n.up:t.scrollTop(t.scrollTop()-25),e.preventDefault();break;case n.pageUp:t.scrollTop(t.scrollTop()-400),e.preventDefault();break;case n.pageDown:t.scrollTop(t.scrollTop()+400),e.preventDefault();break;case n.home:t.scrollTop(0),e.preventDefault();break;case n.escape:if(this.isRenderedInsideIframe())break;this.close(!0),e.preventDefault(),this.trackNavEvent("close:key")}},checkForAdContent:function(e){var t=!1,i=_.bind(function(i,n){this.addCard(n,e,{isAd:!0}),t=!0},this),n=$(document).on(this.adResponseEvent,i);return n.triggerHandler(this.adRequestEvent,{pagesSeen:this.cardsSeen,currentPage:this.currentIndex,nextPage:e,totalPages:this.cardCount()}),n.off(this.adResponseEvent,i),t},pushState:function(e,t,i){window.history.pushState(e,t,i)},replaceState:function(e,t,i){window.history.replaceState(e,t,i)}}),function(){"use strict";/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */
function e(t,n){function r(e,t){return function(){return e.apply(t,arguments)}}var o;if(n=n||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=n.touchBoundary||10,this.layer=t,this.tapDelay=n.tapDelay||200,this.tapTimeout=n.tapTimeout||700,!e.notNeeded(t)){for(var a=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,l=0,c=a.length;c>l;l++)s[a[l]]=r(s[a[l]],s);i&&(t.addEventListener("mouseover",this.onMouse,!0),t.addEventListener("mousedown",this.onMouse,!0),t.addEventListener("mouseup",this.onMouse,!0)),t.addEventListener("click",this.onClick,!0),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,i,n){var r=Node.prototype.removeEventListener;"click"===e?r.call(t,e,i.hijacked||i,n):r.call(t,e,i,n)},t.addEventListener=function(e,i,n){var r=Node.prototype.addEventListener;"click"===e?r.call(t,e,i.hijacked||(i.hijacked=function(e){e.propagationStopped||i(e)}),n):r.call(t,e,i,n)}),"function"==typeof t.onclick&&(o=t.onclick,t.addEventListener("click",function(e){o(e)},!1),t.onclick=null)}}var t=navigator.userAgent.indexOf("Windows Phone")>=0,i=navigator.userAgent.indexOf("Android")>0&&!t,n=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t,r=n&&/OS 4_\d(_\d)?/.test(navigator.userAgent),o=n&&/OS [6-7]_\d/.test(navigator.userAgent),a=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(n&&"file"===e.type||e.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!i;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var i,n;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),n=t.changedTouches[0],i=document.createEvent("MouseEvents"),i.initMouseEvent(this.determineEventType(e),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),i.forwardedTouchEvent=!0,e.dispatchEvent(i)},e.prototype.determineEventType=function(e){return i&&"select"===e.tagName.toLowerCase()?"mousedown":"click"},e.prototype.focus=function(e){var t;n&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type&&"month"!==e.type?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,i;if(t=e.fastClickScrollParent,!t||!t.contains(e)){i=e;do{if(i.scrollHeight>i.offsetHeight){t=i,e.fastClickScrollParent=i;break}i=i.parentElement}while(i)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,i,o;if(e.targetTouches.length>1)return!0;if(t=this.getTargetElementFromEventTarget(e.target),i=e.targetTouches[0],n){if(o=window.getSelection(),o.rangeCount&&!o.isCollapsed)return!0;if(!r){if(i.identifier&&i.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=i.pageX,this.touchStartY=i.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],i=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>i||Math.abs(t.pageY-this.touchStartY)>i?!0:!1},e.prototype.onTouchMove=function(e){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},e.prototype.findControl=function(e){return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var t,a,s,l,c,d=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(e.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,o&&(c=e.changedTouches[0],d=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||d,d.fastClickScrollParent=this.targetElement.fastClickScrollParent),s=d.tagName.toLowerCase(),"label"===s){if(t=this.findControl(d)){if(this.focus(d),i)return!1;d=t}}else if(this.needsFocus(d))return e.timeStamp-a>100||n&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(d),this.sendClick(d,e),n&&"select"===s||(this.targetElement=null,e.preventDefault()),!1);return n&&!r&&(l=d.fastClickScrollParent,l&&l.fastClickLastScrollTop!==l.scrollTop)?!0:(this.needsClick(d)||(e.preventDefault(),this.sendClick(d,e)),!1)},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===e.target.type&&0===e.detail?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;i&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var t,n,r,o;if("undefined"==typeof window.ontouchstart)return!0;if(n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!i)return!0;if(t=document.querySelector("meta[name=viewport]")){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(n>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(a&&(r=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),r[1]>=10&&r[2]>=3&&(t=document.querySelector("meta[name=viewport]")))){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===e.style.msTouchAction||"manipulation"===e.style.touchAction?!0:(o=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],o>=27&&(t=document.querySelector("meta[name=viewport]"),t&&(-1!==t.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===e.style.touchAction||"manipulation"===e.style.touchAction?!0:!1)},e.attach=function(t,i){return new e(t,i)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1);