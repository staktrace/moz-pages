var initDropDowns=(function(){var toggle=function(e){if(this==document)if(!activeDropdown||activeDropdown.contains(e.target))return;if(activeDropdown){if(activeDropdown.contains(this)){closeAll(this);if(hasClass(this,'dropdown')){removeClass(this,'dropdown')}else{addClass(this,'dropdown');performCallbacks(this)};e.stopPropagation();return};closeAll();if(this==activeDropdown||this==document){activeDropdown=null;return}};activeDropdown=this;addClass(this,'dropdown');performCallbacks(this)},closeAll=function(exclude){[exclude||activeDropdown].concat(Selector('.dropdown',activeDropdown)).forEach(function(el){if(el&&el!=exclude)removeClass(el,'dropdown')})},callBacks=[function(dropdownElement){if(!hasClass(dropdownElement.parentNode,'profileNavigation'))return;var menuBar=getById('menubar'),menuLeft,availWidth=120;if(menuBar){menuLeft=getOffsetLeft(dropdownElement)-getOffsetLeft(menuBar)+dropdownElement.offsetWidth;availWidth=menuBar.offsetWidth-menuLeft};if(availWidth<120){addClass(dropdownElement,'left')}else removeClass(dropdownElement,'left')},function(dropdownElement){if(!hasClass(dropdownElement,'product'))return;var list=Selector('ul',dropdownElement)[0];if(list)list.style.left=(parseInt(dropdownElement.offsetWidth)-130)+'px'}],performCallbacks=function(dropdownElement){var i=callBacks.length;while(i--)callBacks[i](dropdownElement)},activeDropdown=null;return function(selector,root){var dropdowns=Selector(selector,root);if(dropdowns.length){dropdowns.forEach(function(el){addEvent(el,'click',toggle)});addEvent(document,'click',toggle)};return dropdowns}}())
function RefreshTimer(){if(RefreshTimer.instance)return RefreshTimer.instance;if(!(this instanceof RefreshTimer))return RefreshTimer.instance=new RefreshTimer();this.timer=null;this.counter=0;this.lastActivity=0;this.refreshes={};this.inactiveTrigger=600;this.paused=false;this.suspended=false};Object.extend(RefreshTimer.prototype,{add:function(label,callback,interval){this.refreshes[label]={callback:callback,interval:interval,execute:this.counter+interval};if(this.timer==null){addEvent(window,'mousemove',this.stayActive.bind(this));addEvent(window,'focus',this.stayActive.bind(this));this.start()};return this.refreshes[label]},remove:function(label){if(this.has(label))delete this.refreshes[label]},has:function(label){return(label in this.refreshes)},stayActive:function(){this.lastActivity=this.counter;if(this.suspended&&!this.paused)this.resume()},start:function(){this.timer=setTimeout(this.execute.bind(this),1e3)},suspend:function(){this.suspended=true},pause:function(label){if(label){if(label in this.refreshes)this.refreshes[label].paused=true}else this.paused=true},resume:function(label){if(label){if(label in this.refreshes)this.refreshes[label].paused=false}else{this.clearTimer();this.suspended=false;this.paused=false;this.start()}},execute:function(){var refreshId,refresh;this.counter++;if(!this.paused&&!this.suspended)if(this.counter-this.lastActivity>this.inactiveTrigger){this.counter--;this.suspend()}else{if('global'in this.refreshes&&this.refreshes.global.execute<=this.counter){this.refreshes.global.callback();return};for(refreshId in this.refreshes){refresh=this.refreshes[refreshId];if(refresh.execute<=this.counter&&!refresh.paused){refresh.execute=this.counter+refresh.interval;refresh.callback(this.counter)}}};this.start()},clearTimer:function(){clearTimeout(this.timer);this.timer=null},getCounter:function(){return this.counter}})
function Poll(id){this.pollId=id;this.init()};Object.extend(Poll.prototype,{init:function(){this.pollForm=getById('poll'+this.pollId);if(!this.pollForm)return;var labels=this.pollForm.getElementsByTagName('label'),label,option,i=0;while((label=labels[i++]))if(label.htmlFor&&(option=getById(label.htmlFor))){if(!option.disabled)addEvent(option,'click',this.optionSelect.bind(this));if(option.checked)addClass(label,'selected')}},optionSelect:function(e){var result=Ajax.sendRequest(getXmlHttpUrl('frontpage','poll','vote','PollID='+this.pollId),{method:'POST',appendSid:true},getQueryString(this.pollForm));if(result){this.showVotes(result)}else this.pollForm.submit();if(e)e.preventDefault();return false},getVotes:function(){var result=Ajax.sendRequest(getXmlHttpUrl('frontpage','poll','show','PollID='+this.pollId),{nocache:true});if(result)this.showVotes(result)},showVotes:function(result){var pollContainer=this.pollForm.parentNode,statsNode=this.pollForm.nextSibling;while(statsNode){if(statsNode.nodeName=='P'){statsNode.parentNode.removeChild(statsNode);break};statsNode=statsNode.nextSibling};pollContainer.removeChild(this.pollForm);var fragment=document.createElement('div'),child;fragment.innerHTML=result;while((child=fragment.firstChild))pollContainer.appendChild(child);this.init()}});if(window.PopupGenerator){PopupGenerator.register('moreItems',{offsetLeft:-13,offsetTop:-1,handlers:{click:1},arrow:'top',getContent:function(popup){var summary=Selector('div.moreItems',popup.offsetElement.parentNode)[0];if(summary)return summary.innerHTML;return false},setPosition:function(popup){popup.setAutoPosition(popup.offsetElement.parentNode);popup.arrow.style.left=(popup.offsetElement.offsetLeft+popup.offsetElement.offsetWidth/2)+'px'}});PopupGenerator.register('userNotificationsPopup',{className:'menuHeaderPopup scrollableList',offsetLeft:-336,offsetTop:37,handlers:{click:1},useParent:true,forceUpdate:true,getContent:function(popup){if(popup.visible)return false;RefreshTimer().pause('notificationRefresh');return this.sendRequest(popup)},sendRequest:function(popup){Ajax.sendRequest(getXmlHttpUrl('frontpage','notifications','get_popup'),{method:'POST',type:'json',async:true,appendSid:true,handler:this.handleResponse.bind(this,popup)});return popup.getLoadingMessage('De notificaties worden geladen...')},afterShow:function(popup){addClass(popup.offsetElement,'selected')},handleResponse:function(popup,response){var data=checkJsonResponse(response);if(data&&'html'in data){popup.element.innerHTML=data.html;Scrollable.create(Selector('.notifications',popup.element)[0],{fadeShowMore:1});NotificationMarker.enableIcons(Selector('.notification',popup.element));var markAllRead=Selector('.markAllRead',popup.element)[0];if(markAllRead)addEvent(markAllRead,'click',this.markAllRead.bind(this,popup))}},onClose:function(popup){removeClass(popup.offsetElement,'selected');RefreshTimer().resume('notificationRefresh')},markAllRead:function(popup,e){var notificationsCounter=getById('newNotificationsCount');if(notificationsCounter){removeClass(notificationsCounter.parentNode,'unread');notificationsCounter.innerHTML='0'};Selector('.notification.unread').forEach(function(el){removeClass(el,'unread')});Ajax.sendRequest(location.protocol+'//'+location.host+'/ajax/notificatie/markallread/',{method:'POST',type:'json',async:true,nocache:true,appendSid:true,strictSidCheck:true});e.preventDefault()}});PopupGenerator.register('dmNotificationsPopup',Object.extend({sendRequest:function(popup){Ajax.sendRequest(getXmlHttpUrl('frontpage','dm','get_popup'),{type:'json',async:true,nocache:true,handler:this.handleResponse.bind(this,popup)});return popup.getLoadingMessage('De berichten worden geladen...')},getUnreadCount:function(popup){return{newDmNotificationsCount:Selector('.notification',popup.element).length}}},PopupGenerator.exists('userNotificationsPopup')));PopupGenerator.register('displayOptions',{className:'menuHeaderPopup',offsetLeft:-336,offsetTop:32,handlers:{click:1},menuElement:null,countryCode:'',countryCodeElement:null,automaticLayoutElement:null,densityElement:null,backgroundElement:null,headerPreset:null,headerElement:null,gradePreset:null,gradeElement:null,densitySlider:null,backgroundSlider:null,forceUpdate:true,reload:false,additionalSettings:{},registerAdditionalSettingsForm:function(id,config){this.additionalSettings[id]=config},getContent:function(popup){if(hasClass(popup.offsetElement.parentNode,'selected'))return false;if(popup.initialized)return true;var additionalSettings=[];for(var id in this.additionalSettings)additionalSettings.push('additionalSettings%5B%5D='+id);this.menuElement=popup.offsetElement;this.countryCode=this.menuElement.getAttribute('data-country');Ajax.sendRequest(getXmlHttpUrl('frontpage','displayOptions','get_popup',additionalSettings.join('&')),{type:'json',async:true,nocache:true,handler:this.loadContent.bind(this,popup)});return popup.getLoadingMessage('De instellingen worden geladen...')},loadContent:function(popup,data){popup.setContent(data.html);popup.contentArea.className='quickSettingsContent';var form,elements,element,i;if((form=getById('countryCodeForm'))){this.countryCodeElement=form.elements['countryCode'];i=0;while((element=this.countryCodeElement[i++]))addEvent(element,'change',this.save.bind(this))};if((form=getById('displayOptionsForm'))){elements=form.elements,i=0;while((element=elements[i++])){if(element.nodeName!='INPUT'&&element.nodeName!='SELECT')continue;addEvent(element,'change',this.save.bind(this));switch(element.name){case'automatic':this.automaticLayoutElement=element;addEvent(element,'change',function(){this.backgroundSlider.setDisabled(this.automaticLayoutElement.checked);if(this.automaticLayoutElement.checked){this.backgroundElement.value=popup.offsetElement.getAttribute('data-autocolor');this.backgroundSlider.update()}}.bind(this));break;case'header':if(element.checked)this.headerPreset=element.value;break;case'ForceResponsiveGrade':this.gradeElement=element;this.gradePreset=element.value;break}};this.headerElement=form.elements['header'];this.initializeSliders(form)};for(var id in this.additionalSettings)this.additionalSettings[id].initialize();popup.initialized=true},initializeSliders:function(form){this.densityElement=form.elements['density'];this.densityElement.onchange=this.handleDensityChange.bind(this);this.densitySlider=new Slider({minSelect:this.densityElement,noLabels:1,showLower:0,tickLabelPadding:0,width:180,beforeNode:this.densityElement});this.backgroundElement=form.elements['background'];this.backgroundElement.onchange=this.save.bind(this);this.backgroundSlider=new Slider({minSelect:this.backgroundElement,onChange:this.setBackgroundColor.bind(this),noLabels:1,showLower:0,tickLabelPadding:14,width:180,beforeNode:this.backgroundElement})},setBackgroundColor:function(pos){DisplayOptions.setBackgroundColor(this.backgroundElement.options[pos].value)},getCurrentDensity:function(){return getSelectedValue(this.densityElement)},getCurrentBackground:function(){return getSelectedValue(this.backgroundElement)},getCurrentHeader:function(){return getSelectedValue(this.headerElement)},getCurrentGrade:function(){return getSelectedValue(this.gradeElement)},getCurrentCountrycode:function(){return getSelectedValue(this.countryCodeElement)},handleDensityChange:function(){DisplayOptions.setDensity(this.getCurrentDensity());this.save()},afterShow:function(popup){addClass(popup.offsetElement.parentNode,'selected');for(var id in this.additionalSettings)if('onShow'in this.additionalSettings[id])this.additionalSettings[id].onShow()},onClose:function(popup){removeClass(popup.offsetElement.parentNode,'selected');for(var id in this.additionalSettings)if('onClose'in this.additionalSettings[id])this.additionalSettings[id].onClose()},save:function(){if(this.countryCode!=getSelectedValue(this.countryCodeElement)||this.gradePreset!=getSelectedValue(this.gradeElement)||this.headerPreset!=getSelectedValue(this.headerElement)){this.reload=true;var countryCodeForm=getById('countryCodeForm');if(countryCodeForm){countryCodeForm.parentNode.style.opacity=0.1;var loadingDiv=document.createElement('div');loadingDiv.className='reloadText';loadingDiv.innerHTML='<img src="'+jsConfig.get('ImgURL')+'g/if/icons/throbber.gif"> <span>De pagina wordt herladen...</span>';countryCodeForm.parentNode.parentNode.appendChild(loadingDiv)}};Ajax.sendRequest(getXmlHttpUrl('frontpage','displayOptions','save'),{method:'POST',async:true,appendSid:true,handler:this.handleSave.bind(this)},'density='+this.getCurrentDensity()+'&background='+this.getCurrentBackground()+'&automatic='+(this.automaticLayoutElement.checked?1:0)+'&header='+this.getCurrentHeader()+'&grade='+this.getCurrentGrade()+'&countryCode='+this.getCurrentCountrycode());if(this.bgTimer){clearTimeout(this.bgTimer);this.bgTimer=null}},handleSave:function(data){if(!(this.reload&&data=='success'))return;location.reload(true)}});PopupGenerator.register('socialPopup',{offsetLeft:10,offsetTop:-17,handlers:{click:1},arrow:'left',forceUpdate:true,getContent:function(popup,e){if(popup.visible){e.preventDefault();return false};return getById('shareButtonContent')}});PopupGenerator.register('karmaPopup',{offsetLeft:20,offsetTop:-17,handlers:{click:1},arrow:'left',forceUpdate:true,getContent:function(popup,e){Ajax.sendRequest(getXmlHttpUrl('tweakbase','topKarmaUsers')+'&itemIdentifier='+popup.offsetElement.getAttribute('data-itemidentifier')+'&userId='+popup.offsetElement.getAttribute('data-userid'),{type:'json',async:true,nocache:true,handler:this.loadContent.bind(this,popup)});return popup.getLoadingMessage('')},loadContent:function(popup,response){var html=checkJsonResponse(response);if(html)popup.setContent(html)}});PopupGenerator.register('newbiePopup',{offsetLeft:15,offsetTop:-21,handlers:{click:1},arrow:'left',getContent:function(popup,e){return'<div class="popupInfo"><h3>Newbie</h3><p>Newbie is een nieuwe status binnen Tweakers en heeft enkel betrekking op reviews. De status benadrukt dat de review is geschreven door een beginnende reviewer. Dit zegt verder niks over de kwaliteit van de review.</p><p>Newbie af? Newbie is ook een aanmoediging voor de gebruiker. De status is dan ook niet definitief en verdwijnt na verloop van tijd door verhoogde activiteit. Post een comment op een artikel, schrijf nog een review of meng je in een discussie op het forum. Voor je het weet ben je newbie af en ga je op voor karmakoning.</p></div>'}});PopupGenerator.register('testPanelPopup',{offsetLeft:15,offsetTop:-21,handlers:{click:1},arrow:'left',getContent:function(popup,e){return'<div class="popupInfo"><h3>Tweakers Testpanel</h3><p>Voor het Tweakers Testpanel worden reviews geïnitieerd door de fabrikant en uitgevoerd door de community. De fabrikant stelt het product beschikbaar, maar het is aan de reviewer om te oordelen: onafhankelijke reviews voor en door Tweakers.</p><p>Voor het <a href="https://tweakers.net/info/faq/pricewatch#testpanel">Tweakers Testpanel</a> zijn we constant op zoek naar users die graag de nieuwste producten testen.</p></div>'}})};var NotificationMarker=(function(){var clickableSelector='.notificationType',closeSelector='.close',markReadAction='markeergelezen',markUnreadAction='markeerongelezen',enableReadMarkers=function(notifications,markerSelector){notifications.forEach(function(notification){var readMarker=Selector(markerSelector,notification)[0];if(readMarker)readMarker.onclick=handleClick})},handleClick=function(e){var notification=TreeWalker(this).parentNode('.notification');if(!notification)return;var notificationId=getNotificationId(notification),action=isRead(notification)?markUnreadAction:markReadAction;Ajax.sendRequest(location.protocol+'//'+location.host+'/ajax/notificatie/'+action+'/'+notificationId+'/',{method:'POST',type:'json',async:true,nocache:true,appendSid:true,handler:markNotification.bind(this,notification,action)});if(e){e.stopPropagation();e.preventDefault()}},markNotification=function(notification,action,response){if(!response)return;var notificationId=getNotificationId(notification),markRead=(action==markReadAction);Selector('.notification').forEach(function(notification){if(getNotificationId(notification)!=notificationId)return;if(markRead){removeClass(notification,'unread')}else addClass(notification,'unread');var clickableElement=Selector(clickableSelector,notification)[0];if(clickableElement)clickableElement.title=markRead?'Markeer als ongelezen':'Markeer als gelezen'});if(!isBroadcast(notificationId)){var currentCount=NotificationNotifier.getCurrentCount('newNotificationsCount')+(markRead?-1:+1);NotificationNotifier.updateUnreadCounts({newNotificationsCount:currentCount})}},getNotificationId=function(notification){return notification.getAttribute('data-notification-id')},isBroadcast=function(notificationId){return notificationId.indexOf('b:')==0},isRead=function(notification){return!hasClass(notification,'unread')},enableIcons=function(notifications){if(notifications.length)enableReadMarkers(notifications,clickableSelector)};return{initBroadcastList:function(){var notifications=Selector('#notifications .notification');if(notifications.length)enableReadMarkers(notifications,closeSelector)},initNotificationsPage:function(){enableIcons(Selector('.notificationList .notification.markable'))},enableIcons:enableIcons}})(),FixedHeader=(function(){var menuBar,showMenuLength=250,showMenuDelayedTimer=null,showMenuMeasureTime=50,showMenuMinScrollY=50,currentPageYOffset=0,updateHeader=function(){var pageYOffset=getPageYOffset(),clearTimer=true;if(pageYOffset<=menuBar.parentNode.offsetTop){removeFixedHeaderStyle()}else if(pageYOffset>menuBar.offsetTop&&pageYOffset<=showMenuLength){menuBar.className='scrollheader';addClass(document.body,'visibleHeader')}else if(currentPageYOffset>pageYOffset){if(pageYOffset>showMenuLength&&!hasClass(document.body,'visibleHeader'))showMenuDelayedTimer=setTimeout(updateHeaderDelayed.bind(this,pageYOffset),showMenuMeasureTime);clearTimer=false}else if(currentPageYOffset<pageYOffset){menuBar.className='hideheader';removeClass(document.body,'visibleHeader');var closePopups=['searchPopup','displayOptions'];if(!(window.Responsive&&Responsive.getCurrentDeviceGrade()=='D'))closePopups.push('dmNotificationsPopup','userNotificationsPopup','selectedProductsPopup');closePopups.forEach(function(id){PopupGenerator.closePopup(id)})};currentPageYOffset=pageYOffset;if(clearTimer&&showMenuDelayedTimer)clearMenuDelayedTimer()},getPageYOffset=function(){return window.pageYOffset||document.documentElement.scrollTop},removeFixedHeaderStyle=function(){menuBar.className='';menuBar.style.width='';removeClass(document.body,'visibleHeader')},updateHeaderDelayed=function(pageYOffset){if(pageYOffset-getPageYOffset()>showMenuMinScrollY){menuBar.className='showheader';addClass(document.body,'visibleHeader')};clearMenuDelayedTimer()},clearMenuDelayedTimer=function(){clearTimeout(showMenuDelayedTimer);showMenuDelayedTimer=null};return{init:function(){if(menuBar)return;if(hasClass(document.body,'fixedHeader')&&(menuBar=getById('menubar')))addEvent(window,'scroll',updateHeader)},remove:function(){if(menuBar){removeFixedHeaderStyle();removeEvent(window,'scroll',updateHeader);menuBar=null}}}})(),DisplayOptions={currentColorValue:null,appliedColorValue:null,bgTimer:null,setBackgroundColor:function(color){this.currentColorValue=color;if(!this.bgTimer)this._applyBackgroundColor()},setDensity:function(density){if(!density||!density.match(/(cozy|compact|normal)/))throw'Illegal density';var links=getHead().getElementsByTagName('link'),i=0,link,match,prevDensity='normal';if(density!='normal')loadCSS('framework_'+density+'.css?'+Date.now());while((link=links[i++]))if(link.href&&(match=link.href.match(/\/framework_(cozy|compact)\.css/))){if(!link.disabled)prevDensity=match[1];if(match[1]==density){if(link.disabled)link.disabled=false}else link.disabled=true};return prevDensity},_applyBackgroundColor:function(){if(this.currentColorValue==this.appliedColorValue){clearTimeout(this.bgTimer);this.bgTimer=null;return};var colorValue=parseInt(this.currentColorValue,10),element,newStylesheet;if(colorValue==255){if(hasClass(document.body,'customColor'))removeClass(document.body,'customColor')}else{if(!hasClass(document.body,'customColor'))addClass(document.body,'customColor');var colorElements=['body','#bottom div.hr','#entity','#heroBlock','#searchbar','.galleryHeadingContainer','.pageTabsContainer','.notificationsContainer','#contentMenu'],borderElements=['#contentArea','#top','#mainSearch','#entity>div','.entityHeader .thumb','.galleryHeading .thumb','.pageTabs li','#heroBlock','#contentMenu .menu'],borderHoverElements=['#mainSearch:hover'];newStylesheet=createStylesheet('customCss.css?'+Math.random(),'#contentArea{border:1px solid}'+colorElements.join(',')+'{background-color:rgb('+[colorValue-1,colorValue,colorValue].join(',')+')}'+borderElements.join(',')+'{border-color:rgb('+[colorValue-31,colorValue-30,colorValue-30].join(',')+')}'+borderHoverElements.join(',')+'{border-color:rgb('+[colorValue-63,colorValue-62,colorValue-62].join(',')+')}')};if((element=getById('customBgCss')))element.parentNode.removeChild(element);if(newStylesheet)newStylesheet.id='customBgCss';this.appliedColorValue=this.currentColorValue;this.bgTimer=setTimeout(this._applyBackgroundColor.bind(this),50)}},Tracker={tracker:null,elements:null,stretcher:null,settingsHtml:null,defaultMaxTrackerSize:20,drag:null,dy:0,sy:0,EV_START:null,EV_MOVE:null,EV_END:null,refreshRate:60,updateScrollableTimer:null,fixedSupport:true,initialOptions:null,layoutOffsetTop:0,fixedHeaderOffset:22,relativeHeaderOffset:68,init:function(options){this.tracker=getById('tracker');this.initialOptions=options||{};this.fixedSupport=!Browser.is.mobile},initContent:function(){if(this.initialOptions.visible)addClass(document.body,'trackerVisible');if(!(this.fixedSupport&&this.initialOptions.fixed))addClass(document.body,'trackerScroll');if(this.initialOptions.position=='r')addClass(document.body,'trackerRight');addClass(document.body,'hasTracker');var top=getById('top');if(top){this.layoutOffsetTop=top.offsetTop;this.tracker.style.top=this.layoutOffsetTop+'px'};var trackerLabel=HTMLBuilder().built({n:'div',a:{className:'fakeTop'},c:[{n:'div',a:{className:'toggleVisibility',onclick:this.toggleVisibility.bind(this)},c:[{n:'div',a:{className:'corner'}}]},jsConfig.get("usabillaScriptId")?{n:'div',a:{className:'giveFeedback'+(jsConfig.get('UserID')?'':' full'),title:'Feedback',onclick:loadUsabilla}}:null]});this.tracker.appendChild(trackerLabel);var settings=[];if(jsConfig.get('UserID'))settings.push({n:'li',a:{id:'trackerSettingsLink'},c:{n:'span',a:{onclick:this.switchSettingsVisibility.bind(this)},t:'Instellingen'}});if(this.fixedSupport){settings.push({n:'li',a:{id:'trackerFixedLink'},c:{n:'span',a:{onclick:this.toggleFixed.bind(this)},t:this.getFixedLabel()}});this.stretcher=document.createElement('div');this.stretcher.id='trackerStretch';this.tracker.parentNode.insertBefore(this.stretcher,this.tracker)};settings.push({n:'li',a:{id:'trackerPositionLink'},c:{n:'span',a:{onclick:this.togglePosition.bind(this)},t:this.getPositionLabel()}});var trackerContent=HTMLBuilder().built({n:'div',a:{id:'trackerContainer'},c:[{n:'div',a:{id:'trackerHeader'},c:[{n:'span',a:{id:'trackerIcon'}},{n:'h4',a:{id:'trackerTitle'},t:'Tracker'},{n:'ul',a:{className:'bulletSeparatedList'},c:settings}]},{n:'div',a:{id:'trackerContentContainer'},c:{n:'div',a:{id:'trackerContent'}}}]});this.tracker.appendChild(trackerContent);this.elements=HTMLBuilder().getIdList();addEvent(window,'scroll',this.scrollHandler.bind(this,200));addEvent(window,'resize',this.resizeHandler.bind(this,200));addEvent(this.elements.trackerContentContainer,'mouseenter',this.pauseRefresh.bind(this));addEvent(this.elements.trackerContentContainer,'mouseleave',this.resumeRefresh.bind(this));this.toggleTrackerWidth()},buildTrackerSettings:function(){var data=Ajax.sendRequest(getXmlHttpUrl('frontpage','tracker','get_settings'),{type:'json',nocache:true,handler:checkJsonResponse});if(data&&'settings'in data){var trackerId,options=[],setting;options.push({n:'tr',c:[{n:'th',t:'Type'},{n:'th',a:{colSpan:3},t:'Aantal items'}]});for(trackerId in data.settings){setting=data.settings[trackerId];if('aantal'in setting)options.push({n:'tr',a:{id:'tr_'+trackerId},c:[{n:'td',a:{className:'settingsLabel'},t:setting.caption||trackerId.ucFirst()},{n:'td',a:{className:'lessItems'},c:{n:'span',a:{className:'fancyButton moreless',onclick:this.updateSettingsNr.bind(this,'showtracker_'+trackerId,-1)},t:'-'}},{n:'td',a:{className:'nrItems'},c:{n:'input',a:{type:'text',id:'showtracker_'+trackerId,name:'showtracker_'+trackerId,value:setting.aantal||0,onfocus:this.settingFocus.bind(this,true),onblur:this.settingFocus.bind(this,false)}}},{n:'td',a:{className:'addItems'},c:{n:'span',a:{className:'fancyButton moreless',onclick:this.updateSettingsNr.bind(this,'showtracker_'+trackerId,+1)},t:'+'}}]})};return HTMLBuilder().built({n:'div',a:{id:'trackerSettings'},c:[{n:'p',t:'Wijzig de volgorde met drag & drop.'},{n:'form',a:{id:'trackerSettingsForm'},c:[{n:'table',a:{cellpadding:0},c:options},{n:'div',a:{className:'buttonBlock'},c:[{n:'input',a:{type:'button',className:'save fancyButton',value:'Opslaan',onclick:this.saveSettings.bind(this)}},{n:'input',a:{type:'button',className:'reset fancyButton',value:'Annuleren',onclick:this.resetSettings.bind(this)}}]}]}]})};return null},switchSettingsVisibility:function(){var switchLink=this.elements.trackerSettingsLink.firstChild,trackerTitle=this.elements.trackerTitle;if(!this.settingsHtml){this.settingsHtml=this.buildTrackerSettings();if(this.settingsHtml){this.elements.trackerContentContainer.appendChild(this.settingsHtml);this.EV_START=addEvent(this.settingsHtml,'mousedown',this.dragStart.bind(this),true);switchLink.innerHTML='Terug naar tracker';trackerTitle.innerHTML='Instellingen';addClass(trackerTitle.parentNode,'settings');this.settingsHtml.style.display='block';this.elements.trackerContent.style.display='none'}}else{switchLink.innerHTML='Instellingen';trackerTitle.innerHTML='Tracker';removeClass(trackerTitle.parentNode,'settings');this.elements.trackerContent.style.display='block';removeEvent(this.settingsHtml,'mousedown',this.EV_START);this.settingsHtml.parentNode.removeChild(this.settingsHtml);this.settingsHtml=this.EV_START=null};this.updateScrollable(true)},updateSettingsNr:function(el,i){var input=getById(el);if(input)input.value=Math.min(this.defaultMaxTrackerSize,Math.max(parseInt(input.value,10)+i,0))},settingFocus:function(setFocus,e){var target=e&&(e.target||e.srcElement);while(target){if(target.nodeName=='TR'){if(setFocus){addClass(target,'focussed')}else removeClass(target,'focussed');break};target=target.parentNode}},resetSettings:function(e){if(e)stopPropagation(e);this.switchSettingsVisibility()},saveSettings:function(e){if(e)stopPropagation(e);var result=Ajax.sendRequest(getXmlHttpUrl('frontpage','tracker','save_settings'),{method:'POST',type:'json',appendSid:true,handler:checkJsonResponse},getQueryString(document.forms['trackerSettingsForm']));if(result){if('html'in result)this.elements.trackerContent.innerHTML=result.html;this.switchSettingsVisibility()}},dragStart:function(e){if(!this.drag){var settingRow=e.target;while(settingRow&&settingRow.nodeName!='TR'){if(settingRow.nodeName=='TD'&&settingRow.className!='settingsLabel')return;settingRow=settingRow.parentElement};if(settingRow&&settingRow.id){e.preventDefault();this.drag=settingRow;addClass(settingRow,'dragging');addClass(this.settingsHtml,'drag');var scrollTop=this.isFixed()?0:getPageDimensions().offsetY;this.dy=getOffsetTop(settingRow)-scrollTop;this.sy=e.clientY;this.EV_MOVE=addEvent(this.settingsHtml,'mousemove',this.dragDo.bind(this),true);this.EV_END=addEvent(document,'mouseup',this.dragStop.bind(this),true);this.settingsHtml.setAttribute('unselectable','on');this.settingsHtml.onselectstart=cancelEvent}}},dragDo:function(e){if(this.drag){e.preventDefault();var ny=e.clientY,ch=this.drag.offsetHeight;if(ny-this.dy>ch){el=this.drag.nextSibling;if(el&&el.id){this.drag.parentNode.insertBefore(this.drag,el.nextSibling);this.dy+=ch;this.sy=ny}}else if(ny-this.dy<0){el=this.drag.previousSibling;if(el&&el.id){this.drag.parentNode.insertBefore(this.drag,el);this.dy-=ch;this.sy=ny}}}},dragStop:function(){if(this.drag){removeClass(this.drag,'dragging');removeClass(this.settingsHtml,'drag');removeEvent(this.settingsHtml,'mousemove',this.EV_MOVE);removeEvent(document,'mouseup',this.EV_END);this.settingsHtml.removeAttribute('unselectable');this.settingsHtml.onselectstart=null;this.drag=this.EV_MOVE=this.EV_END=null}},isVisible:function(){return hasClass(document.body,'trackerVisible')},isFixed:function(){return!hasClass(document.body,'trackerScroll')},getPosition:function(){return hasClass(document.body,'trackerRight')?'r':'l'},toggleVisibility:function(){if(this.settingsHtml)this.switchSettingsVisibility();if(this.getPosition()=='r'){removeClass(document.body,'trans')}else{addClass(document.body,'trans');setTimeout(function(){removeClass(document.body,'trans')},700)};toggleClass(document.body,'trackerVisible');this.saveOptions();this.scrollHandler();this.refresh();if(this.isVisible()&&window.scrollBy)window.scrollBy(document.documentElement.clientWidth*(this.getPosition()=='r'?1:-1),0)},toggleFixed:function(){toggleClass(document.body,'trackerScroll');this.saveOptions();this.elements.trackerFixedLink.firstChild.innerHTML=this.getFixedLabel();this.scrollHandler()},togglePosition:function(){toggleClass(document.body,'trackerRight');this.saveOptions();this.elements.trackerPositionLink.firstChild.innerHTML=this.getPositionLabel();this.scrollHandler()},getPositionLabel:function(){return this.getPosition()=='r'?'Links':'Rechts'},getFixedLabel:function(){return this.isFixed()?'Scroll':'Fixeer'},scrollHandler:function(updateScrollableTimeout){var dim=getPageDimensions(),cssText='',visible=this.isVisible(),fixed=this.isFixed();if(fixed){var topOffset=hasClass(document.body,'fixedHeader')?this.fixedHeaderOffset:this.relativeHeaderOffset;cssText+='top:'+(-Math.min(Math.max(0,dim.offsetY)-this.layoutOffsetTop,topOffset))+'px;';if(this.getPosition()=='r'){cssText+='right:'+(dim.availWidth-dim.scrollWidth+dim.offsetX)+'px;'}else if(dim.offsetX>0){var left=-dim.offsetX;if(!visible)left-=this.tracker.offsetWidth-6;cssText+='left:'+left+'px;'}}else cssText+='top:'+this.layoutOffsetTop+'px;';this.tracker.style.cssText=cssText;if(visible){clearTimeout(this.updateScrollableTimer);this.updateScrollableTimer=setTimeout(this.updateScrollable.bind(this,updateScrollableTimeout==1),updateScrollableTimeout||10)}},toggleTrackerWidth:function(){if(hasClass(document.body,'smallTracker')!=document.documentElement.clientWidth<1400){toggleClass(document.body,'smallTracker');return true};return false},resizeHandler:function(updateScrollableTimeout){this.scrollHandler(this.toggleTrackerWidth()?1:updateScrollableTimeout)},updateScrollable:function(forceUpdate){var content=this.elements.trackerContentContainer,height,layout;if(this.isFixed()){height=document.documentElement.clientHeight-getOffsetTop(content)-20;if(forceUpdate||height!=parseInt(content.style.height)){content.style.height=height+'px';Scrollable.create(content,{lightcolor:1})}}else{Scrollable.destroy(content);content.style.height='';if((layout=getById('layout'))){height=Math.max(0,content.clientHeight-60);if(height!=parseInt(layout.style.minHeight))layout.style.minHeight=height+'px'}}},refresh:function(){if(!this.tracker||this.tracker.style.display=='none')return;if(!hasClass(document.body,'hasTracker'))this.initContent();if(this.isVisible()){this.resumeRefresh()}else this.pauseRefresh()},pauseRefresh:function(){RefreshTimer().pause('trackerRefresh')},resumeRefresh:function(){var rt=RefreshTimer();if(rt.has('trackerRefresh')){rt.resume('trackerRefresh');return};rt.add('trackerRefresh',this.refreshAll.bind(this),this.refreshRate);var firstTime=true,trackerCache=Browser.supports('sessionStorage')&&sessionStorage.getItem('trackerCache');if(trackerCache){trackerCache=JSON.parse(trackerCache);if('html'in trackerCache&&Date.now()-trackerCache.timestamp<this.refreshRate*1e3){this.handleRefresh(firstTime,{data:{html:trackerCache.html,fromCache:true}});firstTime=false}};setTimeout(this.refreshAll.bind(this,firstTime),firstTime?1:1e4)},refreshAll:function(firstTime){addClass(this.elements.trackerHeader,'updating');Ajax.sendRequest(getXmlHttpUrl('frontpage','tracker','get_tracker'),{type:'json',async:true,nocache:true,handler:this.handleRefresh.bind(this,firstTime)})},handleRefresh:function(firstTime,response){var data=checkJsonResponse(response);if(data&&'html'in data){this.elements.trackerContent.innerHTML=data.html;if(!data.fromCache&&Browser.supports('sessionStorage'))sessionStorage.setItem('trackerCache',JSON.stringify({timestamp:Date.now(),html:data.html}))};removeClass(this.elements.trackerHeader,'updating');this.scrollHandler(firstTime?1:10)},saveOptions:function(){var fixed=this.fixedSupport?this.isFixed():this.initialOptions.fixed;Ajax.sendRequest(getXmlHttpUrl('frontpage','tracker','save_options'),{method:'POST',async:true,appendSid:true},'position='+this.getPosition()+'&fixed='+(fixed?1:0)+'&visible='+(this.isVisible()?1:0))}},NotificationNotifier=(function(){var totalCounterId='totalNotificationsCount',getCurrentCount=function(counterId){var counter=getById(counterId);if(!counter)return 0;return parseInt(counter.innerHTML,10)||0},requestUnreadCounts=function(){Ajax.sendRequest(getXmlHttpUrl('frontpage','notifications','get_notification_unread_counts'),{type:'json',async:true,nocache:true,handler:function(response){if(response&&'data'in response)updateUnreadCounts(response.data)}})},updateCounter=function(counter,count){counter.innerHTML=count;if(count>0){addClass(counter.parentNode,'unread')}else removeClass(counter.parentNode,'unread')},updateTotalCounter=function(totalCounter,data){var id,count,total=0,notificationsCount=0,compareItemCount=0,rightSidebarToggle=Selector('.rightSidebarToggle')[0];for(id in data){count=parseInt(data[id])||0;if(id.contains('Notifications')){notificationsCount+=count}else if(id.contains('CompareItem'))compareItemCount+=count;total+=count};updateCounter(totalCounter,total);if(!rightSidebarToggle)return;if(notificationsCount){addClass(rightSidebarToggle,'highlight')}else if(!compareItemCount)removeClass(rightSidebarToggle,'highlight')},updateUnreadCounts=function(data){var counter;Selector('.newNotificationsCount').forEach(function(counter){if(!counter.id||counter.id==totalCounterId)return;if(counter.id in data){updateCounter(counter,data[counter.id])}else data[counter.id]=counter.innerHTML});if((counter=getById(totalCounterId)))updateTotalCounter(counter,data)};return{init:function(){RefreshTimer().add('notificationRefresh',requestUnreadCounts,60)},updateUnreadCounts:updateUnreadCounts,getCurrentCount:getCurrentCount}})()
function SearchSuggest(searchType,formName){this.searchType=searchType;this.form=document.forms[formName||'mainSearch'];this.input=this.form&&this.form.elements['keyword'];this.currentValue='';this.ajaxUrl=getXmlHttpUrl('sitewidesearch','search',searchType);this.ajaxBusy=false;this.ajaxTimer=null;this.executionCallbacks=[];this.additionalParameterCallback=null;this.overlay=null;this.popup=null;this.popupConfig={offsetLeft:0,offsetTop:30};if(this.input){this.input.setAttribute('autocomplete','off');this.input.onkeyup=this.keyHandler.bind(this)}};Object.extend(SearchSuggest.prototype,{getValue:function(){return hasClass(this.input,'placeholder')?'':this.input.value.trim().normalizeDiacritics().toLowerCase()},initResultContainer:function(){if(!this.popup&&window.PopupGenerator){PopupGenerator.register('mainSearchSuggest',this.popupConfig);this.popup=PopupGenerator.get('mainSearchSuggest');this.overlay=document.createElement('div');this.overlay.className='overlay';this.popup.setContent('<div style="height:442px"></div>')};if(this.popup){this.popup.show(this.input);addClass(this.popup.contentArea,'opaque');this.popup.contentArea.appendChild(this.overlay);this.overlay.style.height=this.popup.contentArea.clientHeight+'px';this.overlay.style.display='block'}},destroyResultContainer:function(){if(this.popup)this.popup.close(true)},keyHandler:function(e){this.clearAjaxTimer();var value=this.getValue();if(value.length>1&&this.handleExecutionCallbacks(e)){if(value!=this.currentValue)this.executeSearch(value)}else{this.currentValue=value;this.destroyResultContainer()}},executeSearch:function(value){this.initResultContainer();this.ajaxTimer=setTimeout(this.sendAjaxRequest.bind(this,value),200)},handleExecutionCallbacks:function(e){var i=0,callback;while((callback=this.executionCallbacks[i++]))if(!callback(e))return false;return true},clearAjaxTimer:function(){clearTimeout(this.ajaxTimer);this.ajaxTimer=null},sendAjaxRequest:function(value){if(this.ajaxBusy){this.keyHandler();return};this.ajaxStartCallback();this.ajaxBusy=true;var additionalParameters=this.additionalParameterCallback?this.additionalParameterCallback():'';Ajax.sendRequest(this.ajaxUrl+'&keyword='+encodeURIComponent(value)+additionalParameters,{type:'json',async:true,appendCountry:true,handler:this.handleResult.bind(this,value)});this.currentValue=value},ajaxStartCallback:function(){},ajaxFinishCallback:function(){},handleResult:function(value,result){this.ajaxBusy=false;this.ajaxFinishCallback();return this.displayResult(value,result)},displayResult:function(value,result){if(!this.popup)return;var content=[],i,item,label;if(!result||'error'in result||'message'in result){content.push('<p class="noResults">'+(result?(result.error||result.message):'Geen resultaten gevonden')+'</p>')}else{if('entities'in result&&result.entities.length){if(this.searchType!='forum'){content.push('<h4>Onderwerpen</h4>')}else content.push('<h4>Fora</h4>');content.push('<ul class="twk '+this.searchType+'">');i=0;while((item=result.entities[i++])){content.push('<li>',this.createThumbHtml(item),'<p class="ellipsis"><a href="'+item.link+'" title="'+item.name.escapeHtml()+'">'+item.name.escapeHtml()+'</a></p>');if(item.nrOfProducts)content.push('<p class="moreContent"><a href="'+item.nrOfProductsLink+'">'+item.nrOfProducts+' product'+(item.nrOfProducts>1?'en':'')+'</a></p>');if(item.nrOfArticles){label=item.nrOfArticles==1?(result.singleitemtype||'artikel'):(result.itemtype||'artikelen');content.push('<p class="moreContent"><a href="'+item.nrOfArticlesLink+'">'+item.nrOfArticles+' '+label.toLowerCase()+'</a></p>')};if(item.minPrice||item.rating)content.push('<p class="price">'+(item.rating||'')+' '+(item.minPrice||'')+'</p>');content.push('</li>')};content.push('</ul>')};if('articles'in result&&result.articles.length){if(this.searchType=='userReview'){content.push('<h4>Kies het product waar je de review voor wilt schrijven</h4>')}else content.push('<h4>'+(result.itemtype||'Artikelen')+'</h4>');content.push('<ul class="'+this.searchType+'">');i=0;while((item=result.articles[i++])){content.push('<li'+(item.label?' class="multiline"':'')+'>',this.createThumbHtml(item),'<p class="ellipsis" title="'+item.name.escapeHtml()+'"><a href="'+item.link+'">'+item.name.escapeHtml()+'</a></p>');if(item.label)content.push('<p class="ellipsis" title="'+item.label.escapeHtml()+'"><a href="'+item.link+'"  style="text-decoration: underline;">'+item.label.escapeHtml()+'</a></p>');content.push('</li>')};content.push('</ul>')};if(this.searchType=='userReview'){content.push('<p>Het product niet gevonden? Verfijn je zoekopdracht voor meer resultaten</p>')}else content.push('<p><a href="'+this.form.action+'?keyword='+encodeURIComponent(value)+'" class="readMore">Meer resultaten</a></p>')};this.popup.setContent(content.join(''));if(this.form.onsubmit){var trackSearch=this.trackSearch.bind(this);Selector('a',this.popup.contentArea).forEach(function(el){el.onclick=trackSearch})};this.popup.show(this.input);if(this.overlay){removeClass(this.popup.contentArea,'opaque');this.overlay.style.display='none'}},createThumbHtml:function(item){if(!('thumbnail'in item))return'';var thumbClass='thumb micro '+item.type,thumbImg;if(item.thumbnail){thumbImg='<img src="'+item.thumbnail+'" width=37 height=37>'}else{thumbImg='<!-- no img -->';thumbClass+=' empty'};return'<div class="'+thumbClass+'"><a href="'+item.link+'">'+thumbImg+'</a></div>'},trackSearch:function(){this.form.onsubmit()},setDisabled:function(disabled){this.disabled=disabled},addExecutionCallback:function(callback){this.executionCallbacks.push(callback)},setAdditionalParameterCallback:function(callback){this.additionalParameterCallback=callback}})
function ProductEditionPriceBlock(){var selectItem=function(){var priceData=getById('productEditionPriceData');if(!priceData)return;Selector('span.specName',select)[0].innerHTML=this.innerHTML;var html=Ajax.sendRequest(getXmlHttpUrl('frontpage','getLowestPricesForProductEdition'),{appendCountry:true},'productEditionId='+this.getAttribute('data-producteditionid'));if(html){priceData.innerHTML=html;BehaviourManager.exec(priceData)}},select=initDropDowns('#productEditionPriceBlock .sortable')[0];if(select)Selector('li',select).forEach(function(el){el.onclick=selectItem})}
function Slider(options){this.options=options;this.element=null;this.slider=null;this.clearDiv=null;this.minSelect=null;this.maxSelect=null;this.sliderMin=null;this.sliderMax=null;this.sliderPointerWidth=13;this.maxTicks=6;this.disabled=false;this.min=0;this.max=0;this.step=0;this.valueMin=0;this.valueMax=0;this.showLower=0;this.showHigher=0;this.lowValue=null;this.highValue=null;this.initialized=false;this.resizeTimer=null;this.drag=null;this.cx=0;this.sx=0;this.x=0;this.maxX=0;this.EV_MOVE=null;this.EV_END=null;this.init()};Object.extend(Slider.prototype,{init:function(){if(!this.options)return;this.element=document.createElement('div');this.element.className='sliderControl'+(this.options.noLabels?' noLabels':'');this.element.onselectstart=cancelEvent;this.sliderArea=document.createElement('div');this.sliderArea.className='sliderArea';this.element.appendChild(this.sliderArea);this.clearDiv=document.createElement('div');this.clearDiv.style.clear='both';preload('sliderPointerImg',jsConfig.get('ImgURL')+'g/slider/sliderPointerLarge.png');preload('sliderPointerImgDisabled',jsConfig.get('ImgURL')+'g/slider/sliderPointerLargeDisabled.png');if(this.options.minSelect||this.options.maxSelect){if(this.options.minSelect&&this.options.minSelect.nodeName=='SELECT'){if(this.options.minSelect.disabled){this.disabled=true;addClass(this.element,'disabled')};if('lowValue'in this.options){this.options.minSelect.value=this.options.lowValue}else{this.minSelect=this.options.minSelect;if(!this.minSelect.setSelectedIndex){this.minSelect.setSelectedIndex=this.selectedIndexSetter}else this.minSelect.update();if('highValue'in this.options)this.highValue=this.options.highValue;if(this.options.showLower)this.showLower=1;if(this.minSelect.options.length){this.min=this.showLower||this.minSelect.options[0].value==''?1:0;this.max=this.minSelect.options.length-1};this.options.valueMin=Math.max(this.minSelect.selectedIndex,this.min-this.showLower)}};if(this.options.maxSelect&&this.options.maxSelect.nodeName=='SELECT')if('highValue'in this.options){this.options.maxSelect.value=this.options.highValue}else{this.maxSelect=this.options.maxSelect;if(!this.maxSelect.setSelectedIndex){this.maxSelect.setSelectedIndex=this.selectedIndexSetter}else this.maxSelect.update();if('lowValue'in this.options)this.lowValue=this.options.lowValue;if(this.options.showHigher)this.showHigher=1;if(this.maxSelect.options.length){this.max=this.maxSelect.options.length-1-this.showHigher;if(!this.minSelect){this.showLower=0;this.min=this.maxSelect.options[0].value==''?1:0}else this.max+=this.showLower};this.options.valueMax=this.maxSelect.selectedIndex>0?this.maxSelect.selectedIndex+this.showLower:this.max+this.showHigher};if(!('step'in this.options)||this.options.step==undefined)this.options.step=1}else{this.min=parseInt(this.options.min||0,10);this.max=parseInt(this.options.max,10)};if('step'in this.options){this.step=parseInt(this.options.step,10)}else this.step=Math.ceil((this.max-this.min)/10);if(this.options.maxTicks)this.maxTicks=parseInt(this.options.maxTicks,10);this.sliderBar=document.createElement('div');this.sliderBar.className='sliderBar';this.sliderArea.appendChild(this.sliderBar);this.sliderSelected=document.createElement('div');this.sliderSelected.className='sliderBar selected';this.sliderBar.appendChild(this.sliderSelected);if('valueMin'in this.options){this.valueMin=parseInt(this.options.valueMin,10);this.sliderMin=document.createElement('img');this.sliderMin.className='sliderPointer';this.sliderMin.src=getPreloadImage('sliderPointerImg'+(this.disabled?'Disabled':''));this.sliderBar.appendChild(this.sliderMin);if(!this.options.noLabels){this.sliderMinLabel=document.createElement('div');this.sliderMinLabel.className='sliderLabel';this.sliderMinLabel.appendChild(document.createTextNode(''));this.sliderBar.appendChild(this.sliderMinLabel)};addEvent(this.sliderMin,'mousedown',this.sliderStart.bind(this,this.sliderMin),true);this.sliderMin.ondragstart=cancelEvent};if('valueMax'in this.options){this.valueMax=parseInt(this.options.valueMax,10);this.sliderMax=document.createElement('img');this.sliderMax.className='sliderPointer';this.sliderMax.src=getPreloadImage('sliderPointerImg'+(this.disabled?'Disabled':''));this.sliderBar.appendChild(this.sliderMax);if(!this.options.noLabels){this.sliderMaxLabel=document.createElement('div');if(this.sliderMinLabel){this.sliderMaxLabel.className='sliderSecondLabel';this.element.className+=' doubleLabel'}else this.sliderMaxLabel.className='sliderLabel';this.sliderMaxLabel.appendChild(document.createTextNode(''));this.sliderBar.appendChild(this.sliderMaxLabel)};addEvent(this.sliderMax,'mousedown',this.sliderStart.bind(this,this.sliderMax),true);this.sliderMax.ondragstart=cancelEvent};var parentNode=(this.options.beforeNode||this.options).parentNode;if(parentNode)parentNode.insertBefore(this.element,this.options.beforeNode||null);addEvent(this.sliderArea,'click',this.sliderClick.bind(this));addCustomEvent(this.element,'resize',this.paint.bind(this));if(!this.options.width)addEvent(window,'resize',this.resizeHandler.bind(this));this.paint()},resizeHandler:function(){clearTimeout(this.resizeTimer);this.resizeTimer=setTimeout(this.paint.bind(this),100)},paint:function(width){if(this.initialized){if(width!=undefined&&width!=this.options.width){this.options.width=width}else if(this.options.width||this.element.offsetWidth==parseInt(this.sliderArea.style.width))return;Selector('.sliderTick',this.element).forEach(function(tick){tick.parentNode.removeChild(tick)})};width=this.options.width||this.element.offsetWidth||180;this.sliderArea.style.width=width+'px';this.maxX=(width-=this.sliderPointerWidth);if(this.showLower)width-=Math.floor(this.sliderPointerWidth/2);if(this.showHigher)width-=Math.ceil(this.sliderPointerWidth/2);var totalSteps=Math.ceil((this.max-this.min)/this.step);this.tickWidth=width/totalSteps;if(this.sliderMin&&this.sliderMax&&this.options.rangeLabels){this.createLabels()}else this.createTicks(totalSteps);this.element.insertBefore(this.clearDiv,null);if(this.element.offsetWidth)this.removeOverlappingTicks();this.update()},update:function(){this.initialized=false;if(this.minSelect){if(this.minSelect.update)this.minSelect.update();this.valueMin=Math.max(this.minSelect.selectedIndex,this.min-this.showLower)};if(this.maxSelect){if(this.maxSelect.update)this.maxSelect.update();var optionBorderValue=(this.minSelect&&!this.showLower)||(this.maxSelect.options[0]&&this.maxSelect.options[0].value==="")?0:-1;this.valueMax=this.maxSelect.selectedIndex>optionBorderValue?this.maxSelect.selectedIndex+this.showLower:this.max+this.showHigher};this.sliderSnap(this.sliderMin,this.sliderMax);this.initialized=true},createTicks:function(totalSteps){var tickStep=1;if(totalSteps>this.maxTicks){var i=0,prime=[2,3,5,7,11,13,17,19,23],_totalSteps=totalSteps;while(_totalSteps>this.maxTicks&&prime[i]<=this.maxTicks)if(_totalSteps%prime[i]){i++}else{_totalSteps/=prime[i];tickStep*=prime[i]}};if(totalSteps>this.maxTicks&&tickStep==1)tickStep=Math.ceil(totalSteps/(this.maxTicks-1));var tickSize=this.tickWidth*tickStep,select=this.minSelect||this.maxSelect,value,width,tick,span,wm,initialMargin=Math.floor((this.showLower+1)*this.sliderPointerWidth/2),totalWidth=1,availWidth=this.maxX+this.sliderPointerWidth-initialMargin;for(var i=0;i<=totalSteps;i+=tickStep){tick=document.createElement('div');tick.className='sliderTick';if(i==0)tick.style.marginLeft=initialMargin+'px';width=Math.round(i*this.tickWidth+tickSize)-totalWidth;if(totalWidth+width>availWidth)width=availWidth-totalWidth;totalWidth+=width;tick.style.width=width+'px';value=this.min+i*this.step;span=document.createElement('span');if(this.options.rangeLabels&&value in this.options.rangeLabels){value=this.options.rangeLabels[value]}else{if(select)if(select.options[value]){value=select.options[value].text.trim()}else continue;width=value.length;if(!this.options.noWordWrap)if(width>8){wm=value.split(/\s+/);if(wm.length>1){width=0;wm.forEach(function(w){width=Math.max(width,w.length)});value=wm.join('\n');tick.style.height=2+(wm.length*18)+'px'}};span.style.left=-3*width+'px'};span.innerHTML=value;addEvent(span,'click',this.sliderSet.bind(this,initialMargin+i*this.tickWidth));tick.appendChild(span);this.element.appendChild(tick)}},createLabels:function(){var i=0,labelData,values=[0,0],j=0,valueRange,tick=document.createElement('div');tick.className='sliderTick rangeLabel';tick.style.marginLeft=this.sliderPointerWidth+'px';tick.appendChild(document.createTextNode(' '));var label,labelData,width,totalWidth=0,totalRange=0;for(var i=0;i<this.options.rangeLabels.length;i++){labelData=this.options.rangeLabels[i];if(this.minSelect){for(;j<this.minSelect.options.length;j++){if(this.minSelect.options[j].value==''||this.minSelect.options[j].value!=labelData[0])continue;values=[j,j];for(;j<this.minSelect.options.length;j++){if(this.minSelect.options[j].value==labelData[1])break;values[1]++};break}}else values=labelData;valueRange=(values[1]-values[0])/this.step;totalRange+=valueRange;label=tick.cloneNode(true);width=Math.round(totalRange*this.tickWidth-totalWidth);label.style.width=(width-7)+'px';label.firstChild.nodeValue=labelData[2];totalWidth+=width;addEvent(label,'click',this.labelClick.bind(this,values[0],values[1]));this.element.appendChild(label);if(i==0)tick.style.marginLeft=0};tick.className='sliderTick';tick.firstChild.nodeValue=this.showHigher?String.fromCharCode(8734):'';this.element.appendChild(tick.cloneNode(true))},sliderStart:function(slider,e){if(!this.disabled&&!this.drag){e.preventDefault();this.cx=parseInt(slider.style.left);this.sx=e.clientX;this.drag=slider;this.EV_MOVE=addEvent(this.element,'mousemove',this.sliderMove.bind(this),true);this.EV_STOP=addEvent(document,'mouseup',this.sliderStop.bind(this),true)}},sliderMove:function(e){if(this.drag){e.preventDefault();var nx=this.cx-this.sx+e.clientX;if(nx<0)nx=0;if(nx>this.maxX)nx=this.maxX;this.drag.style.left=nx+'px';if(this.drag==this.sliderMin){if(this.sliderMax&&nx>parseInt(this.sliderMax.style.left)){this.sliderMax.style.left=nx+'px';this.sliderOnChange(this.sliderMax)}}else if(this.sliderMin&&nx<parseInt(this.sliderMin.style.left)){this.sliderMin.style.left=nx+'px';this.sliderOnChange(this.sliderMin)};this.sliderOnChange(this.drag)}},sliderStop:function(e){if(this.drag){this.sliderSnap(this.sliderMin,this.sliderMax);removeEvent(this.element,'mousemove',this.EV_MOVE);removeEvent(document,'mouseup',this.EV_STOP);this.drag=this.EV_MOVE=this.EV_STOP=null}},sliderClick:function(e){var target=e.target||e.srcElement;if(this.disabled||this.drag||target==this.sliderMin||target==this.sliderMax){e.preventDefault();return false};var nx=e.layerX||e.offsetX||0;while(target!=this.sliderArea){nx+=target.offsetLeft;target=target.parentNode};this.sliderSet(nx)},sliderSet:function(nx){if(this.disabled)return;nx-=Math.floor(this.sliderPointerWidth/2);if(nx<0)nx=0;if(nx>this.maxX)nx=this.maxX;var selectedSlider=this.sliderMin||this.sliderMax;if(this.sliderMin&&this.sliderMax){var sliderMinPos=parseInt(this.sliderMin.style.left);if(sliderMinPos<nx){var sliderMaxPos=parseInt(this.sliderMax.style.left);if(sliderMaxPos<nx||sliderMaxPos-nx<nx-sliderMinPos)selectedSlider=this.sliderMax}};selectedSlider.style.left=nx+'px';this.sliderOnChange(selectedSlider,true)},labelClick:function(min,max){if(this.sliderMin)this.valueMin=min;if(this.sliderMax)this.valueMax=max;this.sliderSnap(this.sliderMin,this.sliderMax)},sliderSnap:function(){var slider,value,left;for(var i=0;i<arguments.length;i++)if((slider=arguments[i])){value=slider==this.sliderMin?this.valueMin:this.valueMax;if(value<this.min){left=0}else if(value>this.max){left=this.maxX}else left=Math.round(((value-this.min)/this.step)*this.tickWidth)+Math.floor(this.showLower*this.sliderPointerWidth/2);slider.style.left=left+'px'};this.setSelection();if(this.initialized){slider=null;if(this.minSelect){slider=this.minSelect;this.minSelect.setSelectedIndex(this.valueMin)};if(this.maxSelect){slider=this.maxSelect;this.maxSelect.setSelectedIndex(this.valueMax-this.showLower)};if(slider&&slider.onchange)slider.onchange()}},setSelection:function(){var left=0,right;if(this.sliderMin||this.lowValue!==null){if(this.sliderMin)left=parseInt(this.sliderMin.style.left)+Math.floor(this.sliderPointerWidth/2);if(this.sliderMinLabel)this.setLabel(this.sliderMinLabel,this.minSelect?this.minSelect.options[this.valueMin].text:this.valueMin,left)};if(this.sliderSelected)this.sliderSelected.style.left=left+'px';if(this.sliderMax||this.highValue!==null){if(this.sliderMax){right=parseInt(this.sliderMax.style.left)+Math.floor(this.sliderPointerWidth/2)}else right=this.maxX+this.sliderPointerWidth;if(this.sliderSelected)this.sliderSelected.style.width=Math.max(0,right-left)+'px';if(this.sliderMaxLabel)this.setLabel(this.sliderMaxLabel,this.maxSelect?this.maxSelect.options[this.valueMax-this.showLower].text:this.valueMax,right)}else if(this.sliderSelected){right=this.maxX-parseInt(this.sliderSelected.style.left)+this.sliderPointerWidth;this.sliderSelected.style.width=right+'px'};if(this.options.onMove)this.options.onMove(left,right);if(this.options.onChange)this.options.onChange(this.valueMin,this.valueMax,left,right,this)},setLabel:function(labelElement,labelValue,leftOffset){labelElement.firstChild.nodeValue=labelValue;var x=Math.max(-8,Math.min(leftOffset-3*labelValue.length-2,this.maxX+this.sliderPointerWidth-5*labelValue.length+6));labelElement.style.left=x+'px'},sliderOnChange:function(slider,snap){var value=this.min+((parseInt(slider.style.left)-Math.floor(this.showLower*this.sliderPointerWidth/2))/this.tickWidth)*this.step;if(slider==this.sliderMin){if(value<this.min){value=this.min-this.showLower*this.step}else value=Math.round(value);if(this.sliderMax&&this.showHigher&&value>this.max){value=this.max;snap=true};this.valueMin=value}else{if(value>this.max){value=this.max+this.showHigher*this.step}else value=Math.round(value);if(this.sliderMin&&this.showLower&&value<this.min){value=this.min;snap=true};this.valueMax=value};if(snap){this.sliderSnap(slider)}else this.setSelection()},selectedIndexSetter:function(i){this.selectedIndex=i},setDisabled:function(bool){this.disabled=!!bool;var sliderPointer='sliderPointerImg';if(this.disabled){addClass(this.element,'disabled');sliderPointer+='Disabled'}else removeClass(this.element,'disabled');if(this.sliderMin)this.sliderMin.src=getPreloadImage(sliderPointer);if(this.sliderMax)this.sliderMax.src=getPreloadImage(sliderPointer)},removeOverlappingTicks:function(){var r=0,pad=this.options.tickLabelPadding||2;Selector('div.sliderTick',this.element).forEach(function(tick){var label=tick.firstChild,x=tick.offsetLeft+label.offsetLeft;if(x<r||label.offsetWidth==0){label.style.display='none'}else r=x+label.offsetWidth+pad})}})
function sliderInputWrapper(id,options){this.nodeName='SELECT';this.input=getById(id);this.options=options;this.selectedIndex=0;this.setSelectedIndex=function(index){this.selectedIndex=index;this.input.value=(this.options[this.selectedIndex]||{value:''}).value};this.update=function(){this.selectedIndex=findClosestOptionValue(this.options,this.input.value,/^a|a$/.test(this.input.name))};this.onchange=function(){(this.input.onkeyup||isNaN)()}}
function findClosestOptionValue(options,value,roundUp){var i=options.length,floatValue=parseFloat(value);while(i--)if(options[i].value===value)return i;if(value===''||isNaN(floatValue))return roundUp?options.length-1:0;i=options.length;while(i--)if(parseFloat(options[i].value)<floatValue){if(roundUp&&i+1<options.length)i++;return i};return roundUp?options.length-1:0}
function getNewFrontpageArticles(segmentId,settings){var requestNewArticles=function(){Ajax.sendRequest(getXmlHttpUrl('frontpage','refresh','',settingsString)+(segmentId?'&segmentId='+segmentId:''),{type:'json',nocache:true,async:true,handler:updateNewArticles})},updateNewArticles=function(response){var html=checkJsonResponse(response),articlesDiv=getById('groupedContent');if(html&&articlesDiv){if(pong&&window.Pong)window.Pong.stop();articlesDiv.innerHTML=html;if((pong=getById('pong'))){loadPong()}else BehaviourManager.exec(articlesDiv)}},loadPong=function(){RefreshTimer().pause('frontpageRefresh');loadJS('pong.js',pongLoaded);pong=true},pongLoaded=function(){if(window.Pong)window.Pong.init()},settingsString=objectToQueryString(settings||{}),pong=false;RefreshTimer().add('frontpageRefresh',requestNewArticles,120);if(settings&&Array.isArray(settings.types)&&!settings.types.length)loadPong();var settingsPopup=window.PopupGenerator&&PopupGenerator.exists('displayOptions');if(settingsPopup)settingsPopup.registerAdditionalSettingsForm('frontpageOptions',{initialize:function(){var form=getById('frontpageOptionsForm'),element,eventType,i=0;if(form)while((element=form.elements[i++]))if(element.name&&element.type){eventType='';switch(element.type){case'text':case'textarea':eventType='keyup';break;case'radio':case'checkbox':eventType='click';break;case'select-one':case'select-multiple':eventType='change';break};if(eventType)element['on'+eventType]=this.save.bind(this,form)}},onShow:function(){RefreshTimer().pause('frontpageRefresh')},onClose:function(){if(!pong)RefreshTimer().resume('frontpageRefresh')},save:function(form){settingsString=getQueryString(form);Ajax.sendRequest(getXmlHttpUrl('frontpage','frontpageOptions','save'),{method:'POST',async:true,appendSid:true},settingsString);requestNewArticles()}})}
function objectToQueryString(obj){var q=[],name,qName,values,i;for(name in obj){qName=encodeURIComponent(name);if(obj[name]instanceof Array){qName+='%5B%5D';values=obj[name]}else values=[obj[name]];for(i=0;i<values.length;i++)q.push(qName+'='+encodeURIComponent(values[i]))};return q.join('&')}
function frontpageRectangleCallback(tag,hasBanner){if(!(hasBanner||tag.replacement))return;var recentlyTested=getById('recentlyTested');if(recentlyTested)addClass(recentlyTested,'hasBanner')}